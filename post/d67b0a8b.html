<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç° | èœ¡ç¬”æ¢¦å·¥å‚</title><meta name="author" content="Lorinda"><meta name="copyright" content="Lorinda"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="èšç„¦è‹ç©¹å¤–å–æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ï¼Œè¯¦è§£ç”¨æˆ·ç®¡ç†ã€èœå“ç®¡ç†ã€è®¢å•å…¨æµç¨‹åŠè´­ç‰©è½¦äº¤äº’é€»è¾‘ï¼Œç»“åˆæ•°æ®ç»Ÿè®¡åŠŸèƒ½å®ç°ä¸šåŠ¡é—­ç¯ï¼Œè¦†ç›–é¡¹ç›®æ ¸å¿ƒåœºæ™¯ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°">
<meta property="og:url" content="http://labi.com/post/d67b0a8b.html">
<meta property="og:site_name" content="èœ¡ç¬”æ¢¦å·¥å‚">
<meta property="og:description" content="èšç„¦è‹ç©¹å¤–å–æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ï¼Œè¯¦è§£ç”¨æˆ·ç®¡ç†ã€èœå“ç®¡ç†ã€è®¢å•å…¨æµç¨‹åŠè´­ç‰©è½¦äº¤äº’é€»è¾‘ï¼Œç»“åˆæ•°æ®ç»Ÿè®¡åŠŸèƒ½å®ç°ä¸šåŠ¡é—­ç¯ï¼Œè¦†ç›–é¡¹ç›®æ ¸å¿ƒåœºæ™¯ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png">
<meta property="article:published_time" content="2025-08-30T03:02:00.000Z">
<meta property="article:modified_time" content="2025-09-02T12:16:04.998Z">
<meta property="article:author" content="Lorinda">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="ä¸šåŠ¡é€»è¾‘">
<meta property="article:tag" content="ä¸‰å±‚æ¶æ„">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png"><link rel="shortcut icon" href="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155552.png"><link rel="canonical" href="http://labi.com/post/d67b0a8b.html"><link rel="preconnect" href="//cdnjs.cloudflare.com"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bf06f078fafddfd82b474ce179303666";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":{"enable":true},"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdnjs.cloudflare.com/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/wave.css"><link rel="stylesheet" href="/css/readPercent.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2264842_b004iy0kk2b.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/loading.css"><link rel="stylesheet" href="/css/about.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/ethan4116-blog/lib/css/plane_v2.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><span id="fps"></span><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160015.png"/><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div id="web_bg" style="background-image: url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/af380cb8a5ed3f047e66dbfe731f488.jpg);"></div><div id="an_music_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155535.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">112</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-hexoa-homezhuyefangzijia"></i><svg class="icon fas fa-home" aria-hidden="true"><use xlink:href="#icon-hexoa-homezhuyefangzijia"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-hexoshouhuiban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoshouhuiban"></use></svg><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexohuanjiaowenzhang"></use></svg><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexofenlei"></use></svg><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexobiaoqian"></use></svg><span> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoguidang"></use></svg><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoicon_liebiao"></use></svg><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoyinle"></use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexotubiaozhizuomoban"></use></svg><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-hexopengyou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexopengyou"></use></svg><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-hexowode"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexowode"></use></svg><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155552.png" alt="Logo"><span class="site-name">èœ¡ç¬”æ¢¦å·¥å‚</span></a><a class="nav-page-title" href="/"><span class="site-name">æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></span></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-hexoa-homezhuyefangzijia"></i><svg class="icon fas fa-home" aria-hidden="true"><use xlink:href="#icon-hexoa-homezhuyefangzijia"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-hexoshouhuiban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoshouhuiban"></use></svg><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexohuanjiaowenzhang"></use></svg><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexofenlei"></use></svg><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexobiaoqian"></use></svg><span> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoguidang"></use></svg><span> å½’æ¡£</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoicon_liebiao"></use></svg><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexoyinle"></use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexotubiaozhizuomoban"></use></svg><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-hexopengyou"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexopengyou"></use></svg><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-hexowode"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-hexowode"></use></svg><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div><div id="randomPost"><a class="site-page social-icon search" href="javascript:;" onclick="randomPost()" title="éšæœºè®¿é—®ä¸€ç¯‡æ–‡ç« "><i class="fas fa-circle-notch fa-fw"></i></a></div></nav><div id="post-info"><h1 class="post-title">æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-08-30T03:02:00.000Z" title="å‘è¡¨äº 2025-08-30 11:02:00">2025-08-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-02T12:16:04.998Z" title="æ›´æ–°äº 2025-09-02 20:16:04">2025-09-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE/">è‹ç©¹å¤–å–é¡¹ç›®</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">27.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>112åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div class="series-navigation"><h4 class="series-title">è‹ç©¹å¤–å–é¡¹ç›®å¼€å‘æŒ‡å—</h4><ol class="series-list"><li class="series-item series-current"><a class="series-link" href="/post/25e0fe54.html"><span class="series-icon">â€¢</span><span class="series-text">ğŸ“‹ é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ</span></a><span class="series-current-tag">â† å½“å‰ä½ç½® ğŸ›¸</span></li><li class="series-item"><a class="series-link" href="/post/b85186f.html"><span class="series-icon">â€¢</span><span class="series-text">ğŸ› ï¸ åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®</span></a></li><li class="series-item"><a class="series-link" href="/post/d67b0a8b.html"><span class="series-icon">â€¢</span><span class="series-text">ğŸ“Š æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°</span></a></li><li class="series-item"><a class="series-link" href="/post/ce4585c2.html"><span class="series-icon">â€¢</span><span class="series-text">ğŸ–¥ï¸ å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘</span></a></li></ol></div><h1>åã€è´­ç‰©è½¦</h1>
<h2 id="10-1-æ·»åŠ è´­ç‰©è½¦">10.1 æ·»åŠ è´­ç‰©è½¦</h2>
<ul>
<li>èœå“ï¼š
<ul>
<li>æƒ…å†µ1ï¼šèœå“æ²¡æœ‰è®¾ç½®å£å‘³æ•°æ®ï¼Œç›´æ¥ç‚¹å‡»<code>+</code>å°†èœå“æ·»åŠ åˆ°è´­ç‰©è½¦å½“ä¸­ã€‚</li>
<li>æƒ…å†µ2ï¼šèœå“è®¾ç½®äº†å£å‘³æ•°æ®ï¼Œéœ€è¦å…ˆç‚¹å‡»<code>é€‰æ‹©è§„æ ¼</code>æ¥é€‰æ‹©å¯¹åº”çš„å£å‘³ï¼Œä¹‹ååœ¨ç‚¹å‡»<code>åŠ å…¥è´­ç‰©è½¦</code>æŒ‰é’®ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠèœå“æ•°æ®æ·»åŠ åˆ°è´­ç‰©è½¦å½“ä¸­ã€‚</li>
<li>å¦‚æœè¿™ä¸ªå•†å“å·²ç»è¢«åŠ å…¥åˆ°äº†è´­ç‰©è½¦ï¼Œä½ è¿˜æƒ³æ·»åŠ ç›¸åŒçš„å•†å“çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨è´­ç‰©è½¦å½“ä¸­ç‚¹å‡»<code>+</code>ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿçš„æ¥æ·»åŠ ä¸€ä¸ªç›¸åŒçš„å•†å“åˆ°è´­ç‰©è½¦å½“ä¸­ã€‚</li>
</ul>
</li>
<li>å¥—é¤ï¼šç›´æ¥ç‚¹å‡»<code>+</code>å°±å¯ä»¥æŠŠå¥—é¤æ·»åŠ åˆ°è´­ç‰©è½¦å½“ä¸­ã€‚</li>
</ul>
<p>![[7d764d4ead847b325bffce6bf8c8361d.png]]</p>
<p>![[0a6c71bc8d48675c20e694d9dc668e8b.png]]</p>
<ul>
<li>æ·»åŠ è´­ç‰©è½¦æ—¶ï¼Œæœ‰å¯èƒ½æ·»åŠ èœå“ï¼Œä¹Ÿæœ‰å¯èƒ½æ·»åŠ å¥—é¤ã€‚æ•…ä¼ å…¥å‚æ•°è¦ä¹ˆæ˜¯èœå“idï¼Œè¦ä¹ˆæ˜¯å¥—é¤idã€‚</li>
<li>èœå“å¯èƒ½è¿˜æœ‰å£å‘³æ•°æ®ï¼Œæ‰€ä»¥è¿˜éœ€è¦åŒ…å«å£å‘³æ•°æ®çš„å‚æ•°ã€‚</li>
<li>å¯¹äºæŸä¸€æ¬¡æ·»åŠ è´­ç‰©è½¦æ¥è¯´ï¼Œè¦ä¹ˆæ·»åŠ çš„å°±æ˜¯èœå“è¦ä¹ˆæ·»åŠ çš„å°±æ˜¯å¥—é¤ï¼Œ<code>ä¸å¯èƒ½ä½ åŒæ—¶æ·»åŠ çš„åˆæ˜¯èœå“åˆæ˜¯å¥—é¤</code>ï¼Œè¿™æ ·çš„è¯æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥è¿™3ä¸ªå‚æ•°æ˜¯éå¿…é¡»çš„ã€‚</li>
<li>ä½†æ˜¯å¯¹äºæŸä¸€æ¬¡æ·»åŠ è´­ç‰©è½¦è¿™ä¸ªä¸šåŠ¡æ¥è¯´ï¼Œèœå“idæˆ–è€…å¥—é¤idå¿…é¡»æäº¤è¿‡æ¥ä¸€ä¸ªã€‚</li>
</ul>
<p>![[0784f6008901dbfad5ac4e59f4fab87b.png]]</p>
<p>shopping_cartè¡¨ä½œç”¨ï¼šæš‚æ—¶å­˜æ”¾æ‰€é€‰å•†å“çš„åœ°æ–¹</p>
<p>é€‰çš„ä»€ä¹ˆå•†å“</p>
<p>æ¯ä¸ªå•†å“éƒ½ä¹°äº†å‡ ä¸ª</p>
<p>ä¸åŒç”¨æˆ·çš„è´­ç‰©è½¦éœ€è¦åŒºåˆ†å¼€</p>
<p>![[e9f30d4374a2e1d98058db256626a140.png]]</p>
<p>3ä¸ªç‰¹æ®Šçš„å­—æ®µnameã€imageã€amount</p>
<p>ç‰¹æ®Šåœ¨è¿™3ä¸ªå­—æ®µä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºé€šè¿‡dish_idæˆ–è€…setmeal_idå°±å¯ä»¥æŸ¥è¯¢å‡ºæ¥ç›¸åº”çš„è¿™ä¸ªå•†å“åç§°ã€å›¾ç‰‡è·¯å¾„ã€å•†å“å•ä»·ï¼Œè¿™ä¸ªæ—¶å€™è¿™3ä¸ªå­—æ®µç§°ä½œå†—ä½™å­—æ®µã€‚</p>
<p>å†—ä½™å­—æ®µï¼šåå¤å‡ºç°çš„é‡å¤å­—æ®µï¼Œegï¼šèœå“è¡¨å½“ä¸­å·²ç»æœ‰äº†èœå“çš„åç§°ã€å›¾ç‰‡è·¯å¾„ã€ä»·æ ¼å­—æ®µäº†ï¼Œåœ¨å½“å‰è¡¨shopping_cartåˆå‡ºç°äº†ä¸€éï¼Œè¿™å°±æ˜¯å†—ä½™å­—æ®µã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡</p>
<p>å› ä¸ºé€šè¿‡è®¾è®¡è¿™äº›å†—ä½™å­—æ®µå°±å¯ä»¥æé«˜æˆ‘ä»¬çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œegï¼šåœ¨å±•ç¤ºè´­ç‰©è½¦æ•°æ®çš„æ—¶å€™éœ€è¦å±•ç¤ºå•†å“çš„åç§°ã€ ä»·æ ¼ ã€å›¾ç‰‡ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›å†—ä½™å­—æ®µåœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™é™¤äº†è¦æŸ¥è¯¢æˆ‘ä»¬è¿™ä¸ªè´­ç‰©è½¦è¡¨ï¼Œè¿˜éœ€è¦è”åˆå»æŸ¥è¯¢èœå“è¡¨æˆ–è€…å¥—é¤è¡¨ï¼Œç›¸å½“äºæ˜¯2å¼ è¡¨çš„è¿æ¥æŸ¥è¯¢ï¼Œç°åœ¨æœ‰äº†å†—ä½™å­—æ®µå°±å˜æˆäº†å•è¡¨æŸ¥è¯¢ï¼Œæˆ‘ä»¬ç›´æ¥æŸ¥è¯¢è¿™ä¸ªè´­ç‰©è½¦è¡¨å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦å°±ä¼šå¿«å¾ˆå¤šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.user;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shoppingCart&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯è´­ç‰©è½¦ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartController</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;æ·»åŠ è´­ç‰©è½¦&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">		log.info(<span class="string">&quot;æ·»åŠ è´­ç‰©è½¦ï¼Œå•†å“ä¿¡æ¯ä¸ºï¼š&#123;&#125;&quot;</span>, shoppingCartDTO);</span><br><span class="line">		shoppingCartService.addShoppingCart(shoppingCartDTO);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> shoppingCartDTO</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">		<span class="comment">// åˆ¤æ–­å½“å‰åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­çš„å•†å“æ˜¯å¦å·²ç»å­˜åœ¨äº†</span></span><br><span class="line">		<span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">		BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br><span class="line">		<span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">		shoppingCart.setUserId(userId);</span><br><span class="line"></span><br><span class="line">		List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œåªéœ€è¦å°†æ•°é‡åŠ ä¸€</span></span><br><span class="line">		<span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; !list.isEmpty()) &#123;</span><br><span class="line">			<span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> list.get(<span class="number">0</span>); <span class="comment">// listä¸­å›½åªä¼šæœ‰ä¸€æ¡æ•°æ®</span></span><br><span class="line">			cart.setNumber(cart.getNumber() + <span class="number">1</span>);</span><br><span class="line">			shoppingCartMapper.updateNumberById(cart);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦æ’å…¥ä¸€æ¡è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">		<span class="comment">// åˆ¤æ–­æœ¬æ¬¡æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“è¿˜æ˜¯å¥—é¤</span></span><br><span class="line">		<span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCartDTO.getDishId();</span><br><span class="line">		<span class="keyword">if</span> (dishId != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="comment">// æœ¬æ¬¡æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯èœå“</span></span><br><span class="line">			<span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(dishId);</span><br><span class="line">			shoppingCart.setName(dish.getName());</span><br><span class="line">			shoppingCart.setImage(dish.getImage());</span><br><span class="line">			shoppingCart.setAmount(dish.getPrice());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// æœ¬æ¬¡æ·»åŠ åˆ°è´­ç‰©è½¦çš„æ˜¯å¥—é¤</span></span><br><span class="line">			<span class="type">Long</span> <span class="variable">setmealId</span> <span class="operator">=</span> shoppingCartDTO.getSetmealId();</span><br><span class="line">			<span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> setmealMapper.getById(setmealId);</span><br><span class="line">			shoppingCart.setName(setmeal.getName());</span><br><span class="line">			shoppingCart.setImage(setmeal.getImage());</span><br><span class="line">			shoppingCart.setAmount(setmeal.getPrice());</span><br><span class="line">		&#125;</span><br><span class="line">		shoppingCart.setNumber(<span class="number">1</span>); <span class="comment">// åˆå§‹æ•°é‡</span></span><br><span class="line">		shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line">		shoppingCartMapper.insert(shoppingCart);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartMapper</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * åŠ¨æ€æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">	 * ä¼ å…¥å¥—é¤idï¼šselect * from shopping_cart where user_id = ? and setmeal_id = ?</span></span><br><span class="line"><span class="comment">	 * ä¼ å…¥èœå“idï¼šselect * from shopping_cart where user_id = ? and dish_id = ? and dish_flavor</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	List&lt;ShoppingCart&gt; <span class="title function_">list</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ ¹æ®idä¿®æ”¹å•†å“æ•°é‡</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cart</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Update(&quot;update shopping_cart set number = #&#123;number&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">updateNumberById</span><span class="params">(ShoppingCart cart)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ’å…¥è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Insert(&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot; +</span></span><br><span class="line"><span class="meta">			&quot; values (#&#123;name&#125;,#&#123;userId&#125;,#&#123;dishId&#125;,#&#123;setmealId&#125;,#&#123;dishFlavor&#125;,#&#123;number&#125;,#&#123;amount&#125;,#&#123;image&#125;,#&#123;createTime&#125;)&quot;)</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(ShoppingCart shoppingCart)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.ShoppingCartMapper&quot;</span>&gt;</span><br><span class="line">    &lt;!--æ³¨æ„ï¼šåŠ¨æ€sqlé‡Œé¢ï¼Œä¸Šé¢è¿™ä¸ªåˆ¤æ–­æ¡ä»¶å†™çš„æ˜¯å®ä½“ç±»ä¸­çš„å±æ€§åï¼Œ</span><br><span class="line">                ä¸‹é¢çš„sqlå†™çš„æ˜¯è¡¨ä¸­çš„å­—æ®µåã€‚--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;list&quot;</span> resultType=<span class="string">&quot;com.sky.entity.ShoppingCart&quot;</span>&gt;</span><br><span class="line">        select * from shopping_cart</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;userId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">user_id</span> <span class="operator">=</span> #&#123;userId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;dishId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">dish_id</span> <span class="operator">=</span> #&#123;dishId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;setmealId != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">setmeal_id</span> <span class="operator">=</span> #&#123;setmealId&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;dishFlavor != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">dish_flavor</span> <span class="operator">=</span> #&#123;dishFlavor&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">        order by create_time desc</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<h2 id="10-2-æŸ¥çœ‹è´­ç‰©è½¦">10.2 <strong>æŸ¥çœ‹è´­ç‰©è½¦</strong></h2>
<p>è¿™ä¸ªåœ°æ–¹ä¸éœ€è¦æäº¤ä»»ä½•å‚æ•°è¿‡å»ï¼Œå› ä¸ºæˆ‘ä»¬å½“å‰æŸ¥è¯¢çš„æ˜¯ç”¨æˆ·çš„æ‰€æœ‰è´­ç‰©è½¦æ•°æ®ã€‚</p>
<p>é—®é¢˜ï¼šæ—¢ç„¶ä½ è¦æŸ¥è¯¢å½“å‰è¿™ä¸ªå¾®ä¿¡ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®ï¼Œé‚£è¦ä¸è¦æŠŠå¾®ä¿¡ç”¨æˆ·çš„idç»™ä¼ è¿‡å»å‘¢ï¼Ÿ<br>
ç­”ï¼šä¸éœ€è¦ï¼Œå› ä¸ºæˆ‘ä»¬æ¯ä¸€æ¬¡ä¸šåŠ¡æ“ä½œçš„æ—¶å€™å‘¢ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚å¤´é‡Œé¢æºå¸¦ä¸€ä¸ªtokenè¿‡å»ï¼Œåç«¯é€šè¿‡è§£æè¿™ä¸ªtokenå°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªç”¨æˆ·idï¼Œæ‰€ä»¥è¿™ä¸ªuser_idä¸ä¼ è¿‡å»ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<blockquote>
<p>ç”¨æˆ·idé€šè¿‡ThreadLocalè·å¾—</p>
</blockquote>
<p>![[e7b93df2d4b6ad62c494520727d27d1c.png]]</p>
<p>![[a6568c351c828ac280be992d76351065.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;æŸ¥çœ‹è´­ç‰©è½¦&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(shoppingCartService.showShoppingCart());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ä¼ é€’ä¸€ä¸ªuser_id</span></span><br><span class="line">		<span class="comment">// è·å–å½“å‰è¿™ä¸ªå¾®ä¿¡ç”¨æˆ·çš„id</span></span><br><span class="line">		<span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">		<span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> ShoppingCart.builder()</span><br><span class="line">				.userId(userId)</span><br><span class="line">				.build();</span><br><span class="line">		List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-3-æ¸…ç©ºè´­ç‰©è½¦"><strong>10.3 æ¸…ç©ºè´­ç‰©è½¦</strong></h2>
<p>![[0853782642cbaa34976a9527a2a7e818.png]]</p>
<p>å’ŒæŸ¥çœ‹è´­ç‰©è½¦ç±»ä¼¼ï¼ŒåŒæ ·ä¸éœ€è¦æäº¤å‚æ•°ï¼Œå› ä¸ºåœ¨åç«¯å®é™…ä¸Šèƒ½å¤ŸçŸ¥é“å½“å‰ç”¨æˆ·çš„idã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ¸…ç©ºè´­ç‰©è½¦å•†å“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">	shoppingCartService.cleanShoppingCart();</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">// ä¸èƒ½åˆ é™¤åˆ«äººçš„æ•°æ®åªèƒ½åˆ é™¤è‡ªå·±çš„è´­ç‰©è½¦æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦æœ‰user_idä½œä¸ºåˆ é™¤æ¡ä»¶ã€‚</span></span><br><span class="line">	<span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">	shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;delete from shopping_cart where user_id = #&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByUserId</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="10-4-åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“"><strong>10.4 åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</strong></h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sub&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åˆ é™¤è´­ç‰©è½¦ä¸­çš„ä¸€ä¸ªå•†å“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sub</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">	shoppingCartService.subShoppingCart(shoppingCartDTO);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subShoppingCart</span><span class="params">(ShoppingCartDTO shoppingCartDTO)</span> &#123;</span><br><span class="line">	<span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">	BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</span></span><br><span class="line">	shoppingCart.setUserId(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">	List&lt;ShoppingCart&gt; list = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">	<span class="keyword">if</span> (list != <span class="literal">null</span> &amp;&amp; !list.isEmpty()) &#123;</span><br><span class="line">		<span class="comment">// ä¸ä¸ºç©ºè¯´æ˜æœ‰æ•°æ®ï¼Œliståªæœ‰ä¸€æ¡æ•°æ®</span></span><br><span class="line">		shoppingCart = list.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> shoppingCart.getNumber();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (number == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">// ç›´æ¥åˆ é™¤å½“å‰è®°å½•</span></span><br><span class="line">			shoppingCartMapper.deleteById(shoppingCart.getId());</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// ä»½æ•°-1</span></span><br><span class="line">			shoppingCart.setNumber(shoppingCart.getNumber() - <span class="number">1</span>);</span><br><span class="line">			shoppingCartMapper.updateNumberById(shoppingCart);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete(&quot;delete from shopping_cart where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>
<h1>åä¸€ã€ç”¨æˆ·ä¸‹å•</h1>
<h2 id="11-1-åœ°å€è–„åŠŸèƒ½"><strong>11.1 åœ°å€è–„åŠŸèƒ½</strong></h2>
<p>åˆ—è¡¨æŸ¥è¯¢åœ°å€åŠŸèƒ½è®¾ä¸ºé»˜è®¤åœ°å€åŠŸèƒ½æ–°å¢åœ°å€åŠŸèƒ½åˆ é™¤åœ°å€åŠŸèƒ½ä¿®æ”¹åœ°å€åŠŸèƒ½æŸ¥è¯¢é»˜è®¤åœ°å€</p>
<p>éƒ½æ˜¯å•è¡¨æ“ä½œ</p>
<p>å®ç°åŠŸèƒ½ï¼š</p>
<ul>
<li>æŸ¥è¯¢åœ°å€åˆ—è¡¨</li>
<li>æ–°å¢åœ°å€</li>
<li>ä¿®æ”¹åœ°å€</li>
<li>åˆ é™¤åœ°å€</li>
<li>è®¾ç½®é»˜è®¤åœ°å€</li>
<li>æŸ¥è¯¢é»˜è®¤åœ°å€
<ul>
<li>é€šè¿‡å½“å‰è¿™ä¸ªäº§å“åŸå‹æ˜¯çœ‹ä¸å‡ºæ¥è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå®é™…ä¸Šåœ¨ç”¨æˆ·ä¸‹å•çš„æ—¶å€™åœ¨ä¸‹å•é¡µé¢ï¼Œä¼šæŠŠå½“å‰è¿™ä¸ªç”¨æˆ·çš„é»˜è®¤åœ°å€ç»™ä»–æŸ¥å‡ºæ¥ï¼ŒæŸ¥å‡ºæ¥ä¹‹åæ˜¾ç¤ºåœ¨æˆ‘ä»¬æäº¤è®¢å•é‚£ä¸ªé¡µé¢ä¸Šã€‚</li>
</ul>
</li>
</ul>
<p>æ¥å£ï¼š</p>
<ul>
<li>
<p>æ–°å¢åœ°å€</p>
<p>![[4e6d8bf2f355229fb4269389d1fe598c.png]]</p>
</li>
<li>
<p>æŸ¥è¯¢ç™»å½•ç”¨æˆ·æ‰€æœ‰åœ°å€</p>
<p>![[4083563db9e0d1c3d7a65faa9375f224.png]]</p>
<p>å‰ç«¯ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œå› ä¸ºè¿™ä¸ªç”¨æˆ·çš„idæ¯æ¬¡å‘é€è¯·æ±‚éƒ½ä¼šæºå¸¦tokenï¼Œä¹‹ååœ¨æ‹¦æˆªå™¨ä¸­è§£ætokenåœ¨ç»‘å®šç»™ThreadLocalè·å¾—ã€‚</p>
</li>
<li>
<p>æŸ¥è¯¢é»˜è®¤åœ°å€</p>
<p>åŒæ ·ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯èƒ½å¤ŸçŸ¥é“å½“å‰ç™»å½•ç”¨æˆ·æ˜¯è°çš„ã€‚</p>
<p>ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¸‹å•é¡µé¢ä¼šæŸ¥è¯¢é»˜è®¤åœ°å€</p>
<p>![[b5ac159e2a6d10fd9ac2ce1092831fbc.png]]</p>
</li>
<li>
<p>æ ¹æ®idä¿®æ”¹åœ°å€</p>
<p>![[3833713a3c081ace6fe056d050d34423.png]]</p>
</li>
<li>
<p>æ ¹æ®idåˆ é™¤åœ°å€</p>
<p>![[9936bee56f8bf9e3abc5e7b3112f1a95.png]]</p>
</li>
<li>
<p>æ ¹æ®idæŸ¥è¯¢åœ°å€</p>
<p>![[70550782181f1dcb4d7bba4832fcae8f.png]]</p>
</li>
<li>
<p>è®¾ç½®é»˜è®¤åœ°å€</p>
<p>æœ¬è´¨æ˜¯ä¸€ä¸ªä¿®æ”¹æ“ä½œã€‚</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/3d8dcf3d7a25c0f5044d46ebf2d8bafa.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3d8dcf3d7a25c0f5044d46ebf2d8bafa.png" alt=""></a></p>
</li>
</ul>
<p>![[/image 103.png|image 103.png]]</p>
<p>æ³¨ï¼šæ˜¯ç”¨æˆ·ç«¯</p>
<h2 id="11-2-ç”¨æˆ·ä¸‹å•åŠŸèƒ½"><strong>11.2 ç”¨æˆ·ä¸‹å•åŠŸèƒ½</strong></h2>
<p>![[2e1ebd4c8a637e6447909ce98275633b.png]]</p>
<ul>
<li>ç”¨æˆ·ä¹°çš„é‚£äº›å•†å“ï¼Ÿæ¯ä¸ªå•†å“æ•°é‡æ˜¯å¤šå°‘ï¼Ÿ
<ul>
<li>è¿™äº›æ•°æ®æ¥æºäºç”¨æˆ·çš„è´­ç‰©è½¦ï¼Œå› ä¸ºç‚¹é¤çš„æ—¶å€™ç”¨æˆ·æ˜¯å…ˆå°†å•†å“åŠ å…¥åˆ°è´­ç‰©è½¦å½“ä¸­ç„¶åæ‰èƒ½æäº¤è®¢å•ï¼Œæ‰€ä»¥ç”¨æˆ·ä¹°çš„å“ªäº›å•†å“ä»¥åŠå•†å“çš„æ•°é‡æ˜¯ç”±è´­ç‰©è½¦ä¸­çš„æ•°æ®å†³å®šçš„ï¼Œå½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®å¯ä»¥æŸ¥å‡ºæ¥ï¼Œå› ä¸ºå‰é¢å·²ç»å®ç°äº†è´­ç‰©è½¦çš„ç›¸å…³åŠŸèƒ½äº†ã€‚</li>
</ul>
</li>
<li>è®¢å•æ€»é‡‘é¢æ˜¯é€šè¿‡ç¨‹åºè®¡ç®—å¾—å‡ºæ¥çš„ï¼Œæ€»é‡‘é¢ç”±2éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯èœå“çš„è´¹ç”¨ä¸€ä¸ªæ˜¯å…¶å®ƒçš„è´¹ç”¨ã€‚
<ul>
<li>èœå“è´¹ç”¨å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ç‚¹çš„æœ‰å“ªäº›èœå“åŒ…æ‹¬æ•°é‡å•ä»·éƒ½æœ‰ï¼Œç›´æ¥ä¹˜ä»¥ç´¯åŠ å°±å¯ä»¥è®¡ç®—å‡ºæ¥ã€‚</li>
<li>å…¶å®ƒè´¹ç”¨ï¼šé¤ç›’è´¹å’Œé…é€è´¹ï¼Œå…·ä½“å¦‚ä½•è®¡ç®—åœ¨å½“å‰è¿™ä¸ªç³»ç»Ÿå½“ä¸­å°±ç®€å•çš„å¤„ç†äº†ï¼Œé¤ç›’è´¹å‘¢å’±ä»¬å°±æ ¹æ®å•†å“çš„æ•°é‡æ¥ç®—ï¼Œä¸€ä¸ªå•†å“å¯¹åº”ä¸€ä¸ªé¤ç›’ï¼Œæ¯ä¸ªé¤ç›’ä¸€å…ƒã€‚é…é€è´¹å›ºå®šæŒ‰ç…§6å…ƒå»ç®—ã€‚</li>
</ul>
</li>
<li>ç”¨æˆ·çš„åå­—ï¼Œæ”¶è´§åœ°å€ï¼Œæ‰‹æœºå·ï¼šé€šè¿‡ä¹‹å‰å¯¼å…¥çš„åœ°å€ç°¿åŠŸèƒ½ä»£ç ï¼Œç”¨æˆ·çš„åœ°å€ç°¿ä¸­å°±åŒ…æ‹¬ç”¨æˆ·çš„åå­— æ‰‹æœºå· æ”¶è´§åœ°å€è¿™äº›æ•°æ®ï¼Œç”¨æˆ·åœ¨ä¸‹å•çš„æ—¶å€™å°±éœ€è¦é€‰æ‹©ä¸€ä¸ªåœ°å€ç°¿ï¼Œè¿™æ ·å°±å¯ä»¥è·å–åˆ°è¿™äº›æ•°æ®äº†ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/aad68f6039c7dc8eec085836a7a58394.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/aad68f6039c7dc8eec085836a7a58394.png" alt=""></a></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/f74eddbad296242041b1811e010801a6.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/f74eddbad296242041b1811e010801a6.png" alt=""></a></p>
<ul>
<li>POSTè¯·æ±‚ï¼šç”¨æˆ·ä¸‹å•æœ¬è´¨ä¸Šæ˜¯æ–°å¢æ“ä½œï¼Œä¹Ÿå°±æ˜¯éœ€è¦å°†ä¸‹å•åäº§ç”Ÿçš„è®¢å•æ•°æ®æŠŠå®ƒæ’å…¥åˆ°æ•°æ®åº“å½“ä¸­ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/c716c7c5d44f0543b24b083ac932c846.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/c716c7c5d44f0543b24b083ac932c846.png" alt=""></a></p>
<p>æ”¯ä»˜å‰©ä½™æ—¶é—´å€’è®¡æ—¶ï¼Œæ˜¯ç”±å‰ç«¯å°ç¨‹åºæŒ‰ç…§ç§’é€’å‡ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™å®ƒè¿”å›ä¸€ä¸ªä¸‹å•çš„æ—¶é—´å°±å¯ä»¥äº†ï¼Œå°ç¨‹åºä¼šæ ¹æ®è¿™ä¸ªä¸‹å•æ—¶é—´å»è®¡ç®—è¿˜å‰©å¤šå°‘æ—¶é—´å¹¶ä¸”è¿›è¡Œå€’è®¡æ—¶çš„å±•ç¤ºã€‚</p>
<p>![[d001babb0a4ed52afef2e5353472ceb8.png]]</p>
<p>![[41739ca18629eb20dbe600754cf75bb5.png]]</p>
<p>![[41739ca18629eb20dbe600754cf75bb5 1.png]]</p>
<ul>
<li>
<p>ç”¨æˆ·ä¸‹å•çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªè®¢å•è¡¨ï¼ŒæŠŠå½“å‰ç”¨æˆ·ä¸‹å•çš„æ•°æ®å­˜å…¥åˆ°è®¢å•è¿™å¼ è¡¨é‡Œé¢å»ï¼Œä½†æ˜¯åªæœ‰ä¸€ç§è®¢å•è¡¨è¿˜ä¸è¶³ä»¥å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ï¼Œå› ä¸ºç”¨æˆ·ä¸‹å•çš„æ—¶å€™å¯èƒ½ç‚¹äº†å¾ˆå¤šå•†å“ï¼Œæ¯ä¸ªå•†å“å¯èƒ½è¿˜æœ‰å¾ˆå¤šä»½ï¼Œè¿™ä¸ªæ—¶å€™åœ¨æˆ‘ä»¬è¿™ä¸ªè®¢å•è¡¨é‡Œé¢å¹¶ä¸æ˜¯å¾ˆå¥½å­˜ï¼Œå…·ä½“æˆ‘è¿™ä¸ªè®¢å•ä¸‹é¢æŒ‚äº†å‡ ä¸ªå•†å“å‘¢ï¼Ÿï¼Ÿï¼Ÿå…·ä½“ç‚¹äº†å‡ ä»½ï¼Ÿï¼Ÿï¼Ÿ<br>
å¯¹äºè¿™æ ·çš„æ•°æ®æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå­˜å‚¨åœ¨å¦ä¸€å¼ è¡¨é‡Œé¢ï¼Œå«åšè®¢å•æ˜ç»†è¡¨ã€‚</p>
</li>
<li>
<p>ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªè®¢å•å…³è”å¤šä¸ªè®¢å•æ˜ç»†ã€‚</p>
</li>
<li>
<p>ç”¨æˆ·æäº¤è®¢å•æ—¶ï¼Œéœ€è¦å¾€è®¢å•è¡¨ordersä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”éœ€è¦å¾€order_detailä¸­æ’å…¥ä¸€æ¡æˆ–å¤šæ¡è®°å½•</p>
</li>
</ul>
<p>![[e4acf2e91cb09e0022834690953fefa7.png]]</p>
<p>![[1fbde21f47a491168f9e39e1dbe8263c.png]]</p>
<p><code>shape = JsonFormat.Shape.STRING</code> æ˜¯ Jackson æ¡†æ¶ä¸­ç”¨äºæŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶æ•°æ®ç±»å‹çš„é…ç½®é¡¹ã€‚å½“ä½ å°† <code>shape</code> è®¾ç½®ä¸º <code>JsonFormat.Shape.STRING</code> æ—¶ï¼Œæ„å‘³ç€ä½ å¸Œæœ›å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œä¸æ˜¯ä½¿ç”¨å®ƒçš„é»˜è®¤æ•°æ®æ ¼å¼ã€‚</p>
<p>![[a03dcd898dd3c748270114cc62980318.png]]</p>
<p>æ¥æ”¶å‰ç«¯ä¿¡æ¯ä½¿ç”¨OrderSubmintDTO,è¿”å›ç»™å‰ç«¯æ•°æ®ä½¿ç”¨OrderSubmitVO</p>
<ol>
<li>
<p>ç”¨æˆ·ç«¯åˆ›å»ºController</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.user;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•</span></span><br><span class="line"><span class="comment"> * ç®¡ç†ç«¯ä¹Ÿéœ€è¦åˆ›å»ºOrderControllerå¯¹è®¢å•è¿›è¡Œæ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;userOrderController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/order&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;Cç«¯-è®¢å•æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;ç”¨æˆ·ä¸‹å•&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;OrderSubmitVO&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">		log.info(<span class="string">&quot;ç”¨æˆ·ä¸‹å•ï¼š&#123;&#125;&quot;</span>, ordersSubmitDTO);</span><br><span class="line">		<span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span> orderService.submitOrder(ordersSubmitDTO);</span><br><span class="line">		<span class="keyword">return</span> Result.success(orderSubmitVO);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ServiceImpl</p>
<ol>
<li>
<p>å¤„ç†å„ç§åŸå› çš„å¼‚å¸¸ã€åœ°å€è–„ä¸ºç©ºã€è´­ç‰©è½¦å•†å“ä¸ºç©ºã€‘</p>
<p>ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸åšè¿™ä¸ªåˆ¤æ–­å¤„ç†é—®é¢˜ä¹Ÿä¸å¤§ï¼Œå› ä¸ºå¦‚æœæ˜¯å°ç¨‹åºæäº¤è¿‡æ¥çš„è¯·æ±‚å…¶å®åœ¨å°ç¨‹åºé‚£ç«¯ä¹Ÿåšäº†åˆ¤æ–­ï¼ˆæ”¶è´§åœ°å€ä¸ºç©ºã€è´­ç‰©è½¦ä¸ºç©ºä¹Ÿæ˜¯ä¸èƒ½æäº¤æ•°æ®çš„ï¼‰ï¼Œä½†æ˜¯ä¸ºäº†ä»£ç çš„å¥å£®æ€§å»ºè®®åœ¨åç«¯è¿˜æ˜¯å¤šæ¬¡åˆ¤æ–­ä¸€ä¸‹ï¼Œå› ä¸ºç”¨æˆ·å¦‚æœå¹¶ä¸æ˜¯é€šè¿‡å°ç¨‹åºæäº¤çš„è€Œæ˜¯é€šè¿‡å…¶å®ƒçš„ä¸€äº›æ–¹å¼ æ¯”å¦‚postmanæ¥æäº¤è¿™äº›è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰ä»»ä½•æ ¡éªŒçš„ï¼Œæ­¤æ—¶åç«¯åœ¨ä¸æ ¡éªŒé‚£å†å¤„ç†çš„æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°å„ç§é—®é¢˜ã€‚</p>
</li>
<li>
<p>å‘è®¢å•è¡¨æ’å…¥1æ¡æ•°æ®</p>
</li>
<li>
<p>æ ¹æ®è¿”å›çš„idï¼Œå‘è®¢å•æ˜ç»†è¡¨æ’å…¥Næ¡æ•°æ®</p>
</li>
<li>
<p>ç„¶åæ¸…ç©ºè´­ç‰©è½¦</p>
</li>
<li>
<p>ç„¶åæ¸…ç©ºå½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®</p>
</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OrderDetailMapper orderDetailMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ShoppingCartMapper shoppingCartMapper;<span class="comment">// æ“ä½œåœ°å€ç°¿</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> AddressBookMapper addressBookMapper;<span class="comment">// æ“ä½œè´­ç‰©è½¦</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ordersSubmitDTO</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> OrderSubmitVO <span class="title function_">submitOrder</span><span class="params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">		<span class="comment">// 1. å¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼ˆæ”¶è´§åœ°å€ä¸ºç©ºã€è´­ç‰©è½¦ä¸ºç©ºï¼‰</span></span><br><span class="line">		<span class="comment">// 1.1 é€šè¿‡å‰ç«¯ä¼ é€’è¿‡æ¥çš„åœ°å€ç°¿idæŸ¥è¯¢æ•°æ®åº“æ˜¯å¦æœ‰æ”¶è´§åœ°å€ï¼Œå¦‚æœæŸ¥ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">		<span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());</span><br><span class="line">		<span class="keyword">if</span> (addressBook == <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);</span><br><span class="line">		<span class="comment">// 1.2 æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®ï¼ˆè´­ç‰©è½¦ä¸ºç©ºä¹Ÿä¸èƒ½æ­£å¸¸ä¸‹å•ï¼‰</span></span><br><span class="line">		<span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">		<span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">		shoppingCart.setUserId(userId);</span><br><span class="line">		List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);</span><br><span class="line">		<span class="keyword">if</span> (shoppingCartList == <span class="literal">null</span> || shoppingCartList.isEmpty())</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2.å‘è®¢å•è¡¨æ’å…¥1æ¡æ•°æ®ï¼ˆç”¨æˆ·ä¸ç®¡ä¹°å¤šå°‘ä¸ªå•†å“ï¼Œåªè¦å®ƒæäº¤å°±æ˜¯ä¸€ä¸ªè®¢å•ï¼Œå¯¹åº”ä¸€æ¡è®¢å•æ•°æ®ï¼‰</span></span><br><span class="line">		<span class="comment">// æ„é€ è®¢å•æ•°æ®</span></span><br><span class="line">		<span class="type">Orders</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">		BeanUtils.copyProperties(ordersSubmitDTO, order);</span><br><span class="line">		<span class="comment">// é€šè¿‡åœ°å€ç°¿è®¾ç½®æ”¶è´§äººåå­—ï¼Œæ”¶è´§åœ°å€ï¼Œæ‰‹æœºå·</span></span><br><span class="line">		order.setConsignee(addressBook.getConsignee()); <span class="comment">// æ”¶è´§äºº</span></span><br><span class="line">		order.setAddress(addressBook.getDetail());</span><br><span class="line">		order.setPhone(addressBook.getPhone());</span><br><span class="line">		<span class="comment">// è¦æ±‚æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œéœ€è¦è½¬åŒ–</span></span><br><span class="line">		order.setNumber(String.valueOf(System.currentTimeMillis())); <span class="comment">// è®¢å•å·ï¼Œä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´çš„æ—¶é—´æˆ³ç”Ÿæˆ</span></span><br><span class="line">		order.setUserId(userId); <span class="comment">// å½“å‰è®¢å•å±äºçš„ç”¨æˆ·</span></span><br><span class="line">		order.setStatus(Orders.PENDING_PAYMENT); <span class="comment">// è®¢å•çŠ¶æ€ï¼šæ­¤æ—¶æ˜¯å¾…ä»˜æ¬¾</span></span><br><span class="line">		order.setPayStatus(Orders.UN_PAID);<span class="comment">// æ”¯ä»˜çŠ¶æ€ï¼Œç”¨æˆ·åˆšå®Œæˆä¸‹å•æ‰€ä»¥æ˜¯æœªæ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">		order.setOrderTime(LocalDateTime.now());<span class="comment">// ä¸‹å•æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">		orderMapper.insert(order);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3.å‘è®¢å•æ˜ç»†è¡¨æ’å…¥næ¡æ•°æ®ï¼ˆå¯èƒ½æ˜¯ä¸€æ¡ä¹Ÿå¯èƒ½æ˜¯å¤šæ¡ï¼‰</span></span><br><span class="line">		ArrayList&lt;OrderDetail&gt; orderDetailList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (ShoppingCart cart : shoppingCartList) &#123;</span><br><span class="line">			<span class="comment">// ä¸€æ¡è´­ç‰©è½¦æ•°æ®å¯¹åº”å°è£…ä¸€ä¸ªè®¢å•æ˜ç»†å¯¹è±¡</span></span><br><span class="line">			<span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">			BeanUtils.copyProperties(cart, orderDetail);</span><br><span class="line">			<span class="comment">// é€šè¿‡åŠ¨æ€sqlè®¾ç½®å½“å‰è®¢å•æ˜ç»†è¡¨çš„è®¢å•id</span></span><br><span class="line">			orderDetail.setOrderId(order.getId());</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ–¹å¼ä¸€ï¼šå•æ¡æ•°æ®æ’å…¥ï¼Œéå†ä¸€æ¬¡æ’å…¥ä¸€æ¬¡</span></span><br><span class="line">			<span class="comment">// æ–¹å¼äºŒï¼šæ‰¹é‡æ’å…¥ï¼Œæ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè·å¾—çš„è®¢å•æ˜ç»†æ•°æ®ç»™å®ƒæ”¾åœ¨listé›†åˆé‡Œé¢ï¼Œç„¶åä¸€æ¬¡æ€§çš„æ‰¹é‡æ’å…¥ã€‚</span></span><br><span class="line">			orderDetailList.add(orderDetail);</span><br><span class="line">		&#125;</span><br><span class="line">		orderDetailMapper.insertBatch(orderDetailList); <span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 4.æ¸…ç†å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦ä¸­çš„æ•°æ®ï¼ˆç”¨æˆ·ä¸‹å•æˆåŠŸåï¼Œç”¨æˆ·çš„è¿™äº›è´­ç‰©è½¦ä¸­çš„æ•°æ®å°±ä¸éœ€è¦äº†ï¼‰</span></span><br><span class="line">		shoppingCartMapper.deleteByUserId(userId);<span class="comment">// å‰é¢è´­ç‰©è½¦æ¨¡å—å·²å®ç°</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 5.å°è£…VOè¿”å›ç»“æœ</span></span><br><span class="line">		<span class="type">OrderSubmitVO</span> <span class="variable">orderSubmitVO</span> <span class="operator">=</span> OrderSubmitVO.builder()</span><br><span class="line">				.id(order.getId())</span><br><span class="line">				.orderAmount(order.getAmount())</span><br><span class="line">				.orderNumber(order.getNumber())</span><br><span class="line">				.orderTime(order.getOrderTime())</span><br><span class="line">				.build();</span><br><span class="line">		<span class="keyword">return</span> orderSubmitVO;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åˆ›å»ºMapperä»¥åŠæ˜ å°„æ–‡ä»¶</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.OrderMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id=<span class="string">&quot;insert&quot;</span> parameterType=<span class="string">&quot;orders&quot;</span> useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">orders</span></span><br><span class="line">        <span class="params">(number, status, user_id, address_book_id, order_time, checkout_time, pay_method, pay_status, amount, remark,</span></span><br><span class="line"><span class="params">         phone, address, consignee, estimated_delivery_time, delivery_status, pack_amount, tableware_number,</span></span><br><span class="line"><span class="params">         tableware_status)</span></span><br><span class="line">        values (#&#123;number&#125;, #&#123;status&#125;, #&#123;userId&#125;, #&#123;addressBookId&#125;, #&#123;orderTime&#125;, #&#123;checkoutTime&#125;, #&#123;payMethod&#125;,</span><br><span class="line">                #&#123;payStatus&#125;, #&#123;amount&#125;, #&#123;remark&#125;, #&#123;phone&#125;, #&#123;address&#125;, #&#123;consignee&#125;,</span><br><span class="line">                #&#123;estimatedDeliveryTime&#125;, #&#123;deliveryStatus&#125;, #&#123;packAmount&#125;, #&#123;tablewareNumber&#125;, #&#123;tablewareStatus&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.OrderDetailMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert id=<span class="string">&quot;insertBatch&quot;</span> parameterType=<span class="string">&quot;list&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">order_detail</span></span><br><span class="line">        <span class="params">(name, order_id, dish_id, setmeal_id, dish_flavor, number, amount, image)</span></span><br><span class="line">        values</span><br><span class="line">            &lt;foreach collection=<span class="string">&quot;orderDetailList&quot;</span> item=<span class="string">&quot;od&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">                (#&#123;od.name&#125;,#&#123;od.orderId&#125;,#&#123;od.dishId&#125;,#&#123;od.setmealId&#125;,#&#123;od.dishFlavor&#125;,</span><br><span class="line">                #&#123;od.number&#125;,#&#123;od.amount&#125;,#&#123;od.image&#125;)</span><br><span class="line">            &lt;/foreach&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1>åäºŒã€è®¢å•æ”¯ä»˜</h1>
<p>è¦å®ç°å¾®ä¿¡æ”¯ä»˜å°±éœ€è¦æ³¨å†Œå¾®ä¿¡æ”¯ä»˜çš„ä¸€ä¸ª<strong>å•†æˆ·å·</strong>ï¼Œè¿™ä¸ªå•†æˆ·å·æ˜¯<strong>å¿…é¡»è¦æœ‰ä¸€å®¶ä¼ä¸šå¹¶ä¸”æœ‰æ­£è§„çš„è¥ä¸šæ‰§ç…§</strong>ã€‚åªæœ‰å…·å¤‡äº†è¿™äº›èµ„è´¨ä¹‹åï¼Œæ‰å¯ä»¥å»æ³¨å†Œå•†æˆ·å·ï¼Œæ‰èƒ½å¼€é€šæ”¯ä»˜æƒé™ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨ä¼ æ™ºæ³¨å†Œçš„å•†æˆ·å·æ¥å®Œæˆå¾®ä¿¡æ”¯ä»˜ï¼Œä»¥åè¿›å…¥åˆ°ä¼ä¸šå¼€å‘å¦‚æœéœ€è¦å®ç°å¾®ä¿¡æ”¯ä»˜åŠŸèƒ½ï¼Œåªéœ€è¦æ›¿æ¢ä¸€ä¸‹å•†æˆ·å·å°±å¯ä»¥äº†ã€‚</p>
<p>ç”±äºè¿™éƒ¨åˆ†ä»£ç æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”ä¸ªäººè´¦å·æ— æ³•ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ç›´æ¥å¯¼å…¥å°±å¥½</p>
<h2 id="12-1-å¾®ä¿¡æ”¯ä»˜ä»‹ç»">12.1 å¾®ä¿¡æ”¯ä»˜ä»‹ç»</h2>
<p><strong>å¾®ä¿¡æ”¯ä»˜äº§å“ï¼šå¤šç§æ”¯ä»˜çš„å½¢å¼</strong></p>
<ul>
<li>
<p>JSAPIæ”¯ä»˜ï¼šåœ¨h5åº”ç”¨ä¸­æ¯”å¦‚h5é¡µé¢è¦è¿›è¡Œå¾®ä¿¡æ”¯ä»˜ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è°ƒèµ·å¾®ä¿¡æ”¯ä»˜ã€‚</p>
</li>
<li>
<p>Nativeæ”¯ä»˜ï¼šäºŒç»´ç æ”¯ä»˜ï¼Œå¾®ä¿¡æ‰«ä¸€æ‰«å•†å®¶æä¾›çš„äºŒç»´ç è¿›è¡Œæ”¯ä»˜ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/6ac6080fb12f58f6e333cf6eceb2e009.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/6ac6080fb12f58f6e333cf6eceb2e009.png" alt=""></a></p>
<p>æœ¬é¡¹ç›®é€‰æ‹©<strong>å°ç¨‹åºæ”¯ä»˜</strong></p>
<p>å‚è€ƒï¼š<code>https://pay.weixin.qq.com/static/product/product_index.shtml</code></p>
<p>æ­¤ç½‘ç«™æ˜¯å¾®ä¿¡å®˜æ–¹ç»™æˆ‘ä»¬æä¾›çš„å«ä½œ<code>å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°</code>ï¼Œè¦å®ç°å¾®ä¿¡æ”¯ä»˜åŠŸèƒ½å°±éœ€è¦åˆ°è¿™ä¸ªå¹³å°ä¸Šé¢æ¥é˜…è¯»ï¼Œå®ƒç»™æˆ‘ä»¬æä¾›çš„ä¸€äº›æ–‡æ¡£ã€‚</p>
</li>
</ul>
<p><strong>å¾®ä¿¡æ”¯ä»˜æµç¨‹</strong></p>
<p>![[96054101c4bc339c68fd391a6f37e067.png]]</p>
<p><strong>å¾®ä¿¡æ”¯ä»˜æ—¶åºå›¾</strong></p>
<p>![[62ce4ed1ba9b4b27ba54b8038b808997.png]]</p>
<p>å…·ä½“æ”¯ä»˜æµç¨‹ï¼š</p>
<ol>
<li><strong>å¾®ä¿¡ç”¨æˆ·ä¸‹å•</strong>ï¼š1ã€2
<ul>
<li>ç”¨æˆ·åœ¨å¾®ä¿¡å°ç¨‹åºä¸­é€‰ä¸­å•†å“å¹¶ä¸‹å•ã€‚</li>
<li>å°ç¨‹åºå‘å•†æˆ·ç³»ç»Ÿå‘é€è¯·æ±‚ï¼Œè°ƒç”¨åç«¯æœåŠ¡çš„ä¸‹å•æ¥å£ã€‚</li>
</ul>
</li>
<li><strong>å•†æˆ·ç³»ç»Ÿç”Ÿæˆè®¢å•</strong>ï¼š3
<ul>
<li>å•†æˆ·ç³»ç»Ÿå¤„ç†ç”¨æˆ·ä¸‹å•è¯·æ±‚ï¼Œç”Ÿæˆè®¢å•æ•°æ®ï¼ˆåŒ…æ‹¬è®¢å• IDã€é‡‘é¢ã€æ—¶é—´ç­‰ï¼‰ï¼Œå¹¶è¿”å›ç»™å°ç¨‹åºã€‚</li>
</ul>
</li>
<li><strong>å¾®ä¿¡å°ç¨‹åºè¯·æ±‚æ”¯ä»˜</strong>ï¼š4
<ul>
<li>å°ç¨‹åºæ ¹æ®è¿”å›çš„è®¢å•æ•°æ®ï¼Œå‘èµ·æ”¯ä»˜è¯·æ±‚ï¼Œå‘å•†æˆ·ç³»ç»Ÿå‘é€æ”¯ä»˜è¯·æ±‚ã€‚</li>
</ul>
</li>
<li><strong>å•†æˆ·ç³»ç»Ÿè°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£</strong>ï¼š5
<ul>
<li>å•†æˆ·ç³»ç»Ÿæ¥æ”¶åˆ°å°ç¨‹åºå‘èµ·çš„æ”¯ä»˜è¯·æ±‚ï¼Œè°ƒç”¨å¾®ä¿¡åå°æä¾›çš„â€œä¸‹å•æ¥å£â€ï¼Œæäº¤å¿…è¦çš„å‚æ•°ï¼Œå¦‚ï¼š
<ul>
<li><strong>mchid</strong>ï¼šå•†æˆ·å·</li>
<li><strong>out_trade_no</strong>ï¼šè®¢å•å·ï¼ˆå½“å‰é¡¹ç›®ç³»ç»Ÿä¸­ä½¿ç”¨çš„æ˜¯æ—¶é—´æˆ³ä½œä¸ºè®¢å•å·ï¼‰</li>
<li><strong>appid</strong>ï¼šå°ç¨‹åºåº”ç”¨ID</li>
<li><strong>description</strong>ï¼šå•†å“æè¿°</li>
<li><strong>notify_url</strong>ï¼šå›è°ƒåœ°å€ã€‚å½“ç”¨æˆ·é€šè¿‡å¾®ä¿¡æ”¯ä»˜ä»˜æ¬¾æˆåŠŸä¹‹åï¼Œè¿™ä¸ªå¾®ä¿¡åå°å°±ä¼šè°ƒç”¨è¿™ä¸ªåœ°å€æ¥é€šçŸ¥æˆ‘ä»¬çš„ç¨‹åºï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€ä¸€èˆ¬æ˜¯å•†æˆ·ç³»ç»Ÿçš„è®¿é—®åœ°å€ã€‚</li>
<li><strong>amount</strong>ï¼šæ”¯ä»˜é‡‘é¢ã€‚totalï¼ˆå…·ä½“é‡‘é¢æ•°å­—ï¼‰ï¼Œcurrencyï¼ˆå¸ç§ï¼šäººæ°‘å¸ï¼Œç¾å…ƒç­‰ç­‰ï¼‰</li>
<li><strong>payer</strong>ï¼šä»˜æ¬¾ç”¨æˆ·çš„ <code>openid</code> ï¼ˆåœ¨å¾®ä¿¡ç™»å½•çš„æ—¶å€™å°±è·å–åˆ°äº†å¾®ä¿¡ç”¨æˆ·çš„openidï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><strong>å¾®ä¿¡åå°ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</strong>ï¼š6
<ul>
<li>ä¸€æ—¦è°ƒç”¨å®Œè¿™ä¸ªæ¥å£å¹¶æ²¡æœ‰å®Œæˆä»˜æ¬¾ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£å…¶å®æ˜¯å¾®ä¿¡åå°æ ¹æ®å•†æˆ·ç³»ç»Ÿæäº¤çš„å‚æ•°ï¼Œç”Ÿæˆä¸€ä¸ª<strong>é¢„æ”¯ä»˜äº¤æ˜“å•</strong>ï¼Œ<strong>å¹¶æ²¡æœ‰çœŸçš„å®Œæˆæ”¯ä»˜</strong>è€Œæ˜¯æå‰é€šçŸ¥å¾®ä¿¡å¸Œæœ›æœ‰é‚£ä¹ˆä¸€ä»½äº¤æ˜“ï¼Œä½ å…ˆè®°å½•ä¸€ä¸‹ï¼Œä¸€ä¼šå¾®ä¿¡ç”¨æˆ·ä¼šé€šè¿‡å°ç¨‹åºæ¥å®Œæˆè¿™ä»½äº¤æ˜“ï¼Œæ‰€ä»¥å«åšé¢„æ”¯ä»˜äº¤æ˜“å•ã€‚è°ƒç”¨å®Œæ­¤æ¥å£åä¼šè¿”å›ä¸€ä¸ª<strong>é¢„æ”¯ä»˜äº¤æ˜“æ ‡è¯†</strong>ï¼ˆprepay_idï¼‰ç»™å•†æˆ·ç³»ç»Ÿã€‚</li>
</ul>
</li>
<li><strong>å•†æˆ·ç³»ç»Ÿå¤„ç†å¹¶ç­¾å</strong>ï¼š7
<ul>
<li>å•†æˆ·ç³»ç»Ÿå¯¹è¿”å›çš„é¢„æ”¯ä»˜æ ‡è¯†è¿›è¡Œ<strong>æ•°æ®å¤„ç†å’Œç­¾å</strong>ï¼Œç­¾åçš„ç›®çš„å°±æ˜¯ä¸ºäº†å®‰å…¨ï¼Œå› ä¸ºæ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“æœ‰å¯èƒ½ä¼šè¢«åˆ«äººæˆªè·ï¼Œæ‰€ä»¥ä¼šå¯¹æ•°æ®è¿›è¡Œç­¾åä¿è¯æˆ‘ä»¬è¿™ä¸ªæ•°æ®çš„å®‰å…¨ã€‚</li>
</ul>
</li>
<li><strong>å•†æˆ·ç³»ç»Ÿå“åº”å°ç¨‹åº</strong>ï¼š8
<ul>
<li>å•†æˆ·ç³»ç»Ÿå°†å¤„ç†åçš„æ”¯ä»˜æ•°æ®ï¼ˆåŒ…æ‹¬ç­¾ååçš„æ•°æ®ï¼‰è¿”å›ç»™å°ç¨‹åºã€‚</li>
</ul>
</li>
<li><strong>å¾®ä¿¡å°ç¨‹åºè°ƒèµ·æ”¯ä»˜</strong>ï¼š9ã€10
<ul>
<li>è¿™äº›ç»è¿‡å¤„ç†åçš„å‚æ•°è¿”å›ç»™å‰ç«¯å°ç¨‹åºä¹‹åï¼Œç”¨æˆ·å°±éœ€è¦æ¥ç¡®è®¤æ”¯ä»˜ï¼Œå‰ç«¯ç¨‹åºä¼šè°ƒç”¨<code>wx.requestPayment</code>æ–¹æ³•ï¼ˆè¿™æ˜¯å°ç¨‹åºç«¯çš„ä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™éœ€è¦å¾ˆå¤šå‚æ•°ï¼Œè¿™äº›å‚æ•°æ¥è‡ªäº<strong>è°ƒç”¨é¢„æ”¯ä»˜äº¤æ˜“å•æ¥å£</strong>æ—¶è¿”å›ç»™å‰ç«¯å°ç¨‹åºå°è£…åçš„å‚æ•°ï¼ˆç¬¬7æ­¥ï¼‰ï¼Œï¼Œç„¶åè¿™äº›å°ç¨‹åºç›´æ¥ä½¿ç”¨è¿™äº›å‚æ•°ã€‚ä¸€æ—¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ‰‹æœºä¸Šå°±å¯ä»¥æ˜¾ç¤ºä»¥ä¸‹é¡µé¢æ•ˆæœï¼šå…¶å®å°±æ˜¯è°ƒèµ·äº†å¾®ä¿¡æ”¯ä»˜ã€‚</li>
<li>ç”¨æˆ·ç‚¹å‡»é¡µé¢ä¸Šçš„ç¡®è®¤æ”¯ä»˜æ˜¾ç¤ºè¾“å…¥å¯†ç ï¼Œå¯†ç è¾“å…¥å®Œæˆç‚¹å‡»ç¡®å®šä¹‹åå°±ä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚è¿™ä¸ªå¾®ä¿¡åå°ï¼Œ å¾®ä¿¡åå°å°±ä¼šè¿›è¡Œ<strong>çœŸæ­£çš„ä»˜æ¬¾æ“ä½œ</strong>ï¼Œä»˜æ¬¾æˆåŠŸä¹‹åå°±ä¼šç»™è¿™ä¸ªå°ç¨‹åºè¿”å›æ”¯ä»˜ç»“æœï¼Œåœ¨å°ç¨‹åºè¿™ç«¯å°±ä¼šæ˜¾ç¤ºæ”¯ä»˜ç»“æœï¼Œåˆ°è¿™é‡Œå°ç¨‹åºå®é™…ä¸Šå°±å®Œæˆäº†ä»˜æ¬¾ï¼ŒæŠŠé’±æ‰“åˆ°å•†æˆ·è¿™ä¸ªé“¶è¡Œå¡é‡Œé¢å»äº†ã€‚</li>
</ul>
</li>
<li><strong>æ”¯ä»˜æˆåŠŸï¼Œå¾®ä¿¡å›è°ƒé€šçŸ¥å•†æˆ·ç³»ç»Ÿ</strong>ï¼š11ã€12
<ul>
<li>åˆ°è¿™ä¸ªåœ°æ–¹å®é™…ä¸Šè¿˜æ²¡æœ‰å®Œï¼Œå› ä¸ºåˆšæ‰æ˜¯é€šè¿‡å¾®ä¿¡å°ç¨‹åºæ”¯ä»˜ï¼Œ ç›´æ¥ç»™æˆ‘ä»¬è¿™ä¸ªå¾®ä¿¡åå°æ¥è¿›è¡Œäº¤äº’å®Œæˆä»˜æ¬¾ï¼Œ<strong>ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹åå°å•†æˆ·ç³»ç»Ÿå¹¶ä¸çŸ¥é“</strong>ï¼Œåˆšæ‰ä½ è¿™ä¸ªå¾®ä¿¡ç”¨æˆ·æœ‰æ²¡æœ‰ä»˜æ¬¾ï¼Œæ˜¯ä»˜æ¬¾æˆåŠŸäº†è¿˜æ˜¯å¤±è´¥äº†è¿™ä¸ªåå°ç³»ç»Ÿæ ¹æœ¬å°±ä¸çŸ¥é“ã€‚</li>
<li>ç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œå¾®ä¿¡åå°ä¼šè°ƒç”¨å•†æˆ·ç³»ç»Ÿçš„ <code>notify_url</code> å›è°ƒæ¥å£ï¼Œé€šçŸ¥æ”¯ä»˜ç»“æœã€‚</li>
</ul>
</li>
<li><strong>å•†æˆ·ç³»ç»Ÿç¡®è®¤æ”¯ä»˜</strong>ï¼š13ã€14
<ul>
<li>å•†æˆ·ç³»ç»Ÿæ¥æ”¶æ”¯ä»˜æˆåŠŸé€šçŸ¥ï¼Œæ›´æ–°è®¢å•çŠ¶æ€ï¼Œå®Œæˆæ•´ä¸ªæ”¯ä»˜æµç¨‹ã€‚</li>
</ul>
</li>
</ol>
<p>æ€»ä½“æµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ·ä¸‹å•ï¼šå¯¹åº”1ã€2ã€3æ­¥</li>
<li>è°ƒç”¨é¢„æ”¯ä»˜æ¥å£ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼šå¯¹åº”4ã€5ã€6ã€7ã€8</li>
<li>å°ç¨‹åºç«¯å’Œåå°æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œè°ƒèµ·å¾®ä¿¡æ”¯ä»˜çœŸæ­£å®Œæˆäº†ä»˜æ¬¾ï¼šå¯¹åº”9ã€10ã€11ã€12</li>
<li>æ”¯ä»˜ç»“æœçš„æ¨é€ï¼šå¾®ä¿¡åå°ä¼šè°ƒç”¨å•†æˆ·ç³»ç»Ÿçš„æŸä¸€ä¸ªåœ°å€ï¼Œä»è€ŒæŠŠç»“æœé€šçŸ¥ç»™å•†æˆ·ç³»ç»Ÿï¼Œç„¶åå•†æˆ·ç³»ç»Ÿå»æ›´æ–°è¿™ä¸ªè®¢å•çš„æ”¯ä»˜çŠ¶æ€ã€‚å¯¹åº”13ã€14ã€‚</li>
</ol>
<p><strong>å¾®ä¿¡æ”¯ä»˜ç›¸å…³æ¥å£ï¼š</strong></p>
<ul>
<li>
<p><strong><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/docs/merchant/apis/jsapi-payment/direct-jsons/jsapi-prepay.html">JSAPIä¸‹å•</a></strong>ï¼šå•†æˆ·ç³»ç»Ÿè°ƒç”¨è¯¥æ¥å£åœ¨å¾®ä¿¡æ”¯ä»˜æœåŠ¡åå°ç”Ÿæˆ<code>é¢„æ”¯ä»˜äº¤æ˜“å•</code>(å¯¹åº”æ—¶åºå›¾çš„<code>ç¬¬5æ­¥</code>)</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/805b2c49a2b69f4fbf59dbbaa46ae6a8.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/805b2c49a2b69f4fbf59dbbaa46ae6a8.png" alt=""></a></p>
<ul>
<li>urlæ˜¯å¾®ä¿¡å®˜æ–¹ç»™æˆ‘ä»¬æä¾›çš„ä¸€ä¸ªæ¥å£åœ°å€ã€‚</li>
<li>mchidï¼šå•†æˆ·å·</li>
<li>è¿”å›ç»“æœä¸ºé¢„æ”¯ä»˜äº¤æ˜“æ ‡è¯†prepay_idï¼šå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p>æ³¨æ„ï¼šè°ƒç”¨å®Œè¿™ä¸ªæ¥å£å¹¶æ²¡æœ‰å®ŒæˆçœŸæ­£äº†ä»˜æ¬¾ï¼Œåªæ˜¯ç”Ÿæˆä¸€ä¸ªé¢„æ”¯ä»˜äº¤æ˜“å•å¹¶æ²¡æœ‰çœŸçš„å®Œæˆæ”¯ä»˜ï¼Œç›¸å½“äºæå‰é€šçŸ¥å¾®ä¿¡å¸Œæœ›æœ‰è¿™ä»½äº¤æ˜“ï¼Œä½ å…ˆè®°å½•ä¸€ä¸‹ï¼Œä¹‹åå¾®ä¿¡ç”¨æˆ·ä¼šé€šè¿‡å°ç¨‹åºæ¥å®Œæˆè¿™ä»½äº¤æ˜“ï¼Œæ‰€ä»¥å«åšé¢„æ”¯ä»˜äº¤æ˜“å•ï¼Œç›¸å½“äºå…ˆåœ¨å¾®ä¿¡è¿™è¾¹å…ˆè¿›è¡Œä¸€ä¸ªå¤‡æ¡ˆã€‚</p>
</li>
<li>
<p><strong><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/docs/merchant/apis/mini-program-payment/mini-transfer-payment.html">å¾®ä¿¡å°ç¨‹åºè°ƒèµ·æ”¯ä»˜ï¼ˆé¡µé¢ä¸­çš„jsæ–¹æ³•ï¼‰</a></strong>ï¼šé€šè¿‡JSAPIä¸‹å•æ¥å£è·å–åˆ°å‘èµ·æ”¯ä»˜çš„å¿…è¦å‚æ•°prepay_idï¼Œç„¶åä½¿ç”¨å¾®ä¿¡æ”¯ä»˜æä¾›çš„å°ç¨‹åºæ–¹æ³•è°ƒèµ·å°ç¨‹åºæ”¯ä»˜(å¯¹åº”æ—¶åºå›¾çš„<code>ç¬¬10æ­¥</code>)</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/51500f792adfa5b548600d3c9ef4295e.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/51500f792adfa5b548600d3c9ef4295e.png" alt=""></a></p>
<ul>
<li>çœŸæ­£å®Œæˆäº†ä»˜æ¬¾ã€‚</li>
<li>è¿™äº›å‚æ•°éƒ½æ˜¯åç«¯è®¡ç®—å¥½è¿”å›ç»™æˆ‘ä»¬å°ç¨‹åºï¼Œå°ç¨‹åºç›´æ¥ä½¿ç”¨è¿™äº›å‚æ•°å³å¯ã€‚</li>
</ul>
</li>
</ul>
<h2 id="12-2-å¾®ä¿¡æ”¯ä»˜å‡†å¤‡åŠŸèƒ½">12.2 å¾®ä¿¡æ”¯ä»˜å‡†å¤‡åŠŸèƒ½</h2>
<h3 id="12-2-1-è·å¾—å¾®ä¿¡ç»™çš„ä¸¤ä¸ªæ–‡ä»¶">12.2.1 è·å¾—å¾®ä¿¡ç»™çš„ä¸¤ä¸ªæ–‡ä»¶</h3>
<h3 id="å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ"><strong>å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ</strong></h3>
<p>å®Œæˆå¾®ä¿¡æ”¯ä»˜æœ‰ä¸¤ä¸ªå…³é”®çš„æ­¥éª¤ï¼š</p>
<p><strong>ç¬¬ä¸€ä¸ª</strong>å°±æ˜¯éœ€è¦åœ¨å•†æˆ·ç³»ç»Ÿå½“ä¸­è°ƒç”¨å¾®ä¿¡åå°çš„ä¸€ä¸ªä¸‹å•æ¥å£ï¼Œå°±æ˜¯<strong>ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</strong>ã€‚5</p>
<p><strong>ç¬¬äºŒä¸ª</strong>å°±æ˜¯æ”¯ä»˜æˆåŠŸä¹‹åå¾®ä¿¡åå°ä¼šç»™<strong>æ¨é€æ¶ˆæ¯</strong>ã€‚13</p>
<p>è¿™ä¸¤ä¸ªæ¥å£æ•°æ®çš„å®‰å…¨æ€§ï¼Œè¦æ±‚å…¶å®æ˜¯éå¸¸é«˜çš„ã€‚</p>
<p><strong>è§£å†³</strong>ï¼šå¾®ä¿¡æä¾›çš„æ–¹å¼å°±æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€ç­¾åå¤šç§æ–¹å¼ã€‚è¦å®Œæˆæ•°æ®åŠ å¯†è§£å¯†ï¼Œéœ€è¦æå‰å‡†å¤‡ç›¸åº”çš„ä¸€äº›æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€äº›è¯ä¹¦ã€‚</p>
<p><strong>è·å–å¾®ä¿¡æ”¯ä»˜å¹³å°è¯ä¹¦ã€å•†æˆ·ç§é’¥æ–‡ä»¶ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/de39ff98204adc310fb898487be30a7c.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/de39ff98204adc310fb898487be30a7c.png" alt=""></a></p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¿™2ä¸ªæ–‡ä»¶æ˜¯ä»å¾®ä¿¡çš„å•†æˆ·å¹³å°ä¸‹è½½ä¸‹æ¥çš„ï¼Œåœ¨åç»­ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šä½¿ç”¨åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…·ä½“å¦‚ä½•ç”¨ ä»£ç æ€ä¹ˆå†™ åé¢åœ¨è¯´ï¼Œç°åœ¨æå‰æŠŠè¿™ä¸¤ä¸ªæ–‡ä»¶å‡†å¤‡å¥½ã€‚</li>
<li>å‰æï¼šå¿…é¡»è¦æœ‰ä¸€å®¶ä¼ä¸šå¹¶ä¸”æœ‰æ­£è§„çš„è¥ä¸šæ‰§ç…§</li>
</ul>
<h3 id="12-2-2-å†…ç½‘ç©¿é€">12.2.2 å†…ç½‘ç©¿é€</h3>
<p>å¦‚ä½•è°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿï¼ˆcpolarï¼‰</p>
<p>å¾®ä¿¡åå°ä¼šè°ƒç”¨åˆ°å•†æˆ·ç³»ç»Ÿç»™æ¨é€æ”¯ä»˜çš„ç»“æœï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¾®ä¿¡åå°æ€ä¹ˆå°±èƒ½è°ƒç”¨åˆ°æˆ‘ä»¬è¿™ä¸ªå•†æˆ·ç³»ç»Ÿå‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ã€‚</p>
<p>ç›®å‰ï¼Œå•†æˆ·ç³»ç»Ÿå®ƒçš„ipåœ°å€å°±æ˜¯å½“å‰è‡ªå·±ç”µè„‘çš„ipåœ°å€ï¼Œåªæ˜¯ä¸€ä¸ªå±€åŸŸç½‘å†…çš„ipåœ°å€ï¼Œå¾®ä¿¡åå°æ— æ³•è°ƒç”¨åˆ°ã€‚</p>
<p>è§£å†³ï¼šå†…ç½‘ç©¿é€ã€‚é€šè¿‡cpolarè½¯ä»¶å¯ä»¥è·å¾—ä¸€ä¸ªä¸´æ—¶åŸŸåï¼Œè€Œè¿™ä¸ªä¸´æ—¶åŸŸåæ˜¯ä¸€ä¸ªå…¬ç½‘ipï¼Œè¿™æ ·ï¼Œå¾®ä¿¡åå°å°±å¯ä»¥è¯·æ±‚åˆ°å•†æˆ·ç³»ç»Ÿäº†ã€‚</p>
<p>æ³¨æ„ï¼šå½“å‰å¼€å‘é˜¶æ®µç”µè„‘å¤§éƒ¨åˆ†éƒ½åœ¨å±€åŸŸç½‘ä¹‹å†…å¹¶æ²¡æœ‰å…¬ç½‘ipï¼Œæ‰€ä»¥éœ€è¦è¿™ç§æ–¹å¼è·å¾—ä¸€ä¸ªä¸´æ—¶åŸŸåï¼Œä½†æ˜¯æœ€ç»ˆé¡¹ç›®ä¸Šçº¿ä¹‹åä¸€èˆ¬éƒ½ä¼šæœ‰å…¬ç½‘ipï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å…¬ç½‘ipå³å¯ã€‚</p>
<p>è§£å†³ä¸ªäººæµ‹è¯•çš„æ—¶å€™ï¼Œå¾®ä¿¡æ— æ³•è®¿é—®æˆ‘ä»¬æœ¬æœºIPçš„é—®é¢˜</p>
<p>1). å®‰è£…cpolarï¼š<a target="_blank" rel="noopener" href="https://www.cpolar.com/">cpolar - å®‰å…¨çš„å†…ç½‘ç©¿é€å·¥å…·</a></p>
<p><strong>2). cpolaræŒ‡å®šauthtoken</strong></p>
<p>å¤åˆ¶authtokenï¼š</p>
<p>OGQ4ZmNmNDUtOTg1NC00MTEyLTk5YzMtNmM2NTg3ODI0OGM3</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼šæ³¨æ„<code>./cpolar authtoken ...</code>æ˜¯linuxä¸‹çš„å‘½ä»¤ã€‚</p>
<p>![[bbb0dd47edafc3e70c6829a497f1d4e9.png]]</p>
<ul>
<li>å›è½¦åä¼šåœ¨cç›˜ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œå³å†…ç½‘ç©¿é€å·¥å…·çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ï¼ˆåªæ•´ä¸€æ¬¡å°±è¡Œï¼‰</li>
</ul>
<p>![[/image 1 44.png|image 1 44.png]]</p>
<p><strong>3). è·å–ä¸´æ—¶åŸŸå</strong></p>
<p>åœ¨ä½ å®‰è£…çš„cpolarç›®å½•ä¸‹æ‰§è¡Œ</p>
<p>ä¸ºä»€ä¹ˆè®¾ç½®8080ï¼šå› ä¸ºåç«¯æœåŠ¡çš„ç«¯å£å·å°±æ˜¯8080</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼š<code>cpolar.exe http 8080</code></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/cc93e283cd82ea08bfe578656d38050a.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/cc93e283cd82ea08bfe578656d38050a.png" alt=""></a></p>
<p>è·å–åŸŸåï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/53fa92b4807f93b2d1b677be7798ccad.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/53fa92b4807f93b2d1b677be7798ccad.png" alt=""></a></p>
<p><strong>4). éªŒè¯ä¸´æ—¶åŸŸåæœ‰æ•ˆæ€§</strong></p>
<p><strong>ä¹‹å‰è®¿é—®æ¥å£æ–‡æ¡£</strong><a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p>
<p>ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸´æ—¶åŸŸåè®¿é—®ï¼š<code>åŸŸå/doc.html</code> <a target="_blank" rel="noopener" href="http://48ce14a4.r25.cpolar.top/doc.html">http://48ce14a4.r25.cpolar.top/doc.html</a></p>
<p>![[b7075f5c656fc0d4c974f2d610b4beaf.png]]</p>
<p>è¯æ˜ä¸´æ—¶åŸŸåç”Ÿæ•ˆã€‚</p>
<h2 id="12-3-å¯¼å…¥å¾®ä¿¡æ”¯ä»˜ä»£ç "><strong>12.3 å¯¼å…¥å¾®ä¿¡æ”¯ä»˜ä»£ç </strong></h2>
<p><strong>é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¾®ä¿¡æ”¯ä»˜é…ç½®</strong></p>
<blockquote>
<p>è¯´æ˜ï¼šyamlä¸­èƒ½æœ‰è¿™äº›å±æ€§ï¼Œæ˜¯å› ä¸ºå®šä¹‰äº†é…ç½®ç±» ã€é‡Œé¢çš„éƒ½æ˜¯åˆ«äººçš„æ•°æ®ï¼Œéœ€è¦æ”¹æˆè‡ªå·±çš„ã€‘</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sky:</span><br><span class="line">    wechat:</span><br><span class="line">    appid: wxb2fc7d534365dfc5</span><br><span class="line">    secret: d117b81fc08e17a0fcee03cb407d70c6</span><br><span class="line">    mchid: <span class="number">1561414331</span> \#ä¼ æ™ºæ’­å®¢ç”³è¯·çš„å•†æˆ·å·</span><br><span class="line">    mchSerialNo: OGQ4ZmNmNDUtOTg1NC00MTEyLTk5YzMtNmM2NTg3ODI0OGM3 \#è¯ä¹¦çš„åºåˆ—å·</span><br><span class="line">    privateKeyFilePath: D:\apiclient_key.pem \#ç§é’¥æ–‡ä»¶ï¼ˆä¸æ˜¯ä¼ä¸š æ²¡æœ‰ï¼‰</span><br><span class="line">    apiV3Key: CZBK51236435wxpay435434323FFDuv3 \#è§£å¯†çš„ç§˜é’¥ï¼ˆå•†æˆ·å¹³å°è®¾ç½® ä¸€èˆ¬å…¬å¸æä¾›å¥½ä¸ç”¨è‡ªå·±æ‰‹åŠ¨é…ç½®ï¼‰</span><br><span class="line">    weChatPayCertFilePath: D:\wechatpay_166D96F876F45C7D07CE98952A96EC980368ACFC.pem \#å¹³å°è¯ä¹¦æ–‡ä»¶</span><br><span class="line">    notifyUrl: https:<span class="comment">//www.weixin.qq.com/wxpay/pay.php \#æ”¯ä»˜æˆåŠŸçš„å›è°ƒï¼ˆåŸŸååœ°å€+controllerçš„è®¿é—®è·¯å¾„ï¼‰</span></span><br><span class="line">    refundNotifyUrl: https:<span class="comment">//www.weixin.qq.com/wxpay/pay.php \#é€€æ¬¾æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">    sky:</span><br><span class="line">  wechat:</span><br><span class="line">    appid: $&#123;sky.wechat.appid&#125;</span><br><span class="line">    secret: $&#123;sky.wechat.secret&#125;</span><br><span class="line">    mchid : $&#123;sky.wechat.mchid&#125;</span><br><span class="line">    mchSerialNo: $&#123;sky.wechat.mchSerialNo&#125;</span><br><span class="line">    privateKeyFilePath: $&#123;sky.wechat.privateKeyFilePath&#125;</span><br><span class="line">    apiV3Key: $&#123;sky.wechat.apiV3Key&#125;</span><br><span class="line">    weChatPayCertFilePath: $&#123;sky.wechat.weChatPayCertFilePath&#125;</span><br><span class="line">    notifyUrl: $&#123;sky.wechat.notifyUrl&#125;</span><br><span class="line">    refundNotifyUrl: $&#123;sky.wechat.refundNotifyUrl&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ä»£ç </p>
<p>WeChatProperties.javaï¼šè¯»å–é…ç½®(å·²å®šä¹‰)</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.wechat&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChatProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String appid; <span class="comment">//å°ç¨‹åºçš„appid</span></span><br><span class="line">    <span class="keyword">private</span> String secret; <span class="comment">//å°ç¨‹åºçš„ç§˜é’¥</span></span><br><span class="line">    <span class="keyword">private</span> String mchid; <span class="comment">//å•†æˆ·å·</span></span><br><span class="line">    <span class="keyword">private</span> String mchSerialNo; <span class="comment">//å•†æˆ·APIè¯ä¹¦çš„è¯ä¹¦åºåˆ—å·</span></span><br><span class="line">    <span class="keyword">private</span> String privateKeyFilePath; <span class="comment">//å•†æˆ·ç§é’¥æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> String apiV3Key; <span class="comment">//è¯ä¹¦è§£å¯†çš„å¯†é’¥</span></span><br><span class="line">    <span class="keyword">private</span> String weChatPayCertFilePath; <span class="comment">//å¹³å°è¯ä¹¦</span></span><br><span class="line">    <span class="keyword">private</span> String notifyUrl; <span class="comment">//æ”¯ä»˜æˆåŠŸçš„å›è°ƒåœ°å€</span></span><br><span class="line">    <span class="keyword">private</span> String refundNotifyUrl; <span class="comment">//é€€æ¬¾æˆåŠŸçš„å›è°ƒåœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrdersPaymentDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//è®¢å•å·</span></span><br><span class="line">    <span class="keyword">private</span> String orderNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»˜æ¬¾æ–¹å¼</span></span><br><span class="line">    <span class="keyword">private</span> Integer payMethod;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>PayNotifyController.javaï¼šæ”¯ä»˜æˆåŠŸåå¾®ä¿¡åå°ä¼šå›è°ƒè¿™ä¸ªcontroller</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.notify;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.json.JSONUtils;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.IgnoreToken;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.WeChatProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> com.wechat.pay.contrib.apache.httpclient.util.AesUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ContentType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ”¯ä»˜å›è°ƒç›¸å…³æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/notify&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayNotifyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WeChatProperties weChatProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜æˆåŠŸå›è°ƒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/paySuccess&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccessNotify</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> readData(request);</span><br><span class="line">        log.info(<span class="string">&quot;æ”¯ä»˜æˆåŠŸå›è°ƒï¼š&#123;&#125;&quot;</span>, body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">plainText</span> <span class="operator">=</span> decryptData(body);</span><br><span class="line">        log.info(<span class="string">&quot;è§£å¯†åçš„æ–‡æœ¬ï¼š&#123;&#125;&quot;</span>, plainText);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(plainText);</span><br><span class="line">        <span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;out_trade_no&quot;</span>);<span class="comment">//å•†æˆ·å¹³å°è®¢å•å·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">transactionId</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;transaction_id&quot;</span>);<span class="comment">//å¾®ä¿¡æ”¯ä»˜äº¤æ˜“å·</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;å•†æˆ·å¹³å°è®¢å•å·ï¼š&#123;&#125;&quot;</span>, outTradeNo);</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡æ”¯ä»˜äº¤æ˜“å·ï¼š&#123;&#125;&quot;</span>, transactionId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸šåŠ¡å¤„ç†ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€ã€æ¥å•æé†’</span></span><br><span class="line">        orderService.paySuccess(outTradeNo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»™å¾®ä¿¡å“åº”</span></span><br><span class="line">        responseToWeixin(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">readData</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> request.getReader();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                result.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            result.append(line);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è§£å¯†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">decryptData</span><span class="params">(String body)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resultObject</span> <span class="operator">=</span> JSON.parseObject(body);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resource</span> <span class="operator">=</span> resultObject.getJSONObject(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ciphertext</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;ciphertext&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">nonce</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;nonce&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">associatedData</span> <span class="operator">=</span> resource.getString(<span class="string">&quot;associated_data&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">AesUtil</span> <span class="variable">aesUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AesUtil</span>(weChatProperties.getApiV3Key().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="comment">//å¯†æ–‡è§£å¯†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">plainText</span> <span class="operator">=</span> aesUtil.decryptToString(associatedData.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">                nonce.getBytes(StandardCharsets.UTF_8),</span><br><span class="line">                ciphertext);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> plainText;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™å¾®ä¿¡å“åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">responseToWeixin</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        response.setStatus(<span class="number">200</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-type&quot;</span>, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        response.getOutputStream().write(JSONUtils.toJSONString(map).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        response.flushBuffer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨OrderController.javaä¸­æ·»åŠ paymentæ–¹æ³•</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ”¯ä»˜ï¼ˆç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/payment&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;è®¢å•æ”¯ä»˜&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderPaymentVO&gt; <span class="title function_">payment</span><span class="params">(<span class="meta">@RequestBody</span> OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    log.info(<span class="string">&quot;è®¢å•æ”¯ä»˜ï¼š&#123;&#125;&quot;</span>, ordersPaymentDTO);</span><br><span class="line">    <span class="comment">//å¯¹åº”ç¬¬4æ­¥</span></span><br><span class="line">    <span class="type">OrderPaymentVO</span> <span class="variable">orderPaymentVO</span> <span class="operator">=</span> orderService.payment(ordersPaymentDTO);</span><br><span class="line">    log.info(<span class="string">&quot;ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼š&#123;&#125;&quot;</span>, orderPaymentVO);</span><br><span class="line">    <span class="comment">//å¯¹åº”ç¬¬8æ­¥</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(orderPaymentVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨åˆ°çš„å¾®ä¿¡æ”¯ä»˜å·¥å…·ç±»</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.WeChatProperties;</span><br><span class="line"><span class="keyword">import</span> com.wechat.pay.contrib.apache.httpclient.WechatPayHttpClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.wechat.pay.contrib.apache.httpclient.util.PemUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.RandomStringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ContentType;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.Signature;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾®ä¿¡æ”¯ä»˜å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChatPayUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾®ä¿¡æ”¯ä»˜ä¸‹å•æ¥å£åœ°å€ï¼ˆç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JSAPI</span> <span class="operator">=</span> <span class="string">&quot;https://api.mch.weixin.qq.com/v3/pay/transactions/jsapi&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”³è¯·é€€æ¬¾æ¥å£åœ°å€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REFUNDS</span> <span class="operator">=</span> <span class="string">&quot;https://api.mch.weixin.qq.com/v3/refund/domestic/refunds&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WeChatProperties weChatProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è°ƒç”¨å¾®ä¿¡æ¥å£çš„å®¢æˆ·ç«¯å·¥å…·å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> CloseableHttpClient <span class="title function_">getClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">merchantPrivateKey</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//merchantPrivateKeyå•†æˆ·APIç§é’¥ï¼Œå¦‚ä½•åŠ è½½å•†æˆ·APIç§é’¥è¯·çœ‹å¸¸è§é—®é¢˜</span></span><br><span class="line">            merchantPrivateKey = PemUtil.loadPrivateKey(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(weChatProperties.getPrivateKeyFilePath())));</span><br><span class="line">            <span class="comment">//åŠ è½½å¹³å°è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">            <span class="type">X509Certificate</span> <span class="variable">x509Certificate</span> <span class="operator">=</span> PemUtil.loadCertificate(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(weChatProperties.getWeChatPayCertFilePath())));</span><br><span class="line">            <span class="comment">//wechatPayCertificateså¾®ä¿¡æ”¯ä»˜å¹³å°è¯ä¹¦åˆ—è¡¨ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨åé¢ç« èŠ‚æåˆ°çš„â€œå®šæ—¶æ›´æ–°å¹³å°è¯ä¹¦åŠŸèƒ½â€ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå¹³å°è¯ä¹¦çš„æ¥é¾™å»è„‰</span></span><br><span class="line">            List&lt;X509Certificate&gt; wechatPayCertificates = Arrays.asList(x509Certificate);</span><br><span class="line"></span><br><span class="line">            <span class="type">WechatPayHttpClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> WechatPayHttpClientBuilder.create()</span><br><span class="line">                    .withMerchant(weChatProperties.getMchid(), weChatProperties.getMchSerialNo(), merchantPrivateKey)</span><br><span class="line">                    .withWechatPay(wechatPayCertificates);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€šè¿‡WechatPayHttpClientBuilderæ„é€ çš„HttpClientï¼Œä¼šè‡ªåŠ¨çš„å¤„ç†ç­¾åå’ŒéªŒç­¾</span></span><br><span class="line">            <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> builder.build();</span><br><span class="line">            <span class="keyword">return</span> httpClient;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€postæ–¹å¼è¯·æ±‚ï¼šåº•å±‚ä½¿ç”¨çš„è¿˜æ˜¯httpClientå‘èµ·çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">post</span><span class="params">(String url, String body)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//æ„é€ httpClientå¯¹è±¡ï¼šè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ç”Ÿæˆçš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> getClient();</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line">        <span class="comment">//è®¾ç½®çš„è¯·æ±‚å¤´</span></span><br><span class="line">        httpPost.addHeader(HttpHeaders.ACCEPT, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        httpPost.addHeader(HttpHeaders.CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        httpPost.addHeader(<span class="string">&quot;Wechatpay-Serial&quot;</span>, weChatProperties.getMchSerialNo());</span><br><span class="line">        httpPost.setEntity(<span class="keyword">new</span> <span class="title class_">StringEntity</span>(body, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpPost);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">bodyAsString</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            <span class="keyword">return</span> bodyAsString;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            httpClient.close();</span><br><span class="line">            response.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€getæ–¹å¼è¯·æ±‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">get</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> getClient();</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">        httpGet.addHeader(HttpHeaders.ACCEPT, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        httpGet.addHeader(HttpHeaders.CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());</span><br><span class="line">        httpGet.addHeader(<span class="string">&quot;Wechatpay-Serial&quot;</span>, weChatProperties.getMchSerialNo());</span><br><span class="line"></span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">bodyAsString</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            <span class="keyword">return</span> bodyAsString;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            httpClient.close();</span><br><span class="line">            response.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jsapiä¸‹å•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderNum    å•†æˆ·è®¢å•å·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> total       æ€»é‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description å•†å“æè¿°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openid      å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">jsapi</span><span class="params">(String orderNum, BigDecimal total, String description, String openid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;appid&quot;</span>, weChatProperties.getAppid());<span class="comment">//è¯»å–çš„é…ç½®æ–‡ä»¶  Appid</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;mchid&quot;</span>, weChatProperties.getMchid());<span class="comment">//è¯»å–çš„é…ç½®æ–‡ä»¶  å•†æˆ·å·</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;description&quot;</span>, description); <span class="comment">//å‚æ•°ä¼ é€’è¿‡æ¥çš„  æè¿°ä¿¡æ¯</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNum); <span class="comment">//å‚æ•°ä¼ é€’è¿‡æ¥çš„  è®¢å•å·</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;notify_url&quot;</span>, weChatProperties.getNotifyUrl());<span class="comment">//è¯»å–çš„é…ç½®æ–‡ä»¶  é€€æ¬¾æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        amount.put(<span class="string">&quot;total&quot;</span>, total.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>)).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).intValue());</span><br><span class="line">        amount.put(<span class="string">&quot;currency&quot;</span>, <span class="string">&quot;CNY&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jsonObject.put(<span class="string">&quot;amount&quot;</span>, amount); <span class="comment">//è®¢å•é‡‘é¢</span></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">payer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        payer.put(<span class="string">&quot;openid&quot;</span>, openid);</span><br><span class="line"></span><br><span class="line">        jsonObject.put(<span class="string">&quot;payer&quot;</span>, payer); <span class="comment">//å‚æ•°ä¼ é€’è¿‡æ¥çš„   æ”¯ä»˜è€…</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨ä¸Šé¢è¿™ä¸ªpostæ–¹æ³•ï¼Œå‚æ•°ï¼šç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•çš„æ¥å£åœ°å€ï¼ˆæœ¬ç±»ä¸­å®šä¹‰çš„å¸¸é‡ï¼‰ã€å°è£…çš„è¯·æ±‚å‚æ•°</span></span><br><span class="line">        <span class="comment">//    postæ–¹æ³•ä½œç”¨ï¼šåº•å±‚ä½¿ç”¨çš„è¿˜æ˜¯httpClientå‘èµ·çš„è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> post(JSAPI, body);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°ç¨‹åºæ”¯ä»˜ï¼šåŠ å¯†ç›¸å…³çš„ä»£ç éƒ½æ˜¯å›ºå®šçš„ï¼Œä»¥åæƒ³è¦ä½¿ç”¨çš„è¯ç›´æ¥å¤åˆ¶å³å¯ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderNum    å•†æˆ·è®¢å•å·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> total       é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> description å•†å“æè¿°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openid      å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">pay</span><span class="params">(String orderNum, BigDecimal total, String description, String openid)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//ç»Ÿä¸€ä¸‹å•ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•</span></span><br><span class="line">        <span class="comment">//jsapiæ–¹æ³•ï¼ˆä¸Šé¢è¿™ä¸ªæ–¹æ³•å°±æ˜¯ï¼‰ï¼šå°è£…çš„æ˜¯è°ƒç”¨å¾®ä¿¡ä¸‹å•æ¥å£ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•æ¥å£æ—¶æ‰€éœ€è¦çš„å‚æ•°</span></span><br><span class="line">        <span class="comment">//bodyAsStringï¼šè¿”å›çš„æ˜¯é¢„æ”¯ä»˜æ ‡è¯†ï¼Œæ˜¯ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">bodyAsString</span> <span class="operator">=</span> jsapi(orderNum, total, description, openid);</span><br><span class="line">        <span class="comment">//è§£æè¿”å›ç»“æœï¼šéœ€è¦æŠŠè¿™ä¸ªé¢„æ”¯ä»˜æ ‡è¯†è½¬åŒ–ä¸ºjson</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(bodyAsString);</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–prepayIdé¢„æ”¯ä»˜æ ‡è¯†çš„å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prepayId</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;prepay_id&quot;</span>);</span><br><span class="line">        <span class="comment">//å°è£…ä¸€ç³»åˆ—çš„æ•°æ®ï¼Œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å¹¶ä¸”ç­¾å</span></span><br><span class="line">        <span class="keyword">if</span> (prepayId != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">timeStamp</span> <span class="operator">=</span> String.valueOf(System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">nonceStr</span> <span class="operator">=</span> RandomStringUtils.randomNumeric(<span class="number">32</span>);</span><br><span class="line">            ArrayList&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            list.add(weChatProperties.getAppid());</span><br><span class="line">            list.add(timeStamp);</span><br><span class="line">            list.add(nonceStr);</span><br><span class="line">            list.add(<span class="string">&quot;prepay_id=&quot;</span> + prepayId);</span><br><span class="line">            <span class="comment">//äºŒæ¬¡ç­¾åï¼Œè°ƒèµ·æ”¯ä»˜éœ€è¦é‡æ–°ç­¾å</span></span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (Object o : list) &#123;</span><br><span class="line">                stringBuilder.append(o).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">signMessage</span> <span class="operator">=</span> stringBuilder.toString();</span><br><span class="line">            <span class="type">byte</span>[] message = signMessage.getBytes();</span><br><span class="line"></span><br><span class="line">            <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256withRSA&quot;</span>);</span><br><span class="line">            signature.initSign(PemUtil.loadPrivateKey(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(weChatProperties.getPrivateKeyFilePath()))));</span><br><span class="line">            signature.update(message);</span><br><span class="line">            <span class="type">String</span> <span class="variable">packageSign</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(signature.sign());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ„é€ æ•°æ®ç»™å¾®ä¿¡å°ç¨‹åºï¼Œç”¨äºè°ƒèµ·å¾®ä¿¡æ”¯ä»˜</span></span><br><span class="line">            <span class="comment">// å‰ç«¯å¾®ä¿¡å°ç¨‹åºè°ƒç”¨wx.requestPaymentæ–¹æ³•éœ€è¦ä¼ é€’çš„å‚æ•°ï¼Œå°è£…å¥½ä¹‹åä¼ é€’ç»™å‰ç«¯å°ç¨‹åº</span></span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">jo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">            jo.put(<span class="string">&quot;timeStamp&quot;</span>, timeStamp);</span><br><span class="line">            jo.put(<span class="string">&quot;nonceStr&quot;</span>, nonceStr);</span><br><span class="line">            jo.put(<span class="string">&quot;package&quot;</span>, <span class="string">&quot;prepay_id=&quot;</span> + prepayId);</span><br><span class="line">            jo.put(<span class="string">&quot;signType&quot;</span>, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">            jo.put(<span class="string">&quot;paySign&quot;</span>, packageSign);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> jo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”³è¯·é€€æ¬¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outTradeNo    å•†æˆ·è®¢å•å·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outRefundNo   å•†æˆ·é€€æ¬¾å•å·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> refund        é€€æ¬¾é‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> total         åŸè®¢å•é‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">refund</span><span class="params">(String outTradeNo, String outRefundNo, BigDecimal refund, BigDecimal total)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;out_trade_no&quot;</span>, outTradeNo);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;out_refund_no&quot;</span>, outRefundNo);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        amount.put(<span class="string">&quot;refund&quot;</span>, refund.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>)).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).intValue());</span><br><span class="line">        amount.put(<span class="string">&quot;total&quot;</span>, total.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>)).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).intValue());</span><br><span class="line">        amount.put(<span class="string">&quot;currency&quot;</span>, <span class="string">&quot;CNY&quot;</span>);</span><br><span class="line"></span><br><span class="line">        jsonObject.put(<span class="string">&quot;amount&quot;</span>, amount);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;notify_url&quot;</span>, weChatProperties.getRefundNotifyUrl());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨ç”³è¯·é€€æ¬¾æ¥å£</span></span><br><span class="line">        <span class="keyword">return</span> post(REFUNDS, body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨OrderServiceImpl.javaä¸­å®ç°paymentå’ŒpaySuccessä¸¤ä¸ªæ–¹æ³•</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> WeChatPayUtil weChatPayUtil;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è®¢å•æ”¯ä»˜</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> OrderPaymentVO <span class="title function_">payment</span><span class="params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">//1.è·å–å½“å‰ç™»å½•ç”¨æˆ·idï¼Œä¹‹åæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“æŠŠç”¨æˆ·æ•°æ®æŸ¥è¯¢å‡ºæ¥</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(userId);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//2.è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£å·¥å…·ç±»ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼ˆå¯¹åº”ç¬¬5æ­¥ï¼‰</span></span><br><span class="line">       <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> weChatPayUtil.pay(</span><br><span class="line">               ordersPaymentDTO.getOrderNumber(), <span class="comment">//å•†æˆ·è®¢å•å·</span></span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>), <span class="comment">//æ”¯ä»˜é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line">               <span class="string">&quot;è‹ç©¹å¤–å–è®¢å•&quot;</span>, <span class="comment">//å•†å“æè¿°</span></span><br><span class="line">               user.getOpenid() <span class="comment">//å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (jsonObject.getString(<span class="string">&quot;code&quot;</span>) != <span class="literal">null</span> &amp;&amp; jsonObject.getString(<span class="string">&quot;code&quot;</span>).equals(<span class="string">&quot;ORDERPAID&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è¯¥è®¢å•å·²æ”¯ä»˜&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3.è½¬åŒ–ä¸ºvoå¯¹è±¡åœ¨è¿”å›ç»™controller</span></span><br><span class="line">       <span class="type">OrderPaymentVO</span> <span class="variable">vo</span> <span class="operator">=</span> jsonObject.toJavaObject(OrderPaymentVO.class);</span><br><span class="line">       vo.setPackageStr(jsonObject.getString(<span class="string">&quot;package&quot;</span>));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> vo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> outTradeNo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getByNumber(outTradeNo);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span></span><br><span class="line">       <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">               .id(ordersDB.getId())</span><br><span class="line">               .status(Orders.TO_BE_CONFIRMED)</span><br><span class="line">               .payStatus(Orders.PAID)</span><br><span class="line">               .checkoutTime(LocalDateTime.now())</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       orderMapper.update(orders);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨OrderMapper.xmlä¸­æ·»åŠ </strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">&quot;update&quot;</span> parameterType=<span class="string">&quot;com.sky.entity.Orders&quot;</span>&gt;</span><br><span class="line">     update orders</span><br><span class="line">     &lt;set&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;cancelReason != null and cancelReason!=&#x27;&#x27; &quot;</span>&gt;</span><br><span class="line">             cancel_reason=#&#123;cancelReason&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;rejectionReason != null and rejectionReason!=&#x27;&#x27; &quot;</span>&gt;</span><br><span class="line">             rejection_reason=#&#123;rejectionReason&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;cancelTime != null&quot;</span>&gt;</span><br><span class="line">             cancel_time=#&#123;cancelTime&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;payStatus != null&quot;</span>&gt;</span><br><span class="line">             pay_status=#&#123;payStatus&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;payMethod != null&quot;</span>&gt;</span><br><span class="line">             pay_method=#&#123;payMethod&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;checkoutTime != null&quot;</span>&gt;</span><br><span class="line">             checkout_time=#&#123;checkoutTime&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">             status = #&#123;status&#125;,</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">         &lt;<span class="keyword">if</span> test=<span class="string">&quot;deliveryTime != null&quot;</span>&gt;</span><br><span class="line">             delivery_time = #&#123;deliveryTime&#125;</span><br><span class="line">         &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">     &lt;/set&gt;</span><br><span class="line">     <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line"> &lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨OrderMapper.javaä¸­æ·»åŠ getByNumberAndUserIdå’Œupdateä¸¤ä¸ªæ–¹æ³•</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> orderNumber</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Select(&quot;select * from orders where number = #&#123;orderNumber&#125;&quot;)</span></span><br><span class="line"> Orders <span class="title function_">getByNumber</span><span class="params">(String orderNumber)</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ä¿®æ”¹è®¢å•çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Orders orders)</span>;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨UserMapperä¸­æ·»åŠ getByIdæ–¹æ³•</strong></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®ä¸»é”®æŸ¥ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">getById</span><span class="params">(Long userId)</span>;</span><br></pre></td></tr></table></figure>
<p>æ­¥éª¤è¯´æ˜ï¼š</p>
<ul>
<li>è°ƒç”¨é¢„æ”¯ä»˜æ¥å£ç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼šå¯¹åº”4ã€5ã€6ã€7ã€8
<ul>
<li>
<p>æ§åˆ¶å±‚æ–¹æ³•ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/71035b7739b50cb8f6a14f0d82d1b92f.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/71035b7739b50cb8f6a14f0d82d1b92f.png" alt=""></a></p>
</li>
<li>
<p>ç”¨åˆ°çš„DTOï¼šè®¢å•å·ã€ä»˜æ¬¾æ–¹å¼ï¼ˆå› ä¸ºå½“å‰åªæä¾›äº†ä¸€ç§æ”¯ä»˜æ–¹å¼ï¼Œå¾®ä¿¡å°ç¨‹åºæ”¯ä»˜ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°æ²¡æœ‰ç”¨åˆ°ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/ebaf3f77a4c8bd45da06aed732c337da.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/ebaf3f77a4c8bd45da06aed732c337da.png" alt=""></a></p>
</li>
<li>
<p>ä¸šåŠ¡å±‚æ–¹æ³•ï¼šè·å–ç”¨æˆ·æ•°æ®ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼Œè½¬åŒ–ä¸ºvoå¯¹è±¡åœ¨è¿”å›ç»™controller</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/2e030a808635867a1bf9478c181cc43a.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/2e030a808635867a1bf9478c181cc43a.png" alt=""></a></p>
</li>
<li>
<p>ç”¨åˆ°çš„å·¥å…·ç±»ï¼šå±‚å±‚è°ƒç”¨ï¼Œpayâ€”ã€‹jsapiâ€”ã€‹post----ã€‹getClient</p>
<p>![[9f6bd6e787150084cbae818d1a31ed6e.png]]</p>
</li>
</ul>
</li>
</ul>
<p>æ”¯ä»˜æˆåŠŸå›è°ƒï¼šä¿®æ”¹åå°è®¢å•çŠ¶æ€</p>
<ul>
<li>
<p>æ§åˆ¶å±‚ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/ad4eb0b5b3ba606cd663d81b41c0551e.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/ad4eb0b5b3ba606cd663d81b41c0551e.png" alt=""></a></p>
</li>
<li>
<p>ä¸šåŠ¡å±‚ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/22ed21cd6584ae9d62c4e99afc902cf6.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/22ed21cd6584ae9d62c4e99afc902cf6.png" alt=""></a></p>
</li>
</ul>
</li>
</ul>
<h3 id="è§£å†³æ²¡æœ‰å•†æˆ·å·é—®é¢˜"><strong>è§£å†³æ²¡æœ‰å•†æˆ·å·é—®é¢˜</strong></h3>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>è¦å®ç°å¾®ä¿¡æ”¯ä»˜å°±éœ€è¦æ³¨å†Œå¾®ä¿¡æ”¯ä»˜çš„ä¸€ä¸ªå•†æˆ·å·ï¼Œè¿™ä¸ªå•†æˆ·å·æ˜¯å¿…é¡»è¦æœ‰ä¸€å®¶ä¼ä¸šå¹¶ä¸”æœ‰æ­£è§„çš„è¥ä¸šæ‰§ç…§ã€‚</li>
<li>ä¸ªäººæ²¡åŠæ³•è·å¾—å•†æˆ·å·ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä¿®æ”¹å‰åç«¯ä»£ç è·³è¿‡å¾®ä¿¡æ”¯ä»˜æ¥å£ï¼Œç‚¹å‡»å¾®ä¿¡æ”¯ä»˜ç›´æ¥ç°æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸï¼Œä¹‹åä¿®æ”¹è®¢å•çš„çŠ¶æ€ã€‚</li>
</ul>
<h3 id="å‰ç«¯å°ç¨‹åºä¿®æ”¹"><strong>å‰ç«¯å°ç¨‹åºä¿®æ”¹</strong></h3>
<p>ä¿®æ”¹ä¸ºï¼šç‚¹å‡»æ”¯ä»˜æŒ‰é’®åç›´æ¥è·³è½¬æ”¯ä»˜æˆåŠŸ</p>
<ul>
<li>
<p>é¦–å…ˆåœ¨å¾®ä¿¡å°ç¨‹åºé‡Œçš„payåŒ…ä¸‹çš„index.jsä¸­å°†å¦‚ä¸‹çš„ä»£ç æ³¨é‡Šæ‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/382c3ef4a8577e25297420a0914854f5.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/382c3ef4a8577e25297420a0914854f5.png" alt=""></a></p>
</li>
<li>
<p>ç„¶åæŠŠåŸå…ˆæ³¨é‡Šæ‰çš„é‡å®šå‘è§£é™¤ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/1c70bde4afd8bd31e217d4c96077154c.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/1c70bde4afd8bd31e217d4c96077154c.png" alt=""></a></p>
</li>
</ul>
<h3 id="åç«¯ä¿®æ”¹"><strong>åç«¯ä¿®æ”¹</strong></h3>
<p>ä¿®æ”¹ä¸ºï¼šè¦æ±‚åœ¨æ”¶åˆ°å‰ç«¯æ”¯ä»˜æ“ä½œåï¼Œä¸è¿›è¡Œä»»ä½•åˆ¤æ–­ï¼Œç›´æ¥ç»™æ•°æ®åº“è®¾ç½®å·²æ”¯ä»˜çŠ¶æ€ã€‚</p>
<ul>
<li>
<p>æŠŠservice/implä¸‹çš„OrderServiceImplä¸­çš„å¦‚ä¸‹ä»£ç æ³¨é‡Šæ‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/926a0507e403d0466b963fa22aa51648.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/926a0507e403d0466b963fa22aa51648.png" alt=""></a></p>
</li>
<li>
<p>åŒæ ·åœ¨OrderServiceImplä¸­ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼Œç”¨äºè®¾ç½®å‚æ•°ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/74345ecb1425f5c8afc4749f9410445e.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/74345ecb1425f5c8afc4749f9410445e.png" alt=""></a></p>
</li>
</ul>
<p>å®Œæ•´çš„è®¢å•æ”¯ä»˜ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•æ”¯ä»˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ordersPaymentDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderPaymentVO <span class="title function_">payment</span><span class="params">(OrdersPaymentDTO ordersPaymentDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.è·å–å½“å‰ç™»å½•ç”¨æˆ·idï¼Œä¹‹åæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“æŠŠç”¨æˆ·æ•°æ®æŸ¥è¯¢å‡ºæ¥</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(userId);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*        //2.è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£å·¥å…·ç±»ï¼Œç”Ÿæˆé¢„æ”¯ä»˜äº¤æ˜“å•ï¼ˆå¯¹åº”ç¬¬5æ­¥ï¼‰</span></span><br><span class="line"><span class="comment">        JSONObject jsonObject = weChatPayUtil.pay(</span></span><br><span class="line"><span class="comment">                ordersPaymentDTO.getOrderNumber(), //å•†æˆ·è®¢å•å·</span></span><br><span class="line"><span class="comment">                new BigDecimal(0.01), //æ”¯ä»˜é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line"><span class="comment">                &quot;è‹ç©¹å¤–å–è®¢å•&quot;, //å•†å“æè¿°</span></span><br><span class="line"><span class="comment">                user.getOpenid() //å¾®ä¿¡ç”¨æˆ·çš„openid</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        if (jsonObject.getString(&quot;code&quot;) != null &amp;&amp; jsonObject.getString(&quot;code&quot;).equals(&quot;ORDERPAID&quot;)) &#123;</span></span><br><span class="line"><span class="comment">            throw new OrderBusinessException(&quot;è¯¥è®¢å•å·²æ”¯ä»˜&quot;);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        //3.è½¬åŒ–ä¸ºvoå¯¹è±¡åœ¨è¿”å›ç»™controller</span></span><br><span class="line"><span class="comment">        OrderPaymentVO vo = jsonObject.toJavaObject(OrderPaymentVO.class);</span></span><br><span class="line"><span class="comment">        vo.setPackageStr(jsonObject.getString(&quot;package&quot;));*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;ORDERPAID&quot;</span>);</span><br><span class="line">        <span class="type">OrderPaymentVO</span> <span class="variable">vo</span> <span class="operator">=</span> jsonObject.toJavaObject(OrderPaymentVO.class);</span><br><span class="line">        vo.setPackageStr(jsonObject.getString(<span class="string">&quot;package&quot;</span>));</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">OrderPaidStatus</span> <span class="operator">=</span> Orders.PAID;<span class="comment">//æ”¯ä»˜çŠ¶æ€ï¼Œå·²æ”¯ä»˜</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">OrderStatus</span> <span class="operator">=</span> Orders.TO_BE_CONFIRMED;  <span class="comment">//è®¢å•çŠ¶æ€ï¼Œå¾…æ¥å•</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">check_out_time</span> <span class="operator">=</span> LocalDateTime.now();<span class="comment">//æ›´æ–°æ”¯ä»˜æ—¶é—´</span></span><br><span class="line">        <span class="comment">//è·å¾—çš„æ˜¯Stringç±»å‹ï¼Œéœ€è¦çš„æ˜¯Longç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬åŒ–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderidS</span> <span class="operator">=</span> ordersPaymentDTO.getOrderNumber();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">orderidL</span> <span class="operator">=</span>Long.parseLong(orderidS);<span class="comment">//è·å–è®¢å•å·</span></span><br><span class="line">        orderMapper.updateStatus(OrderStatus, OrderPaidStatus, check_out_time,orderidL );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> vo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨OrderMapperä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰‹åŠ¨ä¿®æ”¹è®¢å•çŠ¶æ€ï¼šè§£å†³ä¸ªäººæ²¡æœ‰å•†æˆ·å·ä¸èƒ½æµ‹è¯•è®¢å•æ”¯ä»˜é—®é¢˜</span></span><br><span class="line"><span class="meta">@Update(&quot;update orders set status = #&#123;orderStatus&#125;,pay_status = #&#123;orderPaidStatus&#125; ,checkout_time = #&#123;check_out_time&#125; &quot; +</span></span><br><span class="line"><span class="meta">        &quot;where number = #&#123;orderidL&#125;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateStatus</span><span class="params">(Integer orderStatus, Integer orderPaidStatus, LocalDateTime check_out_time, Long orderidL)</span>;</span><br></pre></td></tr></table></figure>
<p>![[/image 2 37.png|image 2 37.png]]</p>
<h1>åä¸‰ã€<strong>ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—&amp;å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—&amp;åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</strong></h1>
<h2 id="13-1-ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—">13.1 <strong>ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</strong></h2>
<p>![[50ac82770dbf8bb975032a97d0641e57.png]]</p>
<h3 id="13-1-1-åˆ†é¡µæŸ¥è¯¢å†å²è®¢å•">13.1.1 åˆ†é¡µæŸ¥è¯¢å†å²è®¢å•</h3>
<p>![[/image 3 33.png|image 3 33.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/historyOrders&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†å²è®¢å•åˆ†é¡µæŸ¥è¯¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">	<span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.pageOuery4User(ordersPageQueryDTO);</span><br><span class="line">	<span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageOuery4User</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> ordersPageQueryDTO.getPage();</span><br><span class="line">	<span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> ordersPageQueryDTO.getPageSize();</span><br><span class="line">	PageHelper.startPage(pageNum, pageSize);</span><br><span class="line"></span><br><span class="line">	<span class="type">OrdersPageQueryDTO</span> <span class="variable">ordersPageQueryDTO1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersPageQueryDTO</span>();</span><br><span class="line">	ordersPageQueryDTO1.setUserId(BaseContext.getCurrentId());</span><br><span class="line">	ordersPageQueryDTO1.setStatus(ordersPageQueryDTO.getStatus());</span><br><span class="line"></span><br><span class="line">	Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO1);</span><br><span class="line"></span><br><span class="line">	ArrayList&lt;OrderVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥è¯¢å‡ºè®¢å•æ˜ç»†ï¼Œå¹¶å°è£…å…¥OrderVOè¿›è¡Œå“åº”</span></span><br><span class="line">	<span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.getTotal() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (Orders order : page) &#123;</span><br><span class="line">			<span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> order.getId();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æŸ¥è¯¢è®¢å•æ˜ç»†</span></span><br><span class="line">			List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">			<span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">			BeanUtils.copyProperties(order, orderVO);</span><br><span class="line">			orderVO.setOrderDetailList(orderDetails);</span><br><span class="line"></span><br><span class="line">			list.add(orderVO);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), list);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageOuery4User</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">pageNum</span> <span class="operator">=</span> ordersPageQueryDTO.getPage();</span><br><span class="line">	<span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> ordersPageQueryDTO.getPageSize();</span><br><span class="line">	PageHelper.startPage(pageNum, pageSize);</span><br><span class="line"></span><br><span class="line">	<span class="type">OrdersPageQueryDTO</span> <span class="variable">ordersPageQueryDTO1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrdersPageQueryDTO</span>();</span><br><span class="line">	ordersPageQueryDTO1.setUserId(BaseContext.getCurrentId());</span><br><span class="line">	ordersPageQueryDTO1.setStatus(ordersPageQueryDTO.getStatus());</span><br><span class="line"></span><br><span class="line">	Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO1);</span><br><span class="line"></span><br><span class="line">	ArrayList&lt;OrderVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥è¯¢å‡ºè®¢å•æ˜ç»†ï¼Œå¹¶å°è£…å…¥OrderVOè¿›è¡Œå“åº”</span></span><br><span class="line">	<span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.getTotal() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (Orders order : page) &#123;</span><br><span class="line">			<span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> order.getId();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æŸ¥è¯¢è®¢å•æ˜ç»†</span></span><br><span class="line">			List&lt;OrderDetail&gt; orderDetails = orderDetailMapper.getByOrderId(orderId);</span><br><span class="line"></span><br><span class="line">			<span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">			BeanUtils.copyProperties(order, orderVO);</span><br><span class="line">			orderVO.setOrderDetailList(orderDetails);</span><br><span class="line"></span><br><span class="line">			list.add(orderVO);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;pageQuery&quot;</span> resultType=<span class="string">&quot;Orders&quot;</span>&gt;</span><br><span class="line">      select * from orders</span><br><span class="line">      &lt;where&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;number != null and number!=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">              and number like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;number&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;phone != null and phone!=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">              and phone like <span class="title function_">concat</span><span class="params">(<span class="string">&#x27;%&#x27;</span>,#&#123;phone&#125;,<span class="string">&#x27;%&#x27;</span>)</span></span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;userId != null&quot;</span>&gt;</span><br><span class="line">              <span class="type">and</span> <span class="variable">user_id</span> <span class="operator">=</span> #&#123;userId&#125;</span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">              <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;beginTime != null&quot;</span>&gt;</span><br><span class="line">              and order_time &amp;gt;= #&#123;beginTime&#125;</span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">          &lt;<span class="keyword">if</span> test=<span class="string">&quot;endTime != null&quot;</span>&gt;</span><br><span class="line">              and order_time &amp;lt;= #&#123;endTime&#125;</span><br><span class="line">          &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">      &lt;/where&gt;</span><br><span class="line">      order by order_time desc</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from order_detail where order_id = #&#123;orderId&#125;&quot;)</span></span><br><span class="line">List&lt;OrderDetail&gt; <span class="title function_">getByOrderId</span><span class="params">(Long orderId)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="13-1-2-æŸ¥è¯¢è®¢å•è¯¦æƒ…">13.1.2 æŸ¥è¯¢è®¢å•è¯¦æƒ…</h3>
<p>GET/user/order/orderDetail/{id}</p>
<p>![[3fa52e4bbf000548ecea7a39c428a50e.png]]</p>
<p>![[/image 4 32.png|image 4 32.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/orderDetail/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">details</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">	<span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.details(id);</span><br><span class="line">	<span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> OrderVO <span class="title function_">details</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">	<span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥è¯¢è¯¥è®¢å•å¯¹åº”çš„èœå“/å¥—é¤æ˜ç»†</span></span><br><span class="line">	List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†è¯¥è®¢å•åŠå…¶è¯¦æƒ…å°è£…åˆ°OrderVOå¹¶è¿”å›</span></span><br><span class="line">	<span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">	BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">	orderVO.setOrderDetailList(orderDetailList);</span><br><span class="line">	<span class="keyword">return</span> orderVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-1-3-å–æ¶ˆè®¢å•">13.1.3 å–æ¶ˆè®¢å•</h3>
<p>PUT/user/order/cancel/{id}</p>
<p>![[/image 5 29.png|image 5 29.png]]</p>
<ul>
<li>å¾…æ”¯ä»˜å’Œå¾…æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å¯ç›´æ¥å–æ¶ˆè®¢å•</li>
<li>å•†å®¶å·²æ¥å•çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶</li>
<li>æ´¾é€ä¸­çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·å–æ¶ˆè®¢å•éœ€ç”µè¯æ²Ÿé€šå•†å®¶</li>
<li>å¦‚æœåœ¨å¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆè®¢å•ï¼Œéœ€è¦ç»™ç”¨æˆ·é€€æ¬¾</li>
<li>å–æ¶ˆè®¢å•åéœ€è¦å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/cancal/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cacel</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	orderService.userCancelById(id);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userCancelById</span><span class="params">(Long id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€éªŒè®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">	<span class="keyword">if</span> (ordersDB == <span class="literal">null</span>)</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3å·²æ¥å• 4æ´¾é€ä¸­ 5å·²å®Œæˆ 6å·²å–æ¶ˆ</span></span><br><span class="line">	<span class="keyword">if</span> (ordersDB.getStatus() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä»¥ä¸ŠéªŒè¯éƒ½é€šè¿‡åï¼Œæ­¤æ—¶è®¢å•å¤„äºå¾…æ”¯ä»˜å’Œå¾…æ¥å•çŠ¶æ€ä¸‹</span></span><br><span class="line">	<span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">	orders.setId(ordersDB.getId());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¢å•å¤„äºå¾…æ¥å•çŠ¶æ€ä¸‹å–æ¶ˆï¼Œéœ€è¦è¿›è¡Œé€€æ¬¾</span></span><br><span class="line">	<span class="keyword">if</span> (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;</span><br><span class="line">		<span class="comment">// è°ƒç”¨å¾®ä¿¡æ”¯ä»˜é€€æ¬¾æ¥å£</span></span><br><span class="line">		weChatPayUtil.refund( <span class="comment">// éœ€è¦æ·»åŠ å¼‚å¸¸</span></span><br><span class="line">				ordersDB.getNumber(), <span class="comment">// å•†æˆ·è®¢å•å·</span></span><br><span class="line">				ordersDB.getNumber(), <span class="comment">// å•†æˆ·é€€æ¬¾å•å·</span></span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>),<span class="comment">// é€€æ¬¾é‡‘é¢ï¼Œå•ä½ å…ƒ</span></span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>));<span class="comment">// åŸè®¢å•é‡‘é¢</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ”¯ä»˜çŠ¶æ€ä¿®æ”¹ä¸º é€€æ¬¾</span></span><br><span class="line">		orders.setPayStatus(Orders.REFUND);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">	orders.setStatus(Orders.CANCELLED);</span><br><span class="line">	orders.setCancelReason(<span class="string">&quot;ç”¨æˆ·å–æ¶ˆ&quot;</span>);</span><br><span class="line">	orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">	orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ²¡åŠæ³•æµ‹è¯•ï¼Œéœ€è¦è°ƒç”¨è°ƒç”¨<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98&amp;spm=1001.2101.3001.7020">å¾®ä¿¡æ”¯ä»˜</a>é€€æ¬¾æ¥å£ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°æ”¯ä»˜åŠŸèƒ½ï¼Œå› ä¸ºä¸ªäººæ²¡æœ‰èµ„è´¨ç”³è¯·å•†æˆ·å·ã€‚</p>
<h3 id="13-1-4-å†æ¥ä¸€å•">13.1.4 å†æ¥ä¸€å•</h3>
<p>å°±æ˜¯å°†åŸè®¢å•ä¸­çš„å•†å“é‡æ–°åŠ å…¥åˆ°è´­ç‰©è½¦ä¸­</p>
<p>ä¹Ÿæ˜¯id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/repetition/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å†æ¥ä¸€å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">repetition</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">	orderService.repetition(id);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">repetition</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">	<span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">	List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(id);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†è®¢å•å¯¹è±¡è½¬æ¢ä¸ºè´­ç‰©è½¦å¯¹è±¡</span></span><br><span class="line">	List&lt;ShoppingCart&gt; shoppingCartList = orderDetailList.stream().map(x -&gt; &#123;</span><br><span class="line">		<span class="type">ShoppingCart</span> <span class="variable">shoppingCart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line"></span><br><span class="line">		BeanUtils.copyProperties(x, shoppingCart, <span class="string">&quot;id&quot;</span>); <span class="comment">// id å±æ€§å°†ä¸ä¼šè¢«å¤åˆ¶</span></span><br><span class="line">		shoppingCart.setUserId(userId);</span><br><span class="line">		shoppingCart.setCreateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> shoppingCart;</span><br><span class="line">	&#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†è´­ç‰©è½¦å¯¹è±¡æ‰¹é‡æ·»åŠ åˆ°æ•°æ®åº“</span></span><br><span class="line">	shoppingCartMapper.insertBatch(shoppingCartList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   &lt;insert id=<span class="string">&quot;insertBatch&quot;</span> parameterType=<span class="string">&quot;list&quot;</span>&gt;</span><br><span class="line">       insert into <span class="title function_">shopping_cart</span></span><br><span class="line">       <span class="params">(name, image, user_id, dish_id, setmeal_id, dish_flavor, number, amount, create_time)</span></span><br><span class="line">       values</span><br><span class="line">       &lt;foreach collection=<span class="string">&quot;shoppingCartList&quot;</span> item=<span class="string">&quot;sc&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">           (#&#123;sc.name&#125;,#&#123;sc.image&#125;,#&#123;sc.userId&#125;,#&#123;sc.dishId&#125;,#&#123;sc.setmealId&#125;,#&#123;sc.dishFlavor&#125;,#&#123;sc.number&#125;,#&#123;sc.amount&#125;,#&#123;sc.createTime&#125;)</span><br><span class="line">       &lt;/foreach&gt;</span><br><span class="line">   &lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<h2 id="13-2-å•†å®¶è®¢å•ç®¡ç†æ¨¡å—">13.2 å•†å®¶è®¢å•ç®¡ç†æ¨¡å—</h2>
<h3 id="13-2-1-è®¢å•æœç´¢">13.2.1 è®¢å•æœç´¢</h3>
<ul>
<li>è¾“å…¥è®¢å•å·/æ‰‹æœºå·è¿›è¡Œæœç´¢ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢</li>
<li>æ ¹æ®è®¢å•çŠ¶æ€è¿›è¡Œç­›é€‰</li>
<li>ä¸‹å•æ—¶é—´è¿›è¡Œæ—¶é—´ç­›é€‰</li>
<li>æœç´¢å†…å®¹ä¸ºç©ºï¼Œæç¤ºæœªæ‰¾åˆ°ç›¸å…³è®¢å•</li>
<li>æœç´¢ç»“æœé¡µï¼Œå±•ç¤ºåŒ…å«æœç´¢å…³é”®è¯çš„å†…å®¹</li>
<li>åˆ†é¡µå±•ç¤ºæœç´¢åˆ°çš„è®¢å•æ•°æ®</li>
</ul>
<p>![[/image 6 26.png|image 6 26.png]]</p>
<p>adminä¸‹åˆ›å»º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/conditionSearch&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;è®¢å•æœç´¢&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">	<span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> orderService.conditionSearch(ordersPageQueryDTO);</span><br><span class="line">	<span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">conditionSearch</span><span class="params">(OrdersPageQueryDTO ordersPageQueryDTO)</span> &#123;</span><br><span class="line">	PageHelper.startPage(ordersPageQueryDTO.getPage(), ordersPageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">	Page&lt;Orders&gt; page = orderMapper.pageQuery(ordersPageQueryDTO);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// éƒ¨åˆ†è®¢å•çŠ¶æ€ï¼Œéœ€è¦é¢å¤–è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œå°†Ordersè½¬åŒ–ä¸ºOrderVO</span></span><br><span class="line">	List&lt;OrderVO&gt; orderVOList = getOrderVOList(page);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), orderVOList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;OrderVO&gt; <span class="title function_">getOrderVOList</span><span class="params">(Page&lt;Orders&gt; page)</span> &#123;</span><br><span class="line">	<span class="comment">// éœ€è¦è¿”å›è®¢å•èœå“ä¿¡æ¯ï¼Œè‡ªå®šä¹‰OrderVOå“åº”ç»“æœ</span></span><br><span class="line">	ArrayList&lt;OrderVO&gt; orderVOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">	List&lt;Orders&gt; ordersList = page.getResult();</span><br><span class="line">	<span class="comment">// if (ordersList != null) &#123; // ä»…åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">	<span class="keyword">if</span> (!CollectionUtils.isEmpty(ordersList)) &#123; <span class="comment">// ordersList ä¸æ˜¯ nullï¼Œå¹¶ä¸”è‡³å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">		<span class="keyword">for</span> (Orders orders : ordersList) &#123;</span><br><span class="line">			<span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderVO</span>();</span><br><span class="line">			BeanUtils.copyProperties(orders, orderVO);</span><br><span class="line">			<span class="type">String</span> <span class="variable">orderDishes</span> <span class="operator">=</span> getOrderDishStr(orders);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// å°†è®¢å•èœå“ä¿¡æ¯å°è£…åˆ°orderVOä¸­ï¼Œå¹¶æ·»åŠ åˆ°orderVOList</span></span><br><span class="line">			orderVO.setOrderDishes(orderDishes);</span><br><span class="line">			orderVOList.add(orderVO);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> orderVOList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è®¢å•idè·å–èœå“ä¿¡æ¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getOrderDishStr</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line">	<span class="comment">// æŸ¥è¯¢è®¢å•èœå“è¯¦æƒ…ä¿¡æ¯ï¼ˆè®¢å•ä¸­çš„èœå“å’Œæ•°é‡ï¼‰</span></span><br><span class="line">	List&lt;OrderDetail&gt; orderDetailList = orderDetailMapper.getByOrderId(orders.getId());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†æ¯ä¸€æ¡è®¢å•èœå“ä¿¡æ¯æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²ï¼ˆæ ¼å¼ï¼šå®«ä¿é¸¡ä¸*3ï¼›ï¼‰</span></span><br><span class="line">	List&lt;String&gt; orderDishList = orderDetailList.stream().map(x -&gt; &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">orderDish</span> <span class="operator">=</span> x.getName() + <span class="string">&quot;*&quot;</span> + x.getNumber() + <span class="string">&quot;;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> orderDish;</span><br><span class="line">	&#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†è¯¥è®¢å•å¯¹åº”çš„æ‰€æœ‰èœå“ä¿¡æ¯æ‹¼æ¥</span></span><br><span class="line">	<span class="keyword">return</span> String.join(<span class="string">&quot;&quot;</span>, orderDishList); <span class="comment">// &quot;Pizza2;Burger1;Salad*3;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-2-2-å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡">13.2.2 å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderStatisticsVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//å¾…æ¥å•æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer toBeConfirmed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾…æ´¾é€æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer confirmed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ´¾é€ä¸­æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer deliveryInProgress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/statistics&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderStatisticsVO&gt; <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> orderService.statistics();</span><br><span class="line">    <span class="keyword">return</span> Result.success(orderStatisticsVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> OrderStatisticsVO <span class="title function_">statistics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®çŠ¶æ€ï¼Œåˆ†åˆ«æŸ¥è¯¢å‡ºå¾…æ¥å•ã€å¾…æ´¾é€ã€æ´¾é€ä¸­çš„è®¢å•æ•°é‡</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">toBeConfirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.TO_BE_CONFIRMED);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">confirmed</span> <span class="operator">=</span> orderMapper.countStatus(Orders.CONFIRMED);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">deliveryInProgress</span> <span class="operator">=</span> orderMapper.countStatus(Orders.DELIVERY_IN_PROGRESS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æŸ¥è¯¢å‡ºçš„æ•°æ®å°è£…åˆ°orderStatisticsVOä¸­å“åº”</span></span><br><span class="line">    <span class="type">OrderStatisticsVO</span> <span class="variable">orderStatisticsVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderStatisticsVO</span>();</span><br><span class="line">    orderStatisticsVO.setToBeConfirmed(toBeConfirmed);</span><br><span class="line">    orderStatisticsVO.setConfirmed(confirmed);</span><br><span class="line">    orderStatisticsVO.setDeliveryInProgress(deliveryInProgress);</span><br><span class="line">    <span class="keyword">return</span> orderStatisticsVO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®çŠ¶æ€ç»Ÿè®¡è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select count(id) from orders where status = #&#123;status&#125;&quot;)</span></span><br><span class="line">Integer <span class="title function_">countStatus</span><span class="params">(Integer status)</span>;</span><br></pre></td></tr></table></figure>
<p>![[39b9834684e3cac4f28d1383f0f87a55.png]]</p>
<h3 id="13-2-3-æŸ¥è¯¢è®¢å•è¯¦æƒ…">13.2.3 æŸ¥è¯¢è®¢å•è¯¦æƒ…</h3>
<ul>
<li>è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•åŸºæœ¬ä¿¡æ¯ï¼ˆçŠ¶æ€ã€è®¢å•å·ã€ä¸‹å•æ—¶é—´ã€æ”¶è´§äººã€ç”µè¯ã€æ”¶è´§åœ°å€ã€é‡‘é¢ç­‰ï¼‰</li>
<li>è®¢å•è¯¦æƒ…é¡µé¢éœ€è¦å±•ç¤ºè®¢å•æ˜ç»†æ•°æ®ï¼ˆå•†å“åç§°ã€æ•°é‡ã€å•ä»·ï¼‰</li>
</ul>
<p>![[9cef7af02e814d98d38759ec7c4c8d77.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•è¯¦æƒ…</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/details/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•è¯¦æƒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;OrderVO&gt; <span class="title function_">details</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">OrderVO</span> <span class="variable">orderVO</span> <span class="operator">=</span> orderService.details(id);<span class="comment">//å·²å®ç°</span></span><br><span class="line">    <span class="keyword">return</span> Result.success(orderVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-2-4-æ¥å•">13.2.4 æ¥å•</h3>
<p>æ›´æ–°çŠ¶æ€å­—æ®µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrdersConfirmDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//è®¢å•çŠ¶æ€ 1å¾…ä»˜æ¬¾ 2å¾…æ¥å• 3 å·²æ¥å• 4 æ´¾é€ä¸­ 5 å·²å®Œæˆ 6 å·²å–æ¶ˆ 7 é€€æ¬¾</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ¥å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">confirm</span><span class="params">(<span class="meta">@RequestBody</span> OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    orderService.confirm(ordersConfirmDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¥å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersConfirmDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(OrdersConfirmDTO ordersConfirmDTO)</span> &#123;</span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">            .id(ordersConfirmDTO.getId())</span><br><span class="line">            .status(Orders.CONFIRMED)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-2-5-æ‹’å•">13.2.5 æ‹’å•</h3>
<ul>
<li>å•†å®¶æ‹’å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li>
<li>åªæœ‰è®¢å•å¤„äºâ€œå¾…æ¥å•â€çŠ¶æ€æ—¶å¯ä»¥æ‰§è¡Œæ‹’å•æ“ä½œ</li>
<li>å•†å®¶æ‹’å•æ—¶éœ€è¦æŒ‡å®šæ‹’å•åŸå› </li>
<li>å•†å®¶æ‹’å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrdersRejectionDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"><span class="comment">//è®¢å•æ‹’ç»åŸå› </span></span><br><span class="line"><span class="keyword">private</span> String rejectionReason;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/rejection&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ‹’å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">rejection</span><span class="params">(<span class="meta">@RequestBody</span> OrdersRejectionDTO ordersRejectionDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    orderService.rejection(ordersRejectionDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹’å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersRejectionDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejection</span><span class="params">(OrdersRejectionDTO ordersRejectionDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(ordersRejectionDTO.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•åªæœ‰å­˜åœ¨ä¸”çŠ¶æ€ä¸º2ï¼ˆå¾…æ¥å•ï¼‰æ‰å¯ä»¥æ‹’å•</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> || !ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">payStatus</span> <span class="operator">=</span> ordersDB.getPayStatus();</span><br><span class="line">    <span class="keyword">if</span> (payStatus == Orders.PAID) &#123;</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">refund</span> <span class="operator">=</span> weChatPayUtil.refund(</span><br><span class="line">                ordersDB.getNumber(),</span><br><span class="line">                ordersDB.getNumber(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>));</span><br><span class="line">        log.info(<span class="string">&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;</span>, refund);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹’å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€æ‹’å•åŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersDB.getId());</span><br><span class="line">    orders.setStatus(Orders.CANCELLED);</span><br><span class="line">    orders.setRejectionReason(ordersRejectionDTO.getRejectionReason());</span><br><span class="line">    orders.setCancelTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºè°ƒç”¨äº†å¾®ä¿¡æ”¯ä»˜å·¥å…·ç±»ä¸­çš„ç”³è¯·é€€æ¬¾æ¥å£ï¼Œæˆ‘ä»¬æ˜¯ä¸ªäººæ²¡æœ‰å•†æˆ·å·æ— æ³•å®ç°çœŸæ­£çš„æ”¯ä»˜åŠŸèƒ½ï¼Œæ‰€ä»¥æ— æ³•æµ‹è¯•ã€‚</p>
<h3 id="13-2-6-å–æ¶ˆè®¢å•">13.2.6 å–æ¶ˆè®¢å•</h3>
<p>æ¥å•åçš„å«å–æ¶ˆ</p>
<p>æ¥å•å‰çš„å«æ‹’å•</p>
<ul>
<li>å–æ¶ˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å–æ¶ˆâ€</li>
<li>å•†å®¶å–æ¶ˆè®¢å•æ—¶éœ€è¦æŒ‡å®šå–æ¶ˆåŸå› </li>
<li>å•†å®¶å–æ¶ˆè®¢å•æ—¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®Œæˆäº†æ”¯ä»˜ï¼Œéœ€è¦ä¸ºç”¨æˆ·é€€æ¬¾</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/cancel&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å–æ¶ˆè®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">cancel</span><span class="params">(<span class="meta">@RequestBody</span> OrdersCancelDTO ordersCancelDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    orderService.cancel(ordersCancelDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å–æ¶ˆè®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordersCancelDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">(OrdersCancelDTO ordersCancelDTO)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(ordersCancelDTO.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ”¯ä»˜çŠ¶æ€</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">payStatus</span> <span class="operator">=</span> ordersDB.getPayStatus();</span><br><span class="line">    <span class="keyword">if</span> (payStatus == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å·²æ”¯ä»˜ï¼Œéœ€è¦é€€æ¬¾</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">refund</span> <span class="operator">=</span> weChatPayUtil.refund(</span><br><span class="line">                ordersDB.getNumber(),</span><br><span class="line">                ordersDB.getNumber(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>));</span><br><span class="line">        log.info(<span class="string">&quot;ç”³è¯·é€€æ¬¾ï¼š&#123;&#125;&quot;</span>, refund);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®¡ç†ç«¯å–æ¶ˆè®¢å•éœ€è¦é€€æ¬¾ï¼Œæ ¹æ®è®¢å•idæ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ã€å–æ¶ˆæ—¶é—´</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersCancelDTO.getId());</span><br><span class="line">    orders.setStatus(Orders.CANCELLED);</span><br><span class="line">    orders.setCancelReason(ordersCancelDTO.getCancelReason());</span><br><span class="line">    orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ— æ³•æµ‹è¯•</p>
<h3 id="13-2-7-æ´¾é€è®¢å•">13.2.7 æ´¾é€è®¢å•</h3>
<ul>
<li>æ´¾é€è®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œæ´¾é€ä¸­â€</li>
<li>åªæœ‰çŠ¶æ€ä¸ºâ€œå¾…æ´¾é€3â€çš„è®¢å•å¯ä»¥æ‰§è¡Œæ´¾é€è®¢å•æ“ä½œ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/delivery/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ´¾é€è®¢å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delivery</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    orderService.delivery(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ´¾é€è®¢å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delivery</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”çŠ¶æ€ä¸º3</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> || !ordersDB.getStatus().equals(Orders.CONFIRMED)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersDB.getId());</span><br><span class="line">    <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€,çŠ¶æ€è½¬ä¸ºæ´¾é€ä¸­</span></span><br><span class="line">    orders.setStatus(Orders.DELIVERY_IN_PROGRESS);</span><br><span class="line"></span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-2-8-å®Œæˆè®¢å•">13.2.8 å®Œæˆè®¢å•</h3>
<ul>
<li>å®Œæˆè®¢å•å…¶å®å°±æ˜¯å°†è®¢å•çŠ¶æ€ä¿®æ”¹ä¸ºâ€œå·²å®Œæˆâ€</li>
<li>åªæœ‰çŠ¶æ€ä¸ºâ€œæ´¾é€ä¸­4â€çš„è®¢å•å¯ä»¥æ‰§è¡Œè®¢å•å®Œæˆæ“ä½œ</li>
</ul>
<h2 id="13-3-æ£€éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´">13.3 æ£€éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</h2>
<p><strong>ä¸å†™ï¼Œä¸å½±å“åç»­ä»£ç </strong></p>
<p>è¯´æ˜ï¼šæ³¨å†Œè´¦å·éœ€è¦å¡«å†™èº«ä»½è¯ã€åœ°å€ç­‰ä¸ªäººä¿¡æ¯æ¯”è¾ƒéº»çƒ¦ï¼Œåªè¦ä¼šä½¿ç”¨ç›¸å…³çš„APIæ¥å£å³å¯ï¼Œæ‰€ä»¥è¿™é‡Œä¸åœ¨å®ç°ä»£ç ã€‚</p>
<ol>
<li>ç¯å¢ƒå‡†å¤‡<br>
æ³¨å†Œè´¦å·ï¼š<br>
<a target="_blank" rel="noopener" href="https://passport.baidu.com/v2/?reg&amp;tt=1671699340600&amp;overseas=&amp;gid=CF954C2-A3D2-417F-9FE6B0F249ED7E33&amp;tpl=pp&amp;u=https%3A%2F%2Flbsyun.baidu.com%2Findex.php%3Ftitle%3D%E9%A6%96%E9%A1%B5">https://passport.baidu.com/v2/?reg&amp;tt=1671699340600&amp;overseas=&amp;gid=CF954C2-A3D2-417F-9FE6B0F249ED7E33&amp;tpl=pp&amp;u=https%3A%2F%2Flbsyun.baidu.com%2Findex.php%3Ftitle%3Dé¦–é¡µ</a></li>
</ol>
<p>ç™»å½•ç™¾åº¦åœ°å›¾å¼€æ”¾å¹³å°ï¼š<a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/">https://lbsyun.baidu.com/</a></p>
<p>è¿›å…¥æ§åˆ¶å°ï¼Œåˆ›å»ºåº”ç”¨ï¼Œè·å–AKï¼š</p>
<p>![[a6e312726ba79b4f3f79c6656032a5a3.png]]</p>
<p>![[9d2beeabfb069dc4d16bfa42f66a1753.png]]</p>
<p>ç›¸å…³æ¥å£:</p>
<p><a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding">https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding</a></p>
<p><a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/index.php?title=webapi/directionlite-v1">https://lbsyun.baidu.com/index.php?title=webapi/directionlite-v1</a></p>
<p>ä»£ç å¼€å‘ï¼š</p>
<ol>
<li>
<p>application.yml<br>
é…ç½®å¤–å–å•†å®¶åº—é“ºåœ°å€å’Œç™¾åº¦åœ°å›¾çš„AKï¼š</p>
<p>![[3d3ca450b7572a1b642a00f27b2f6479.png]]</p>
</li>
<li>
<p>OrderServiceImpl</p>
<p>æ”¹é€ OrderServiceImplï¼Œæ³¨å…¥ä¸Šé¢çš„é…ç½®é¡¹ï¼š</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;$&#123;sky.shop.address&#125;&quot;)</span><br><span class="line">private String shopAddress;</span><br><span class="line"></span><br><span class="line">@Value(&quot;$&#123;sky.baidu.ak&#125;&quot;)</span><br><span class="line">private String ak;</span><br></pre></td></tr></table></figure>
<p>åœ¨OrderServiceImplä¸­æä¾›æ ¡éªŒæ–¹æ³•ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥å®¢æˆ·çš„æ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkOutOfRange</span><span class="params">(String address)</span> &#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map.put(<span class="string">&quot;address&quot;</span>,shopAddress);</span><br><span class="line">    map.put(<span class="string">&quot;output&quot;</span>,<span class="string">&quot;json&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;ak&quot;</span>,ak);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–åº—é“ºçš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(shopCoordinate);</span><br><span class="line">    <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;åº—é“ºåœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">location</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">lat</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">lng</span> <span class="operator">=</span> location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">    <span class="comment">//åº—é“ºç»çº¬åº¦åæ ‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">&quot;address&quot;</span>,address);</span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·æ”¶è´§åœ°å€çš„ç»çº¬åº¦åæ ‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userCoordinate</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/geocoding/v3&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">    jsonObject = JSON.parseObject(userCoordinate);</span><br><span class="line">    <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;æ”¶è´§åœ°å€è§£æå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">    location = jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>).getJSONObject(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">    lat = location.getString(<span class="string">&quot;lat&quot;</span>);</span><br><span class="line">    lng = location.getString(<span class="string">&quot;lng&quot;</span>);</span><br><span class="line">    <span class="comment">//ç”¨æˆ·æ”¶è´§åœ°å€ç»çº¬åº¦åæ ‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userLngLat</span> <span class="operator">=</span> lat + <span class="string">&quot;,&quot;</span> + lng;</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">&quot;origin&quot;</span>,shopLngLat);</span><br><span class="line">    map.put(<span class="string">&quot;destination&quot;</span>,userLngLat);</span><br><span class="line">    map.put(<span class="string">&quot;steps_info&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·¯çº¿è§„åˆ’</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> HttpClientUtil.doGet(<span class="string">&quot;https://api.map.baidu.com/directionlite/v1/driving&quot;</span>, map);</span><br><span class="line"></span><br><span class="line">    jsonObject = JSON.parseObject(json);</span><br><span class="line">    <span class="keyword">if</span>(!jsonObject.getString(<span class="string">&quot;status&quot;</span>).equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;é…é€è·¯çº¿è§„åˆ’å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°æ®è§£æ</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.getJSONObject(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> (JSONArray) result.get(<span class="string">&quot;routes&quot;</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">distance</span> <span class="operator">=</span> (Integer) ((JSONObject) jsonArray.get(<span class="number">0</span>)).get(<span class="string">&quot;distance&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(distance &gt; <span class="number">5000</span>)&#123;</span><br><span class="line">        <span class="comment">//é…é€è·ç¦»è¶…è¿‡5000ç±³</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(<span class="string">&quot;è¶…å‡ºé…é€èŒƒå›´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>åœ¨OrderServiceImplçš„submitOrderæ–¹æ³•ä¸­è°ƒç”¨ä¸Šé¢çš„æ ¡éªŒæ–¹æ³•ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/ca667114bd0732661080ae355029ccb7.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/ca667114bd0732661080ae355029ccb7.png" alt=""></a></p>
<h1>åå››ã€<strong>Spring Taskã€è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†ã€æ¥å•æé†’ï¼ˆWebSocketçš„åº”ç”¨ï¼‰ã€å®¢æˆ·å‚¬å•ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</strong></h1>
<p>åŠŸèƒ½å®ç°ï¼š<strong>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</strong>ã€<strong>æ¥å•æé†’</strong>å’Œ<strong>å®¢æˆ·å‚¬å•</strong></p>
<p><strong>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†ï¼š</strong></p>
<p>![[4a9473a478fcdae4bdf7109279f20ecf.png]]</p>
<p><strong>æ¥å•æé†’ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/ce204aebd4d8c069c887ca438b42301f.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/ce204aebd4d8c069c887ca438b42301f.png" alt=""></a></p>
<p><strong>å®¢æˆ·å‚¬å•ï¼š</strong></p>
<p>![[d3fc90950008fd3c8505b69c739e669b.png]]</p>
<h2 id="14-1-Spring-Task">14.1 Spring Task</h2>
<p><strong>Spring Task</strong>Â æ˜¯Springæ¡†æ¶æä¾›çš„ä»»åŠ¡è°ƒåº¦å·¥å…·ï¼Œå¯ä»¥æŒ‰ç…§çº¦å®šçš„æ—¶é—´_<strong>è‡ªåŠ¨æ‰§è¡Œ</strong>_æŸä¸ªä»£ç é€»è¾‘ã€‚</p>
<p><strong>å®šä½</strong>ï¼šå®šæ—¶ä»»åŠ¡æ¡†æ¶</p>
<p><strong>ä½œç”¨</strong>ï¼šå®šæ—¶è‡ªåŠ¨æ‰§è¡ŒæŸæ®µJavaä»£ç </p>
<p>ä¸ºä»€ä¹ˆè¦åœ¨Javaç¨‹åºä¸­ä½¿ç”¨Spring Taskï¼Ÿ</p>
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
<p>é€‚åˆæ‰€æœ‰éœ€è¦å®šæœŸå¤„ç†çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¿¡ç”¨å¡å’Œé“¶è¡Œè´·æ¬¾çš„è¿˜æ¬¾æé†’ã€‚</li>
<li>å¤„ç†æœªæ”¯ä»˜çš„è®¢å•ã€‚</li>
<li>å‘é€å…¥èŒçºªå¿µæ—¥é€šçŸ¥ã€‚</li>
</ul>
<h3 id="14-1-1-cronè¡¨è¾¾å¼">14.1.1 cronè¡¨è¾¾å¼</h3>
<p>cronè¡¨è¾¾å¼å…¶å®å°±æ˜¯ä¸€ ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡cronè¡¨è¾¾å¼å¯ä»¥<strong>å®šä¹‰ä»»åŠ¡è§¦å‘çš„æ—¶é—´</strong></p>
<p>æ„æˆè§„åˆ™ï¼šåˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œç”±ç©ºæ ¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰</p>
<p>æ¯ä¸ªåŸŸçš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€å‘¨ã€å¹´(å¯é€‰)</p>
<p>ä¸¾ä¾‹ï¼š</p>
<p>2022å¹´10æœˆ12æ—¥ä¸Šåˆ9ç‚¹æ•´ å¯¹åº”çš„cronè¡¨è¾¾å¼ä¸ºï¼š0 0 9 12 10 ? 2022</p>
<p>![[83446c1915bf7adf9dec2d36b94b5a36.png]]</p>
<p>è¯´æ˜ï¼šä¸€èˆ¬_æ—¥å’Œå‘¨çš„å€¼ä¸åŒæ—¶è®¾ç½®_ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾ç½®ï¼Œå¦ä¸€ä¸ªç”¨ï¼Ÿè¡¨ç¤º</p>
<p>æ¯”å¦‚ï¼šæè¿°2æœˆä»½çš„æœ€åä¸€å¤©ï¼Œæœ€åä¸€å¤©å…·ä½“æ˜¯å‡ å·å‘¢ï¼Ÿå¯èƒ½æ˜¯28å·ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯29å·ï¼Œæ‰€ä»¥å°±ä¸èƒ½å†™å…·ä½“æ•°å­—ã€‚</p>
<p>ä¸ºäº†æè¿°è¿™äº›ä¿¡æ¯ï¼Œæä¾›ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦ã€‚è¿™äº›å…·ä½“çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªå·±å»æ‰‹å†™ï¼Œå› ä¸ºè¿™ä¸ªcronè¡¨è¾¾å¼ï¼Œå®ƒå…¶å®æœ‰åœ¨çº¿ç”Ÿæˆå™¨ã€‚</p>
<p>cronè¡¨è¾¾å¼åœ¨çº¿ç”Ÿæˆå™¨ï¼š<a target="_blank" rel="noopener" href="https://cron.qqe2.com/">https://cron.qqe2.com/</a></p>
<p>é€šé…ç¬¦ï¼š</p>
<ul>
<li><code>*</code>ï¼šè¡¨ç¤ºæ‰€æœ‰å€¼ã€‚</li>
<li><code>?</code>ï¼šè¡¨ç¤ºæœªè¯´æ˜çš„å€¼ï¼Œï¼Œå³ä¸å…³å¿ƒå®ƒä¸ºä½•å€¼</li>
<li><code>-</code>ï¼šè¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚</li>
<li><code>,</code>ï¼šè¡¨ç¤ºé™„åŠ å€¼ã€‚</li>
<li><code>/</code>ï¼šç¬¦å·å‰è¡¨ç¤ºå¼€å§‹æ—¶é—´ï¼Œç¬¦å·åè¡¨ç¤ºæ¯æ¬¡é€’å¢çš„å€¼</li>
</ul>
<p>![[22a1b4c3f42e7a395da36319647de9cb.png]]</p>
<ul>
<li>
<p>ç‰¹æ®Š1ï¼šæ¯æœˆå‡ å·æœ€è¿‘çš„é‚£ä¸ªå·¥ä½œæ—¥</p>
<p>![[cba7a814848a3add0acc7d7db28b6659.png]]</p>
<p>æ¯”å¦‚æ¯æœˆ10å·æœ€è¿‘çš„é‚£ä¸ªå·¥ä½œæ—¥ï¼Œå‘¨ä¸€åˆ°å‘¨äº”ç§°ä¸ºå·¥ä½œæ—¥<br>
å¦‚æœ10å·æ­£å¥½æ˜¯å‘¨ä¸€åˆ°å‘¨äº”ï¼Œé‚£ä¹ˆå®ƒåŒ¹é…çš„æ­£å¥½æ˜¯10å·ã€‚<br>
å¦‚æœ10å·æ­£å¥½æ˜¯å‘¨å…­ï¼Œé‚£ä¹ˆç¦»å‘¨å…­æœ€è¿‘çš„ä¸€ä¸ªå·¥ä½œæ—¥æ˜¯å‘¨äº”ï¼Œ9å·è¿™ä¸€å¤©ã€‚<br>
å¦‚æœ10å·æ­£å¥½æ˜¯å‘¨æ—¥ï¼Œé‚£ä¹ˆç¦»å‘¨æ—¥æœ€è¿‘çš„ä¸€ä¸ªå·¥ä½œæ—¥æ˜¯å‘¨ä¸€ï¼Œ11å·è¿™ä¸€å¤©ã€‚</p>
</li>
<li>
<p>ç‰¹æ®Š2ï¼šæœ¬æœˆæœ€åä¸€å¤©</p>
<p>![[01b67aa6b14f9f3d01f6b45a7cbeb1d6.png]]</p>
<p>éœ€è¦çœ‹å…·ä½“æœˆä»½æ˜¯å¦‚ä½•è®¾ç½®çš„<br>
å¦‚æœåŒ¹é…åˆ°çš„æ˜¯10æœˆä»½ï¼Œé‚£ä¹ˆæœ€åä¸€å¤©å°±æ˜¯31å·ã€‚<br>
å¦‚æœåŒ¹é…åˆ°çš„æ˜¯9æœˆä»½ï¼Œé‚£ä¹ˆæœ€åä¸€å¤©å°±æ˜¯30å·ã€‚<br>
å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªç½‘ç«™ä¸Šé¢ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„è¦æ±‚å»ç”Ÿæˆcornè¡¨è¾¾å¼å³å¯ã€‚æ‰€ä»¥ä¸€èˆ¬å°±ä¸ç”¨è‡ªå·±å»ç¼–å†™è¿™ä¸ªè¡¨è¾¾å¼ã€‚</p>
</li>
</ul>
<p>cron è¡¨è¾¾å¼æ¡ˆä¾‹ï¼š</p>
<ol>
<li><code>**/5 * * * * ?**</code>ï¼šæ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</li>
<li><code>**0 */1 * * * ?**</code>ï¼šæ¯åˆ†é’Ÿçš„ç¬¬0ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå³æ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</li>
<li><code>**0 0 5-15 * * ?**</code>ï¼šæ¯å¤©çš„5ç‚¹åˆ°15ç‚¹æ•´ç‚¹ï¼ˆå³5:00ã€6:00â€¦â€¦15:00ï¼‰è§¦å‘ã€‚</li>
<li><code>**0 0/3 * * * ?**</code>ï¼šæ¯3åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œå…·ä½“æ˜¯åœ¨æ¯ä¸ªå°æ—¶çš„ç¬¬0ã€3ã€6ã€9ã€12ã€15ã€18ã€21ã€24ã€27ã€30ã€33ã€36ã€39ã€42ã€45ã€48ã€51ã€54ã€57åˆ†é’Ÿæ‰§è¡Œã€‚</li>
<li><code>**0 0-5 14 * * ?**</code>ï¼šåœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:05æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘ï¼Œå³2:00ã€2:01ã€2:02ã€2:03ã€2:04ã€2:05æ‰§è¡Œã€‚</li>
<li><code>**0 0/5 14 * * ?**</code>ï¼šåœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘ï¼Œå³2:00ã€2:05ã€2:10ã€2:15ã€2:20ã€2:25ã€2:30ã€2:35ã€2:40ã€2:45ã€2:50ã€2:55æ‰§è¡Œã€‚</li>
<li><code>**0 0/5 14,18 * * ?**</code>ï¼šåœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´å’Œä¸‹åˆ6ç‚¹åˆ°6:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘ã€‚</li>
<li><code>**0 0/30 9-17 * * ?**</code>ï¼šåœ¨å·¥ä½œæ—¶é—´å†…ï¼ˆ9ç‚¹åˆ°17ç‚¹ï¼‰æ¯åŠå°æ—¶è§¦å‘ï¼Œå³9:00ã€9:30ã€10:00â€¦â€¦17:00ã€17:30æ‰§è¡Œã€‚</li>
<li><code>**0 0 10,14,16 * * ?**</code>ï¼šæ¯å¤©ä¸Šåˆ10ç‚¹ã€ä¸‹åˆ2ç‚¹å’Œ4ç‚¹è§¦å‘ã€‚</li>
</ol>
<h3 id="14-1-2-å…¥é—¨æ¡ˆä¾‹">14.1.2 <strong>å…¥é—¨æ¡ˆä¾‹</strong></h3>
<ol>
<li>
<p>å¯¼å…¥mavenåæ ‡ spring-context</p>
<p>![[12a5b0384677ae08b7d963cae79dbcc2.png]]</p>
</li>
<li>
<p>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ @EnableScheduling å¼€å¯ä»»åŠ¡è°ƒåº¦</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky;</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//å¼€å¯æ³¨è§£æ–¹å¼çš„äº‹åŠ¡ç®¡ç†</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">//å¼€å¯ä»»åŠ¡è°ƒåº¦</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SkyApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;server started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±» sek-serverä¸‹åˆ›å»ºtaskåŒ…</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.task;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//éœ€è¦äº¤ç»™Springå®¹å™¨å»ç®¡ç†</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šæ—¶ä»»åŠ¡ æ¯éš”5ç§’è§¦å‘ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     * å®šæ—¶ä»»åŠ¡å…·ä½“å¤„ç†çš„ä¸šåŠ¡é€»è¾‘éœ€è¦å†™åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢  ã€‚</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•è¿”å›å€¼ç±»å‹æ˜¯voidï¼Œæ–¹æ³•åä»»æ„ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span> <span class="comment">// ä»ç¬¬0ç§’å¼€å§‹æ¯éš”5ç§’å¼€å§‹è§¦å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeTask</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼š&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/3607326d637b9d64ab04f7b9ff69e464.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3607326d637b9d64ab04f7b9ff69e464.png" alt=""></a></p>
<p>æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h2 id="14-2-è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†">14.2 <strong>è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</strong></h2>
<p>ç”¨æˆ·ä¸‹å•åå¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼š</p>
<ul>
<li>
<p>ä¸‹å•åæœªæ”¯ä»˜ï¼Œè®¢å•ä¸€ç›´å¤„äº<strong>å¾…æ”¯ä»˜</strong>çŠ¶æ€</p>
</li>
<li>
<p>ç”¨æˆ·æ”¶è´§åç®¡ç†ç«¯æœªç‚¹å‡»å®ŒæˆæŒ‰é’®ï¼Œè®¢å•ä¸€ç›´å¤„äº<strong>æ´¾é€ä¸­</strong>çŠ¶æ€</p>
<p>![[1079118d30caa38045bd2e8b7080bbd5.png]]</p>
</li>
</ul>
<p>å¯¹äºä¸Šé¢ä¸¤ç§æƒ…å†µéœ€è¦é€šè¿‡<strong>å®šæ—¶ä»»åŠ¡</strong>æ¥ä¿®æ”¹è®¢å•çŠ¶æ€ï¼Œå…·ä½“é€»è¾‘ä¸ºï¼š</p>
<ul>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡<strong>æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</strong>æ˜¯å¦å­˜åœ¨æ”¯ä»˜è¶…æ—¶è®¢å•ï¼ˆä¸‹å•åè¶…è¿‡15åˆ†é’Ÿä»æœªæ”¯ä»˜åˆ™åˆ¤å®šä¸ºæ”¯ä»˜è¶…æ—¶è®¢å•ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å–æ¶ˆâ€</li>
<li>é€šè¿‡å®šæ—¶ä»»åŠ¡<strong>æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥ä¸€æ¬¡</strong>æ˜¯å¦å­˜åœ¨â€œæ´¾é€ä¸­â€çš„è®¢å•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€</li>
</ul>
<p>æ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹å°±ä¸éœ€è¦åšæ¥å£è®¾è®¡äº†ï¼Œè¿™é‡Œæ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œå¹¶ä¸éœ€è¦å‰ç«¯å‘é€httpè¯·æ±‚æ¥è§¦å‘ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹å°±æ²¡æœ‰æ¥å£è¿™ä¸ªæ¦‚å¿µäº†ã€‚</p>
<p>é—®é¢˜ï¼šå¯¹äºè¿™ä¸¤ç±»è®¢å•ï¼ˆæ”¯ä»˜è¶…æ—¶è®¢å•ã€æ´¾é€ä¸­çš„è®¢å•ï¼‰çš„å¤„ç†æ˜¯ä¸æ˜¯è¦ç¼–å†™2ä¸ªå®šæ—¶ä»»åŠ¡ç±»å‘¢ï¼Ÿï¼Ÿ</p>
<p>ç­”ï¼šå†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç±» ç±»é‡Œé¢å†™2ä¸ªæ–¹æ³• æˆ–è€… å†™2ä¸ªå®šæ—¶ä»»åŠ¡ç±» æ¯ä¸ªç±»é‡Œé¢å†™ä¸€ä¸ªæ–¹æ³•éƒ½å¯ä»¥ã€‚</p>
<ol>
<li>
<p><strong>è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ç±»OrderTask</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.task;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œå®ç°è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span> <span class="comment">// æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†â€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„processTimeoutOrderæ–¹æ³•</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span><span class="comment">//æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å¤„ç†æ”¯ä»˜è¶…æ—¶è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢è®¢å•è¡¨ä¸­çš„é‚£äº›è®¢å•æ˜¯è¶…æ—¶äº†ï¼ŒæŸ¥è¯¢éœ€è¦é‚£äº›æ¡ä»¶å‘¢ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line"><span class="comment">     *     1.é¦–å…ˆè®¢å•çŠ¶æ€éœ€è¦å¤„äºâ€œå¾…ä»˜æ¬¾â€çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">     *     2.ä¸‹å•çš„æ—¶é—´è¶…è¿‡äº†15åˆ†é’Ÿï¼šä¸‹å•æ—¶é—´ &lt; å½“å‰æ—¶é—´-15åˆ†é’Ÿ</span></span><br><span class="line"><span class="comment">     *  select * from orders where status = 1 and order_time &lt; å½“å‰æ—¶é—´-15åˆ†é’Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  LocalDateTime.now():å½“å‰æ—¶é—´ ï¼Œæ–°çš„æ—¶é—´æ—¥æœŸAPI</span></span><br><span class="line"><span class="comment">     *  plusMinutes(xx)ï¼šåŠ xxxåˆ†é’Ÿ</span></span><br><span class="line"><span class="comment">     *  plusMinutes(-15)ï¼šåŠ ä¸Šä¸€ä¸ªè´Ÿçš„å°±æ˜¯å‡15åˆ†é’Ÿ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">15</span>);<span class="comment">//è®¡ç®—å‡ºä¸‹å•æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢åˆ°çš„è¶…æ—¶è®¢å•é›†åˆ</span></span><br><span class="line">    List&lt;Orders&gt; ordersList  = orderMapper.getByStatusAndOrdertimeLT(Orders.PENDING_PAYMENT, time);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æˆ–å–åˆ°è¶…æ—¶è®¢å•é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span>(ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//éå†è®¢å•é›†åˆï¼Œä¹‹åä¿®æ”¹æ¯ä¸ªè®¢å•çš„çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> (Orders orders : ordersList) &#123;  <span class="comment">//å¿«æ·é”®ï¼šordersList.for</span></span><br><span class="line">            orders.setStatus(Orders.CANCELLED); <span class="comment">//è®¢å•çŠ¶æ€ï¼š6å·²å–æ¶ˆ</span></span><br><span class="line">            orders.setCancelReason(<span class="string">&quot;æ”¯ä»˜è¶…æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆ&quot;</span>);<span class="comment">//å–æ¶ˆåŸå› </span></span><br><span class="line">            orders.setCancelTime(LocalDateTime.now());<span class="comment">//è®¢å•å–æ¶ˆæ—¶é—´</span></span><br><span class="line">            orderMapper.update(orders); <span class="comment">//ä¹‹å‰å®ç°è¿‡äº†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å®Œå–„å®šæ—¶ä»»åŠ¡ç±»çš„processDeliveryOrderæ–¹æ³•</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†ä¸€ç›´å¤„äºâ€œæ´¾é€ä¸­â€çŠ¶æ€çš„è®¢å•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><span class="comment">//æ¯å¤©å‡Œæ™¨1ç‚¹è§¦å‘ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å¤„ç†æ´¾é€ä¸­è®¢å•ï¼š&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * select * from orders where status = 4 and order_time &lt; å½“å‰æ—¶é—´-1å°æ—¶</span></span><br><span class="line"><span class="comment">     * å’Œä¸Šé¢é‚£ä¸ªæ–¹æ³•çš„ä¸šåŠ¡é€»è¾‘ç›¸åŒï¼Œåªä¸è¿‡æ˜¯æŸ¥è¯¢çš„æ¡ä»¶ä¸åŒï¼š</span></span><br><span class="line"><span class="comment">     *    1.é¦–å…ˆè®¢å•çŠ¶æ€éœ€è¦å¤„äºâ€œæ´¾é€ä¸­â€çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">     *    2.æŸ¥è¯¢çš„æ—¶é—´æ˜¯ä¸Šä¸€ä¸ªå·¥ä½œæ—¥çš„ï¼šä¸‹å•æ—¶é—´ &lt; å½“å‰æ—¶é—´ï¼ˆæ¯å¤©å‡Œæ™¨1ç‚¹ï¼‰-1å°æ—¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">60</span>);<span class="comment">//è®¡ç®—å‡ºä¸‹å•æ—¶é—´</span></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢åˆ°çš„è¶…æ—¶è®¢å•é›†åˆ</span></span><br><span class="line">    List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.DELIVERY_IN_PROGRESS, time);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æˆ–å–åˆ°è¶…æ—¶è®¢å•é›†åˆ</span></span><br><span class="line">    <span class="keyword">if</span>(ordersList != <span class="literal">null</span> &amp;&amp; ordersList.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//éå†è®¢å•é›†åˆï¼Œä¹‹åä¿®æ”¹æ¯ä¸ªè®¢å•çš„çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span> (Orders orders : ordersList) &#123;</span><br><span class="line">            orders.setStatus(Orders.CANCELLED); <span class="comment">//è®¢å•çŠ¶æ€ï¼š5å·²å®Œæˆ</span></span><br><span class="line">            orderMapper.update(orders); <span class="comment">//ä¹‹å‰å®ç°è¿‡äº†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>åœ¨OrderMapperæ¥å£ä¸­æ‰©å±•æ–¹æ³•</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®çŠ¶æ€å’Œä¸‹å•æ—¶é—´æŸ¥è¯¢è®¢å•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderTime</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from orders where status = #&#123;status&#125; and order_time &lt; #&#123;orderTime&#125;&quot;)</span></span><br><span class="line">List&lt;Orders&gt; <span class="title function_">getByStatusAndOrdertimeLT</span><span class="params">(Integer status, LocalDateTime orderTime)</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="14-3-WebSocket">14.3 <strong>WebSocket</strong></h2>
<p>WebSocket æ˜¯åŸºäº TCP çš„ä¸€ç§æ–°çš„<strong>ç½‘ç»œåè®®</strong>ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡â€”â€”æµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥åˆ›å»º<strong>æŒä¹…æ€§</strong>çš„è¿æ¥ï¼Œ å¹¶è¿›è¡Œ<strong>åŒå‘</strong>æ•°æ®ä¼ è¾“ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ HTTP è¯·æ±‚-å“åº”æ¨¡å‹ç›¸æ¯”ï¼ŒWebSocket å…è®¸åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿æ¥ä¸Šè¿›è¡ŒæŒç»­çš„æ•°æ®äº¤æ¢ï¼Œä½¿å¾—å®æ—¶æ•°æ®ä¼ è¾“å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</p>
<p><strong>HTTPåè®®å’ŒWebSocketåè®®å¯¹æ¯”ï¼š</strong></p>
<ul>
<li>
<p>HTTPæ˜¯<strong>çŸ­è¿æ¥</strong></p>
</li>
<li>
<p>WebSocketæ˜¯<strong>é•¿è¿æ¥</strong></p>
</li>
<li>
<p>HTTPé€šä¿¡æ˜¯<strong>å•å‘</strong>çš„ï¼ŒåŸºäºè¯·æ±‚å“åº”æ¨¡å¼ï¼ˆæµè§ˆå™¨å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼‰</p>
</li>
<li>
<p>WebSocketæ”¯æŒ<strong>åŒå‘</strong>é€šä¿¡</p>
</li>
<li>
<p>HTTPå’ŒWebSocketåº•å±‚éƒ½æ˜¯TCPè¿æ¥</p>
<p>![[ca3811e78f55f472519c7802e03d9545.png]]</p>
</li>
</ul>
<p><strong>æ€è€ƒ</strong>ï¼šæ—¢ç„¶WebSocketæ”¯æŒåŒå‘é€šä¿¡ï¼ŒåŠŸèƒ½çœ‹ä¼¼æ¯”HTTPå¼ºå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºWebSocketå¼€å‘æ‰€æœ‰çš„ä¸šåŠ¡åŠŸèƒ½ï¼Ÿ</p>
<p><strong>WebSocketç¼ºç‚¹ï¼š</strong></p>
<p>æœåŠ¡å™¨é•¿æœŸç»´æŠ¤é•¿è¿æ¥éœ€è¦ä¸€å®šçš„æˆæœ¬</p>
<p>å„ä¸ªæµè§ˆå™¨æ”¯æŒç¨‹åº¦ä¸ä¸€</p>
<p>WebSocket æ˜¯é•¿è¿æ¥ï¼Œå—ç½‘ç»œé™åˆ¶æ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤„ç†å¥½é‡è¿</p>
<p><strong>ç»“è®º</strong>ï¼šWebSocketå¹¶ä¸èƒ½å®Œå…¨å–ä»£HTTPï¼Œå®ƒåªé€‚åˆåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ä½¿ç”¨</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>
<p><strong>å®æ—¶åº”ç”¨</strong>ï¼šå¦‚åœ¨çº¿èŠå¤©åº”ç”¨ã€è‚¡ç¥¨äº¤æ˜“å¹³å°ã€æ¸¸æˆç­‰ã€‚</p>
<p>![[ef1bd6907725193964242a99077c9e5f.png]]</p>
<p>![[6f5bc17ec2c0c545d1321ea8ab33ec98.png]]</p>
</li>
<li>
<p><strong>å®æ—¶æ•°æ®æ›´æ–°</strong>ï¼šå¦‚å¤©æ°”é¢„æŠ¥ã€ä½“è‚²æ¯”èµ›å®æ—¶æ¯”åˆ†ç­‰ã€‚</p>
<p>![[c688e195249cffbd78d18dcdf99b1663.png]]</p>
</li>
</ul>
<h3 id="14-3-1-å…¥é—¨æ¡ˆä¾‹"><strong>14.3.1 å…¥é—¨æ¡ˆä¾‹</strong></h3>
<p><strong>éœ€æ±‚</strong>ï¼šå®ç°æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥é€šä¿¡ã€‚æµè§ˆå™¨æ—¢å¯ä»¥å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯</p>
<p>![[fa5e27c004de7040a4b8b15e67f0c385.png]]</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p>ç›´æ¥ä½¿ç”¨websocket.htmlé¡µé¢ä½œä¸ºWebSocketå®¢æˆ·ç«¯</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;WebSocket Demo&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;input id=<span class="string">&quot;text&quot;</span> type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">    &lt;button onclick=<span class="string">&quot;send()&quot;</span>&gt;å‘é€æ¶ˆæ¯&lt;/button&gt;</span><br><span class="line">    &lt;button onclick=<span class="string">&quot;closeWebSocket()&quot;</span>&gt;å…³é—­è¿æ¥&lt;/button&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;message&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="type">var</span> <span class="variable">websocket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">var</span> <span class="variable">clientId</span> <span class="operator">=</span> Math.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;WebSocket&#x27;</span> in window)&#123;</span><br><span class="line">        <span class="comment">//è¿æ¥WebSocketèŠ‚ç‚¹   æ³¨æ„ç°åœ¨æ˜¯wsåè®®</span></span><br><span class="line">        <span class="comment">//è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªæ¡æ‰‹çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å»ºç«‹äº†ä¸€ä¸ªé•¿è¿æ¥</span></span><br><span class="line">        <span class="comment">//   ä¹‹åå°±å¯ä»¥åŒå‘é€šä¿¡äº†ã€‚</span></span><br><span class="line">        websocket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080/ws/&quot;</span>+clientId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;Not support websocket&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">    websocket.onerror = function()&#123;</span><br><span class="line">        setMessageInnerHTML(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">    websocket.onopen = function()&#123;</span><br><span class="line">        setMessageInnerHTML(<span class="string">&quot;è¿æ¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">    websocket.onmessage = function(event)&#123;</span><br><span class="line">        setMessageInnerHTML(event.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">    websocket.onclose = function()&#123;</span><br><span class="line">        setMessageInnerHTML(<span class="string">&quot;close&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚</span></span><br><span class="line">    window.onbeforeunload = function()&#123;</span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š</span></span><br><span class="line">    function <span class="title function_">setMessageInnerHTML</span><span class="params">(innerHTML)</span>&#123;</span><br><span class="line">        document.getElementById(<span class="string">&#x27;message&#x27;</span>).innerHTML += innerHTML + <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯ï¼ˆå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼‰</span></span><br><span class="line">    function <span class="title function_">send</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">message</span> <span class="operator">=</span> document.getElementById(<span class="string">&#x27;text&#x27;</span>).value;</span><br><span class="line">        websocket.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å…³é—­è¿æ¥</span></span><br><span class="line">    function <span class="title function_">closeWebSocket</span><span class="params">()</span> &#123;</span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¼å…¥WebSocketçš„mavenåæ ‡</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¼å…¥WebSocketæœåŠ¡ç«¯ç»„ä»¶WebSocketServerï¼Œç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.websocket;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketæœåŠ¡ï¼šç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//ç±»ä¼¼äºcontrolleræ–¹æ³•ä¸­çš„è·¯å¾„ï¼Œåªä¸è¿‡ç”¨çš„æ³¨è§£ä¸åŒï¼Œå¯¹åº”ä¹‹å‰é¡µé¢ä¸Šçš„åœ°å€</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws/&#123;sid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜æ”¾ä¼šè¯å¯¹è±¡ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦å»ºç«‹ä¸€ä¸ªè¿æ¥æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªä¼šè¯ï¼Œå»ºç«‹å¥½ä¼šè¯ä¹‹ååŒæ–¹ä¹‹é—´å°±å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡äº†ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *    è¿™ä¸ªè¿‡ç¨‹ä¸ç”¨æˆ‘ä»¬ç®¡è€Œæ˜¯ç”±websocketè¿™ä¸ªå°æ¡†æ¶è‡ªå·±æ¥è°ƒï¼Œå®¢æˆ·ç«¯å¯èƒ½æœ‰å¤šä¸ªæ‰€ä»¥è¦åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œ</span></span><br><span class="line"><span class="comment">     *    å…·ä½“æ˜¯é€šè¿‡sidæ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œsidæ˜¯é¡µé¢ä¼ é€’è¿‡æ¥çš„clientIdï¼ŒclientIdæ˜¯é¡µé¢ç”Ÿæˆçš„ä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line"><span class="comment">     *    <span class="doctag">@PathParam</span>ï¼šè·¯å¾„å‚æ•°è·å–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;å»ºç«‹è¿æ¥&quot;</span>);</span><br><span class="line">        sessionMap.put(sid, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•ï¼Œç±»ä¼¼äºcontrollerä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;çš„ä¿¡æ¯:&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(<span class="meta">@PathParam(&quot;sid&quot;)</span> String sid&#123;</span></span><br><span class="line"><span class="params">        System.out.println(<span class="string">&quot;è¿æ¥æ–­å¼€:&quot;</span> + sid)</span>;</span><br><span class="line">        sessionMap.remove(sid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¾¤å‘ï¼šæŠŠmapä¸­çš„sessionéƒ½ç»™éå†å‡ºæ¥äº†ï¼Œè¿™å°±ç›¸å½“äºæ˜¯ç¾¤å‘çš„ä¸€ä¸ªæ•ˆæœï¼Œå› ä¸ºå®¢æˆ·ç«¯å¯èƒ½æœ‰å¤šä¸ªï¼Œéƒ½è¿æ¥åˆ°äº†è¿™ä¸ªæœåŠ¡ç«¯ï¼Œç°åœ¨æŠŠè¿™äº›sessionéƒ½éå†å‡ºæ¥ ç„¶åéƒ½ç»™è¿™äº›å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç¾¤å‘çš„æ•ˆæœã€‚</span></span><br><span class="line"><span class="comment">     *  æ³¨æ„ï¼šè¿™ä¸ªæ˜¯æ™®é€šæ–¹æ³•éœ€è¦è‡ªå·±æ‰‹åŠ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        Collection&lt;Session&gt; sessions = sessionMap.values();</span><br><span class="line">        <span class="comment">//æŠŠsessionMapé›†åˆä¸­çš„sessionéƒ½éå†å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">for</span> (Session session : sessions) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">                session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¼å…¥é…ç½®ç±»WebSocketConfigurationï¼Œæ³¨å†ŒWebSocketçš„æœåŠ¡ç«¯ç»„ä»¶ï¼ˆè®©ç»„ä»¶ç”Ÿæ•ˆï¼‰</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.websocket;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebSocketæœåŠ¡ï¼šç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//ç±»ä¼¼äºcontrolleræ–¹æ³•ä¸­çš„è·¯å¾„ï¼Œåªä¸è¿‡ç”¨çš„æ³¨è§£ä¸åŒï¼Œå¯¹åº”ä¹‹å‰é¡µé¢ä¸Šçš„åœ°å€</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws/&#123;sid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜æ”¾ä¼šè¯å¯¹è±¡ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦å»ºç«‹ä¸€ä¸ªè¿æ¥æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªä¼šè¯ï¼Œå»ºç«‹å¥½ä¼šè¯ä¹‹ååŒæ–¹ä¹‹é—´å°±å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡äº†ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *    è¿™ä¸ªè¿‡ç¨‹ä¸ç”¨æˆ‘ä»¬ç®¡è€Œæ˜¯ç”±websocketè¿™ä¸ªå°æ¡†æ¶è‡ªå·±æ¥è°ƒï¼Œå®¢æˆ·ç«¯å¯èƒ½æœ‰å¤šä¸ªæ‰€ä»¥è¦åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œ</span></span><br><span class="line"><span class="comment">     *    å…·ä½“æ˜¯é€šè¿‡sidæ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œsidæ˜¯é¡µé¢ä¼ é€’è¿‡æ¥çš„clientIdï¼ŒclientIdæ˜¯é¡µé¢ç”Ÿæˆçš„ä¸€ä¸ªéšæœºæ•°</span></span><br><span class="line"><span class="comment">     *    <span class="doctag">@PathParam</span>ï¼šè·¯å¾„å‚æ•°è·å–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;å»ºç«‹è¿æ¥&quot;</span>);</span><br><span class="line">        sessionMap.put(sid, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•ï¼Œç±»ä¼¼äºcontrollerä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯ï¼š&quot;</span> + sid + <span class="string">&quot;çš„ä¿¡æ¯:&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(<span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥æ–­å¼€:&quot;</span> + sid);</span><br><span class="line">        sessionMap.remove(sid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¾¤å‘ï¼šæŠŠmapä¸­çš„sessionéƒ½ç»™éå†å‡ºæ¥äº†ï¼Œè¿™å°±ç›¸å½“äºæ˜¯ç¾¤å‘çš„ä¸€ä¸ªæ•ˆæœï¼Œå› ä¸ºå®¢æˆ·ç«¯å¯èƒ½</span></span><br><span class="line"><span class="comment">     *      æœ‰å¤šä¸ªï¼Œéƒ½è¿æ¥åˆ°äº†è¿™ä¸ªæœåŠ¡ç«¯ï¼Œç°åœ¨æŠŠè¿™äº›sessionéƒ½éå†å‡ºæ¥ ç„¶åéƒ½ç»™è¿™äº›</span></span><br><span class="line"><span class="comment">     *      å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç¾¤å‘çš„æ•ˆæœã€‚</span></span><br><span class="line"><span class="comment">     *  æ³¨æ„ï¼šè¿™ä¸ªæ˜¯æ™®é€šæ–¹æ³•éœ€è¦è‡ªå·±æ‰‹åŠ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        Collection&lt;Session&gt; sessions = sessionMap.values();</span><br><span class="line">        <span class="comment">//æŠŠsessionMapé›†åˆä¸­çš„sessionéƒ½éå†å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">for</span> (Session session : sessions) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">                session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¼å…¥å®šæ—¶ä»»åŠ¡ç±»WebSocketTaskï¼Œå®šæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.task;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebSocketServer webSocketServer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡WebSocketæ¯éš”5ç§’å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessageToClient</span><span class="params">()</span> &#123;</span><br><span class="line">	    <span class="comment">//è°ƒç”¨WebSocketServerç±»ä¸­ç¾¤å‘çš„æ–¹æ³•</span></span><br><span class="line">        webSocketServer.sendToAllClient(<span class="string">&quot;è¿™æ˜¯æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼š&quot;</span> + DateTimeFormatter.ofPattern(<span class="string">&quot;HH:mm:ss&quot;</span>).format(LocalDateTime.now()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>è¯´æ˜ï¼šwebsocketè¿™ä¸€å—ä¸»è¦æ˜¯äº†è§£ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œå…·ä½“çš„ä»£ç å¹¶ä¸ä½œä¸ºé‡ç‚¹ï¼Œæ‰€ä»¥è¯´å…¥é—¨æ¡ˆä¾‹ç›¸å¯¹æ¯”è¾ƒç®€å•è¿™é‡Œç›´æ¥å¯¼å…¥è¯¾å‰èµ„æ–™ä¸­çš„ä»£ç å³å¯ã€‚</p>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<p>å¯åŠ¨æœåŠ¡ï¼Œæ‰“å¼€websocket.htmlé¡µé¢</p>
<p><strong>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/3e29f58d3d2ecee4d0cdb9734fd15b73.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3e29f58d3d2ecee4d0cdb9734fd15b73.png" alt=""></a></p>
<p><strong>æœåŠ¡å™¨å‘æµè§ˆå™¨é—´éš”5ç§’æ¨é€æ•°æ®ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/c3bf6bd4957cfb46958f58537ba527f8.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/c3bf6bd4957cfb46958f58537ba527f8.png" alt=""></a></p>
<h2 id="14-4-æ¥å•æé†’ï¼ˆWebSocketçš„åº”ç”¨ï¼‰"><strong>14.4 æ¥å•æé†’ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</strong></h2>
<p>ç”¨æˆ·ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸåï¼Œéœ€è¦ç¬¬ä¸€æ—¶é—´é€šçŸ¥å¤–å–å•†å®¶ã€‚é€šçŸ¥çš„å½¢å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>
<p>è¯­éŸ³æ’­æŠ¥</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/4845eded7acb1997db75140fb403a1c4.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/4845eded7acb1997db75140fb403a1c4.png" alt=""></a></p>
</li>
<li>
<p>å¼¹å‡ºæç¤ºæ¡†</p>
<p>![[c0a90c9f75c76014df5f4aac65573419.png]]</p>
</li>
</ul>
<p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p>
<ul>
<li>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</li>
<li>å½“å®¢æˆ·æ”¯ä»˜åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯ æ¥å•æé†’ è¿˜æ˜¯ å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</li>
<li>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent
<ul>
<li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li>
<li>orderId ä¸ºè®¢å•id
<ul>
<li>ä¸ç®¡æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œé‚£è¿™ä¸€æ¬¡æé†’å®é™…ä¸Šéƒ½å¯¹åº”ä¸€ä¸ªè®¢å•ï¼Œæ˜¯ä½ ä¸‹äº†æŸä¸ªå•ä¹‹åæˆ–è€…æ˜¯ä½ å‚¬ä¿ƒæŸä¸ªè®¢å•ï¼Œè¿™ä¸ªæ—¶å€™ä»–æ‰ä¼šç»™ä½ ç›¸åº”çš„æé†’ï¼Œå…·ä½“ä½ æé†’çš„æ˜¯å“ªä¸ªè®¢å•å‘¢ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™ä¸ªè®¢å•idç»™æäº¤è¿‡æ¥ã€‚</li>
</ul>
</li>
<li>content ä¸ºæ¶ˆæ¯å†…å®¹
<ul>
<li>æç¤ºæ¡†æ˜¾ç¤ºçš„å†…å®¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å®ç°ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨å…¥é—¨æ¡ˆä¾‹ä¸­çš„WebSocketServerç»„ä»¶å’Œé…ç½®ç±»ï¼Œé€šè¿‡è¿™ä¸ªç»„ä»¶å’Œå’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡çš„</p>
<p>![[6705d47e318b7521834fe26942c4fce8.png]]</p>
<p>![[1ae4e286c5cb1565515761e4a1f0138a.png]]</p>
<p>![[/image 7 26.png|image 7 26.png]]</p>
<p>é—®é¢˜ï¼šè¿™æ¬¡è¯·æ±‚çš„urlåœ°å€ï¼ˆ<code>ws://localhost/ws/nhxkyfec7m</code>ï¼‰å¹¶æ²¡æœ‰å†™<code>8080</code>(tomactæœåŠ¡å™¨ç«¯å£å·)ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¯·æ±‚åˆ°åå°çš„tomactæœåŠ¡å™¨å‘¢ï¼Ÿï¼Ÿï¼Ÿ<br>
ç­”ï¼šå…ˆè¯·æ±‚åˆ°nginxï¼Œç„¶ååœ¨é€šè¿‡nginxåå‘ä»£ç†è½¬å‘åˆ°åç«¯tomactæœåŠ¡å™¨ã€‚</p>
<p>![[/image 8 23.png|image 8 23.png]]</p>
<p>![[/image 9 22.png|image 9 22.png]]</p>
</li>
<li>
<p>å‰ç«¯ä»£ç å·²ç»æä¾›å¥½äº†ï¼Œé‡Œé¢å·²ç»å†™å¥½WebSocketServerçš„å®¢æˆ·ç«¯ä»£ç ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€äº›jsä»£ç ã€‚</p>
</li>
</ol>
<p>ç”¨æˆ·<strong>ä¸‹å•å¹¶ä¸”æ”¯ä»˜æˆåŠŸ</strong>ä¹‹ååŸºäºWebSocketServerå‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬åœ¨WebSocketServerä¸­å·²ç»åˆ›å»ºå¥½äº†ç¾¤å‘çš„æ–¹æ³•ï¼Œæ‰€ä»¥åªéœ€è¦è°ƒç”¨è¿™ä¸ªç¾¤å‘çš„æ–¹æ³•å³å¯ã€‚</p>
<p>![[0dcc7cf0e7c580aa79c49a600a162081.png]]</p>
<p><strong>åœ¨OrderServiceImplä¸­æ³¨å…¥WebSocketServerå¯¹è±¡ï¼Œä¿®æ”¹paySuccessæ–¹æ³•ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WebSocketServer webSocketServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ”¯ä»˜æˆåŠŸï¼Œä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outTradeNo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getByNumber(outTradeNo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®è®¢å•idæ›´æ–°è®¢å•çš„çŠ¶æ€ã€æ”¯ä»˜æ–¹å¼ã€æ”¯ä»˜çŠ¶æ€ã€ç»“è´¦æ—¶é—´</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">            .id(ordersDB.getId())</span><br><span class="line">            .status(Orders.TO_BE_CONFIRMED)</span><br><span class="line">            .payStatus(Orders.PAID)</span><br><span class="line">            .checkoutTime(LocalDateTime.now())</span><br><span class="line">            .build();</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡webSocketServerå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">//è¦æ±‚æ¨é€çš„æ¶ˆæ¯æ ¼å¼æ˜¯jsonç±»å‹ï¼Œå¹¶ä¸”åŒ…å«3ä¸ªå­—æ®µï¼ˆtypeã€orderIdã€contentï¼‰</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map.put(<span class="string">&quot;type&quot;</span>, <span class="number">1</span>);<span class="comment">//æ¶ˆæ¯ç±»å‹ï¼Œ1è¡¨ç¤ºæ¥å•æé†’</span></span><br><span class="line">    map.put(<span class="string">&quot;orderId&quot;</span>, orders.getId()); <span class="comment">//è®¢å•çš„id</span></span><br><span class="line">    map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;è®¢å•å·ï¼š&quot;</span> + outTradeNo);<span class="comment">//è®¢å•å·</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è½¬åŒ–ä¸ºjsonæ ¼å¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(map);</span><br><span class="line">    <span class="comment">//é€šè¿‡WebSocketå®ç°æ¥å•æé†’ï¼Œå‘å®¢æˆ·ç«¯æµè§ˆå™¨æ¨é€æ¶ˆæ¯(è°ƒç”¨WebSocketServerç±»ä¸­ç¾¤å‘çš„æ–¹æ³•)</span></span><br><span class="line">    webSocketServer.sendToAllClient(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºä¹‹å‰è·³è¿‡äº†æ”¯ä»˜åŠŸèƒ½ï¼ˆæ²¡æœ‰å•†æˆ·å·ï¼‰ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªæ–°çš„æ›´æ–°åŠŸèƒ½ï¼ˆç‚¹å‡»æ”¯ä»˜åï¼‰ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä»£ç å†™åœ¨è‡ªå·±å†™çš„æ›´æ–°åŠŸèƒ½ä¹‹åã€‚</p>
<p>![[85cf7f350dfc7171e540e21c3dbb6460.png]]</p>
<p>åªæç¤ºæ²¡æœ‰å£°éŸ³è®¾ç½®</p>
<p>![[c280a95927d4dbb8e82122f7d16a25b0.png]]</p>
<h2 id="14-5-å®¢æˆ·å‚¬å•ï¼ˆWebSocketçš„åº”ç”¨ï¼‰">14.5 <strong>å®¢æˆ·å‚¬å•ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</strong></h2>
<p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p>
<ul>
<li>
<p>é€šè¿‡WebSocketå®ç°ç®¡ç†ç«¯é¡µé¢å’ŒæœåŠ¡ç«¯ä¿æŒé•¿è¿æ¥çŠ¶æ€</p>
</li>
<li>
<p>å½“ç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œè°ƒç”¨WebSocketçš„ç›¸å…³APIå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯</p>
</li>
<li>
<p>å®¢æˆ·ç«¯æµè§ˆå™¨è§£ææœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ï¼Œåˆ¤æ–­æ˜¯æ¥å•æé†’è¿˜æ˜¯å®¢æˆ·å‚¬å•ï¼Œè¿›è¡Œç›¸åº”çš„æ¶ˆæ¯æç¤ºå’Œè¯­éŸ³æ’­æŠ¥</p>
<p>çº¦å®šæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨çš„æ•°æ®æ ¼å¼ä¸ºJSONï¼Œå­—æ®µåŒ…æ‹¬ï¼štypeï¼ŒorderIdï¼Œcontent</p>
<ul>
<li>type ä¸ºæ¶ˆæ¯ç±»å‹ï¼Œ1ä¸ºæ¥å•æé†’ 2ä¸ºå®¢æˆ·å‚¬å•</li>
<li>orderId ä¸ºè®¢å•id</li>
<li>content ä¸ºæ¶ˆæ¯å†…å®¹</li>
</ul>
</li>
</ul>
<p>å®¢æˆ·å‚¬å•å’Œæ¥ç”µæé†’çš„åŒºåˆ«</p>
<ul>
<li>æ¥ç”µæé†’çš„æ¶ˆæ¯ç±»å‹ä¸º<code>æ¥ç”µæé†’</code>ï¼Œå®¢æˆ·å‚¬å•çš„æ¶ˆæ¯ç±»å‹ä¸º<code>å®¢æˆ·å‚¬å•</code></li>
<li>å®¢æˆ·å‚¬å•æ˜¯ç”±å®¢æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®ä¸»åŠ¨è§¦å‘çš„ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªæ¥å£ï¼Œç”¨æˆ·ç‚¹å‡»å‚¬å•æŒ‰é’®åï¼Œå®ƒä¼šå‘èµ·ä¸€æ¬¡è¯·æ±‚ è¯·æ±‚è¿™ä¸ªæœåŠ¡ç«¯ã€‚</li>
</ul>
<p>å‚¬å•å‚¬çš„æ˜¯å“ªä¸€ä¸ªè®¢å•ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™ä¸ªè®¢å•çš„æ ‡è¯†ï¼ˆè®¢å•çš„idï¼‰ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;ç”¨æˆ·å‚¬å•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">reminder</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    orderService.reminder(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å‚¬å•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reminder</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒè®¢å•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŸºäºWebSocketå®ç°å‚¬å•</span></span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map.put(<span class="string">&quot;type&quot;</span>, <span class="number">2</span>);<span class="comment">//1è¡¨ç¤ºæ¥ç”µæé†’ 2ä»£è¡¨ç”¨æˆ·å‚¬å•</span></span><br><span class="line">    map.put(<span class="string">&quot;orderId&quot;</span>, id);<span class="comment">//è®¢å•çš„id</span></span><br><span class="line">    map.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;è®¢å•å·ï¼š&quot;</span> + ordersDB.getNumber());<span class="comment">//è®¢å•å·</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‚æ•°éœ€è¦jsonç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬åŒ–(è°ƒç”¨WebSocketServerç»„ä»¶ä¸­ç¾¤å‘çš„æ–¹æ³•)</span></span><br><span class="line">    webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>åäº”ã€<strong>Apache EChartsï¼Œè¥ä¸šé¢ç»Ÿè®¡ï¼Œç”¨æˆ·ç»Ÿè®¡ï¼Œè®¢å•ç»Ÿè®¡ï¼Œé”€é‡æ’åTop10</strong></h1>
<h2 id="15-1-Apache-EChartsï¼ˆå‰ç«¯æŠ€æœ¯ï¼‰">15.1 <strong>Apache EChartsï¼ˆå‰ç«¯æŠ€æœ¯ï¼‰</strong></h2>
<p>![[4e07ca1da81bf66d3afed8db98c908bc.png]]</p>
<p>ApacheÂ EChartsÂ æ˜¯ä¸€æ¬¾åŸºäº Javascript çš„<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96&amp;spm=1001.2101.3001.7020">æ•°æ®å¯è§†åŒ–</a>å›¾è¡¨åº“ï¼Œæä¾›ç›´è§‚ï¼Œç”ŸåŠ¨ï¼Œå¯äº¤äº’ï¼Œå¯ä¸ªæ€§åŒ–å®šåˆ¶çš„æ•°æ®å¯è§†åŒ–å›¾è¡¨ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html">https://echarts.apache.org/zh/index.html</a></p>
<h3 id="15-1-1-å…¥é—¨æ¡ˆä¾‹">15.1.1 å…¥é—¨æ¡ˆä¾‹</h3>
<p>Apache Echartså®˜æ–¹æä¾›çš„å¿«é€Ÿå…¥é—¨ï¼š<code>https://echarts.apache.org/handbook/zh/get-started/</code></p>
<p>![[5180e044d7f14804cead90ed3b06e7fa.png]]</p>
<p><strong>å®ç°æ­¥éª¤ï¼š</strong></p>
<p>1). å¼•å…¥echarts.js æ–‡ä»¶ï¼ˆå®˜æ–¹æ–‡ä»¶ï¼Œæˆ‘ä¸‹è½½ä¿å­˜åœ¨&quot;D:\86159\javaweb\delivery-resources\cangqiong\echarts.jsâ€ï¼‰</p>
<p>2). ä¸º ECharts å‡†å¤‡ä¸€ä¸ªè®¾ç½®å®½é«˜çš„ DOMï¼Œä¸€èˆ¬æ˜¯div</p>
<p>3). åˆå§‹åŒ–echartså®ä¾‹</p>
<p>4). æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®</p>
<p>5). ä½¿ç”¨æŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;ECharts&lt;/title&gt;</span><br><span class="line">    &lt;!-- <span class="number">1.</span>å¼•å…¥åˆšåˆšä¸‹è½½çš„ ECharts æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;echarts.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- <span class="number">2.</span>ä¸º ECharts å‡†å¤‡ä¸€ä¸ªå®šä¹‰äº†å®½é«˜çš„ DOMï¼Œç”¨æ¥å±•ç¤ºå›¾æ ‡çš„åŒºåŸŸ --&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;main&quot;</span> style=<span class="string">&quot;width: 600px;height:400px;&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        <span class="comment">// åŸºäºå‡†å¤‡å¥½çš„domï¼Œåˆå§‹åŒ–echartsï¼ˆå›¾æ ‡ï¼‰å®ä¾‹</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">myChart</span> <span class="operator">=</span> echarts.init(document.getElementById(<span class="string">&#x27;main&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">option</span> <span class="operator">=</span> &#123;</span><br><span class="line">            title: &#123; <span class="comment">//æ ‡é¢˜</span></span><br><span class="line">                text: <span class="string">&#x27;ECharts å…¥é—¨ç¤ºä¾‹&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;</span><br><span class="line">                trigger: <span class="string">&#x27;axis&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            legend: &#123; <span class="comment">//å›¾ä¾‹</span></span><br><span class="line">                data: [<span class="string">&#x27;é”€é‡&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;<span class="comment">//xè½´æ¨ªåæ ‡å±•ç¤ºçš„åŒºåŸŸ</span></span><br><span class="line">                type: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">                data: [<span class="string">&#x27;è¡¬è¡«&#x27;</span>, <span class="string">&#x27;ç¾Šæ¯›è¡«&#x27;</span>, <span class="string">&#x27;é›ªçººè¡«&#x27;</span>, <span class="string">&#x27;è£¤å­&#x27;</span>, <span class="string">&#x27;é«˜è·Ÿé‹&#x27;</span>, <span class="string">&#x27;è¢œå­&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;</span><br><span class="line">                type: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: <span class="string">&#x27;é”€é‡&#x27;</span>,</span><br><span class="line">                    type: <span class="string">&#x27;bar&#x27;</span>,<span class="comment">//ä»£è¡¨æŸ±çŠ¶å›¾</span></span><br><span class="line">                    <span class="comment">//4.çºµåæ ‡å±•ç¤ºçš„æ•°æ®ï¼Œæ¯ä¸ªæ•°å­—å¯¹åº”ä¸Šé¢æ¨ªåæ ‡å“åº”çš„ä¸€ä¸ªé…ç½®é¡¹</span></span><br><span class="line">                    data: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚</span></span><br><span class="line">        myChart.setOption(option);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>tooltip</code>
<ul>
<li><code>**trigger: 'axis'**</code>ï¼šè®¾ç½®æç¤ºæ¡†çš„è§¦å‘æ–¹å¼ä¸º â€œaxisâ€ï¼Œè¡¨ç¤ºå½“é¼ æ ‡æ‚¬åœåœ¨ X è½´æˆ– Y è½´ä¸Šçš„æ•°æ®ç‚¹æ—¶ï¼Œä¼šæ˜¾ç¤ºå¯¹åº”çš„æ‰€æœ‰ç³»åˆ—çš„æç¤ºä¿¡æ¯ã€‚</li>
</ul>
</li>
<li><code>legend</code>
<ul>
<li><code>**data: ['é”€å”®é‡']**</code>ï¼šå®šä¹‰å›¾ä¾‹çš„å†…å®¹ï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ªç³»åˆ— â€œé”€å”®é‡â€ã€‚å›¾ä¾‹ç”¨äºæ ‡è¯†å›¾è¡¨ä¸­å„æ•°æ®ç³»åˆ—çš„åç§°ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç‚¹å‡»å›¾ä¾‹æ¥æ§åˆ¶æŸäº›æ•°æ®ç³»åˆ—çš„æ˜¾ç¤ºæˆ–éšè—ã€‚</li>
</ul>
</li>
<li><code>xAxis</code>
<ul>
<li><code>**type: 'category'**</code>ï¼šè®¾ç½® X è½´ä¸ºç±»ç›®è½´ï¼Œé€‚ç”¨äºç¦»æ•£çš„ã€åˆ†ç±»çš„æ•°æ®ã€‚</li>
</ul>
</li>
<li><code>yAxis</code>
<ul>
<li><code>**type: 'value'**</code>ï¼šè®¾ç½® Y è½´ä¸ºæ•°å€¼è½´ï¼Œé€‚ç”¨äºè¿ç»­çš„æ•°å€¼æ•°æ®ã€‚</li>
</ul>
</li>
<li><code>series</code>
<ul>
<li><code>**series: [&#123; ... &#125;]**</code>ï¼šå®šä¹‰å›¾è¡¨çš„æ•°æ®ç³»åˆ—ã€‚
<ul>
<li><code>**name: 'é”€å”®é‡'**</code>ï¼šç³»åˆ—çš„åç§°ã€‚</li>
<li><code>**type: 'line'**</code>ï¼šè®¾ç½®å›¾è¡¨ç±»å‹ä¸ºæŠ˜çº¿å›¾ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>ä½¿ç”¨Echartsï¼Œé‡ç‚¹åœ¨äºç ”ç©¶å½“å‰å›¾è¡¨æ‰€éœ€çš„Â <code>**æ•°æ®æ ¼å¼**</code>ã€‚é€šå¸¸æ˜¯éœ€è¦åç«¯æä¾›ç¬¦åˆæ ¼å¼è¦æ±‚çš„åŠ¨æ€æ•°æ®ï¼Œç„¶åå“åº”ç»™å‰ç«¯æ¥å±•ç¤ºå›¾è¡¨ã€‚</p>
<p>è¯´æ˜ï¼šå…¥é—¨æ¡ˆä¾‹ä¸­çš„æ•°æ®æ²¡æœ‰å’Œå‰ç«¯è¿›è¡Œäº¤äº’ï¼Œè¿™äº›æ•°æ®æ˜¯ç›´æ¥å†™æ­»åœ¨é¡µé¢ä¸­çš„ï¼ŒçœŸå®çš„é¡¹ç›®ä¸­è¿™äº›æ•°æ®ï¼Œéƒ½æ˜¯åç«¯æŸ¥è¯¢æ•°æ®åº“è¿”å›ç»™å‰ç«¯åŠ¨æ€è·å–çš„ã€‚</p>
<h2 id="15-2-è¥ä¸šé¢ç»Ÿè®¡">15.2 è¥ä¸šé¢ç»Ÿè®¡</h2>
<p>è¥ä¸šé¢ç»Ÿè®¡æ˜¯åŸºäºæŠ˜ç°å›¾æ¥å±•ç°ï¼Œå¹¶ä¸”æŒ‰ç…§å¤©æ¥å±•ç¤ºçš„ã€‚å®é™…ä¸Šï¼Œå°±æ˜¯æŸä¸€ä¸ªæ—¶é—´èŒƒå›´ä¹‹å†…çš„æ¯ä¸€å¤©çš„è¥ä¸šé¢ã€‚åŒæ—¶ï¼Œä¸ç®¡å…‰æ ‡æ”¾åœ¨å“ªä¸ªç‚¹ä¸Šï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæŠŠå…·ä½“çš„æ•°å€¼å±•ç¤ºå‡ºæ¥ã€‚å¹¶ä¸”è¿˜éœ€è¦æ³¨æ„æ—¥æœŸå¹¶ä¸æ˜¯å›ºå®šå†™æ­»çš„ï¼Œæ˜¯ç”±ä¸Šè¾¹æ—¶é—´é€‰æ‹©å™¨æ¥å†³å®šã€‚æ¯”å¦‚é€‰æ‹©æ˜¯è¿‘7å¤©ã€æˆ–è€…æ˜¯è¿‘30æ—¥ï¼Œæˆ–è€…æ˜¯æœ¬å‘¨ï¼Œå°±ä¼šæŠŠç›¸åº”è¿™ä¸ªæ—¶é—´æ®µä¹‹å†…çš„æ¯ä¸€å¤©æ—¥æœŸé€šè¿‡æ¨ªåæ ‡å±•ç¤ºã€‚</p>
<p>![[3e181e421c14a6eb91cdf89d0bd9b281.png]]</p>
<p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>è¥ä¸šé¢æŒ‡è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆçš„è®¢å•é‡‘é¢åˆè®¡</li>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè¥ä¸šé¢æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè¥ä¸šé¢</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è¥ä¸šé¢æ•°æ®</li>
</ul>
<p>![[2d51ee4d1eaa9b54456a5e572c60f1ef.png]]</p>
<p><strong>æ³¨æ„</strong>ï¼šå…·ä½“è¿”å›æ•°æ®ä¸€èˆ¬ç”±å‰ç«¯æ¥å†³å®šï¼Œå‰ç«¯å±•ç¤ºå›¾è¡¨ï¼Œå…·ä½“æŠ˜ç°å›¾å¯¹åº”æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œæ˜¯æœ‰å›ºå®šçš„è¦æ±‚çš„ã€‚æ‰€ä»¥è¯´ï¼Œåç«¯éœ€è¦å»é€‚åº”å‰ç«¯ï¼Œå®ƒéœ€è¦ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±ç»™å®ƒè¿”å›ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">TurnoverReportVO.java</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TurnoverReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line">    <span class="comment">//è¥ä¸šé¢ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š406.0,1520.0,75.0</span></span><br><span class="line">    <span class="keyword">private</span> String turnoverList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/turnoverStatistics&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;è¥ä¸šé¢æ•°æ®ç»Ÿè®¡&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;TurnoverReportVO&gt; <span class="title function_">turnoverStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">			LocalDate begin,</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span></span><br><span class="line"><span class="params">			LocalDate end</span></span><br><span class="line"><span class="params">	)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(reportService.getTurnover(begin, end));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ReportService</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ReportMapper reportMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç»Ÿè®¡æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„è¥ä¸šé¢æ•°æ®ï¼šæŸ¥è¯¢çš„æ˜¯è®¢å•è¡¨ï¼ŒçŠ¶æ€å·²ç»å®Œæˆçš„è®¢å•</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> TurnoverReportVO <span class="title function_">getTurnover</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">		<span class="comment">// 1. æ—¥æœŸï¼šå½“å‰é›†åˆç”¨äºå­˜æ”¾ä»beginåˆ°endèŒƒå›´å†…æ¯å¤©çš„æ—¥æœŸ</span></span><br><span class="line">		List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		dateList.add(begin);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (!begin.equals(end)) &#123;</span><br><span class="line">			begin = begin.plusDays(<span class="number">1</span>); <span class="comment">// è·å–æŒ‡å®šæ—¥æœŸåä¸€å¤©çš„æ—¥æœŸ</span></span><br><span class="line">			dateList.add(begin);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ç°åœ¨æ˜¯listç±»å‹è€Œvoç±»ä¸­çš„dateListè¦æ±‚æ˜¯Stringç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬åŒ–</span></span><br><span class="line">		<span class="comment">// æŠŠlisté›†åˆçš„æ¯ä¸ªå…ƒç´ å–å‡ºæ¥å¹¶ä¸”ä»¥é€—å·åˆ†éš”ï¼Œæœ€ç»ˆæ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2. è¥ä¸šé¢ï¼šæ˜¯å’Œæ—¥æœŸä¸€ä¸€å¯¹åº”çš„</span></span><br><span class="line">		<span class="comment">// æ‰€ä»¥éœ€è¦éå†è·å–æ¯å¤©çš„æ—¥æœŸï¼Œç„¶åæŸ¥è¯¢æ•°æ®åº“æŠŠæ¯å¤©çš„è¥ä¸šé¢æŸ¥å‡ºæ¥ï¼Œä¸­é—´ç”¨é€—å·éš”å¼€</span></span><br><span class="line">		<span class="comment">// å½“å‰é›†åˆå­˜æ”¾æ¯å¤©è¥ä¸šé¢</span></span><br><span class="line">		ArrayList&lt;Double&gt; turnoverList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (LocalDate date : dateList) &#123;</span><br><span class="line">			<span class="comment">// æŸ¥è¯¢dataæ—¥æœŸå¯¹åº”çš„è¥ä¸šé¢æ•°æ®ï¼Œè¥ä¸šé¢æ˜¯æŒ‡ï¼šçŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€çš„è®¢å•é‡‘é¢åˆè®¡</span></span><br><span class="line">			<span class="comment">// è·å–çš„dateï¼ˆæ¯æ—¥ï¼‰åªå«æœ‰å¹´æœˆæ—¥æ²¡æœ‰ä½“ç°æ—¶åˆ†ç§’ï¼Œè€Œè¿™ä¸ªorder_timeä¸‹å•æ—¶é—´æ˜¯</span></span><br><span class="line">			<span class="comment">//      LocalDateTimeç±»å‹ï¼Œæ—¢æœ‰å¹´æœˆæ—¥åˆæœ‰æ—¶åˆ†ç§’ï¼Œæ‰€ä»¥è¦æŸ¥è¯¢dateè¿™ä¸€å¤©çš„</span></span><br><span class="line">			<span class="comment">//      è®¢å•å°±éœ€è¦æ¥è®¡ç®—è¿™ä¸€å¤©çš„èµ·å§‹æ—¶é—´æ˜¯ä»ä»€ä¹ˆæ—¶åˆ»å¼€å§‹ï¼ˆå½“å¤©çš„0æ—¶0åˆ†0ç§’ï¼‰ï¼Œ</span></span><br><span class="line">			<span class="comment">//      è¿™ä¸€å¤©çš„ç»“æŸæ—¶é—´æ˜¯ä»ä»€ä¹ˆæ—¶å€™ç»“æŸï¼ˆ11:59:59ï¼Œæ— é™æ¥è¿‘ä¸‹ä¸€å¤©çš„0æ—¶0åˆ†0ç§’ï¼‰ã€‚</span></span><br><span class="line">			<span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MIN);<span class="comment">// è·å–å½“å¤©çš„å¼€å§‹æ—¶é—´ï¼šå¹´æœˆæ—¥æ—¶åˆ†ç§’</span></span><br><span class="line">			<span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MAX);<span class="comment">// è·å–å½“å¤©çš„ç»“æŸæ—¶é—´ï¼šå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼ˆæ— é™æ¥è¿‘äºä¸‹ä¸€å¤©çš„0æ—¶0åˆ†0ç§’ï¼‰</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// select sum(amount) from orders where order_time &gt; ? and order_time &lt; ? and status = 5;</span></span><br><span class="line">			<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();<span class="comment">// å°è£…sqlæ‰€éœ€è¦çš„å‚æ•°ä¸ºä¸€ä¸ªmapé›†åˆ</span></span><br><span class="line">			map.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">			map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">			map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);<span class="comment">// å·²å®Œæˆ</span></span><br><span class="line">			<span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map);<span class="comment">// è®¡ç®—å‡ºæ¥çš„è¥ä¸šé¢</span></span><br><span class="line">			<span class="comment">// å‡è®¾è¿™ä¸€å¤©ä¸€ä¸ªè®¢å•éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆè¥ä¸šé¢åº”è¯¥æ˜¯0.0æ‰å¯¹ï¼Œè€Œè¿™é‡ŒæŸ¥è¯¢å‡ºçš„æ¥è¥ä¸šé¢</span></span><br><span class="line">			<span class="comment">//   ä¸ºç©ºæ˜¾ç„¶ä¸åˆç†ï¼Œæ‰€ä»¥å¦‚æœè¿”å›ä¸ºç©ºçš„æ—¶å€™éœ€è¦æŠŠå®ƒè½¬åŒ–ä¸º0.0ã€‚</span></span><br><span class="line">			turnover = turnover == <span class="literal">null</span> ? <span class="number">0.0</span> : turnover;</span><br><span class="line">			turnoverList.add(turnover);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//åŒæ ·éœ€è¦æŠŠé›†åˆç±»å‹è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ç±»å‹å¹¶ç”¨é€—å·åˆ†éš”</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">turnovre</span> <span class="operator">=</span> StringUtils.join(turnoverList, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ„å»ºVOå¯¹è±¡</span></span><br><span class="line">		<span class="type">TurnoverReportVO</span> <span class="variable">trvo</span> <span class="operator">=</span> TurnoverReportVO.builder()</span><br><span class="line">				.dateList(data)</span><br><span class="line">				.turnoverList(turnovre)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> trvo;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;sumByMap&quot;</span> resultType=<span class="string">&quot;java.lang.Double&quot;</span>&gt;</span><br><span class="line">        select <span class="title function_">sum</span><span class="params">(amount)</span> from orders</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">                <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;begin != null&quot;</span>&gt;</span><br><span class="line">                and order_time &amp;gt;= #&#123;begin&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;end != null&quot;</span>&gt;</span><br><span class="line">                and order_time &amp;lt;= #&#123;end&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="15-3-ç”¨æˆ·ç»Ÿè®¡">15.3 <strong>ç”¨æˆ·ç»Ÿè®¡</strong></h2>
<p>ç»Ÿè®¡çš„æ˜¯ç”¨æˆ·çš„æ•°é‡ã€‚é€šè¿‡æŠ˜çº¿å›¾æ¥å±•ç¤ºï¼Œä¸Šé¢è¿™æ ¹è“è‰²çº¿ä»£è¡¨çš„æ˜¯ç”¨æˆ·æ€»é‡ï¼Œä¸‹è¾¹è¿™æ ¹ç»¿è‰²çº¿ä»£è¡¨çš„æ˜¯æ–°å¢ç”¨æˆ·æ•°é‡ï¼Œæ˜¯å…·ä½“åˆ°æ¯ä¸€å¤©ã€‚æ‰€ä»¥è¯´ç”¨æˆ·ç»Ÿè®¡ä¸»è¦ç»Ÿè®¡<strong>ä¸¤ä¸ªæ•°æ®</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>æ€»çš„ç”¨æˆ·æ•°é‡</strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯<strong>æ–°å¢ç”¨æˆ·æ•°é‡</strong>ã€‚</p>
<p>![[1ee9be4a04ca948f0822eb7613ab7be2.png]]</p>
<p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºç”¨æˆ·æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºç”¨æˆ·æ•°</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„ç”¨æˆ·æ€»é‡å’Œæ–°å¢ç”¨æˆ·é‡æ•°æ®</li>
</ul>
<p>![[02b7aa4b83eff0a371091e619096c7bf.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">UserReportVO.java</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line">    <span class="comment">//ç”¨æˆ·æ€»é‡ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š200,210,220</span></span><br><span class="line">    <span class="keyword">private</span> String totalUserList;</span><br><span class="line">    <span class="comment">//æ–°å¢ç”¨æˆ·ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š20,21,10</span></span><br><span class="line">    <span class="keyword">private</span> String newUserList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/userStatistics&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;ç”¨æˆ·æ•°æ®ç»Ÿè®¡&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;UserReportVO&gt; <span class="title function_">userStatistics</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Result.success(reportService.getUserStatistics(begin, end));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer <span class="title function_">getUserCount</span><span class="params">(LocalDateTime beginTime, LocalDateTime endTime)</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		map.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">		map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">		<span class="keyword">return</span> userMapper.countByMap(map);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	  &lt;select id=<span class="string">&quot;countByMap&quot;</span> resultType=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span><br><span class="line">        select <span class="title function_">count</span><span class="params">(id)</span> from user</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;begin != null&quot;</span>&gt;</span><br><span class="line">                and create_time &amp;gt;= #&#123;begin&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;end != null&quot;</span>&gt;</span><br><span class="line">                and create_time &amp;lt;= #&#123;end&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/where&gt;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="15-4-è®¢å•ç»Ÿè®¡">15.4 <strong>è®¢å•ç»Ÿè®¡</strong></h2>
<p>è®¢å•ç»Ÿè®¡é€šè¿‡ä¸€ä¸ªæŠ˜ç°å›¾æ¥å±•ç°ï¼ŒæŠ˜çº¿å›¾ä¸Šæœ‰ä¸¤æ ¹çº¿ï¼Œè¿™æ ¹è“è‰²çš„çº¿ä»£è¡¨çš„æ˜¯<strong>è®¢å•æ€»æ•°</strong>ï¼Œè€Œä¸‹è¾¹è¿™æ ¹ç»¿è‰²çš„çº¿ä»£è¡¨çš„æ˜¯<strong>æœ‰æ•ˆè®¢å•æ•°</strong>ï¼ŒæŒ‡çš„å°±æ˜¯çŠ¶æ€æ˜¯<strong>å·²å®Œæˆçš„è®¢å•</strong>å°±å±äºæœ‰æ•ˆè®¢å•ï¼Œåˆ†åˆ«åæ˜ çš„æ˜¯<strong>æ¯ä¸€å¤©çš„æ•°æ®</strong>ã€‚ä¸Šé¢è¿˜æœ‰3ä¸ªæ•°å­—ï¼Œåˆ†åˆ«æ˜¯è®¢å•æ€»æ•°ã€æœ‰æ•ˆè®¢å•ã€è®¢å•å®Œæˆç‡ï¼Œå®ƒæŒ‡çš„æ˜¯<strong>æ•´ä¸ªæ—¶é—´åŒºé—´ä¹‹å†…æ€»çš„æ•°æ®</strong>ã€‚</p>
<p>![[7064067dfb9fc89f54e686451085ab44.png]]</p>
<p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>æœ‰æ•ˆè®¢å•æŒ‡çŠ¶æ€ä¸º â€œå·²å®Œæˆâ€ çš„è®¢å•</li>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŠ˜çº¿å›¾å±•ç¤ºè®¢å•æ•°æ®ï¼ŒXè½´ä¸ºæ—¥æœŸï¼ŒYè½´ä¸ºè®¢å•æ•°é‡</li>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºæ¯å¤©çš„è®¢å•æ€»æ•°å’Œæœ‰æ•ˆè®¢å•æ•°</li>
<li>å±•ç¤ºæ‰€é€‰æ—¶é—´åŒºé—´å†…çš„æœ‰æ•ˆè®¢å•æ•°ã€æ€»è®¢å•æ•°ã€è®¢å•å®Œæˆç‡ï¼Œè®¢å•å®Œæˆç‡ = æœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•° * 100%</li>
</ul>
<p>![[297c357761facff4635b935d06693ef9.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">OrderReportVO.java</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//æ—¥æœŸï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š2022-10-01,2022-10-02,2022-10-03</span></span><br><span class="line">    <span class="keyword">private</span> String dateList;</span><br><span class="line">    <span class="comment">//æ¯æ—¥è®¢å•æ•°ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š260,210,215</span></span><br><span class="line">    <span class="keyword">private</span> String orderCountList;</span><br><span class="line">    <span class="comment">//æ¯æ—¥æœ‰æ•ˆè®¢å•æ•°ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š20,21,10</span></span><br><span class="line">    <span class="keyword">private</span> String validOrderCountList;</span><br><span class="line">    <span class="comment">//è®¢å•æ€»æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalOrderCount;</span><br><span class="line">    <span class="comment">//æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer validOrderCount;</span><br><span class="line">    <span class="comment">//è®¢å•å®Œæˆç‡</span></span><br><span class="line">    <span class="keyword">private</span> Double orderCompletionRate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> OrderReportVO <span class="title function_">getOrderStatistics</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">		<span class="comment">// 1. æ—¥æœŸ</span></span><br><span class="line">		List&lt;LocalDate&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		dateList.add(begin);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (!begin.equals(end)) &#123;</span><br><span class="line">			begin = begin.plusDays(<span class="number">1</span>);</span><br><span class="line">			dateList.add(begin);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> StringUtils.join(dateList, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¯ä¸€å¤©çš„è®¢å•æ•°é‡ï¼šè®¢å•æ€»æ•°ï¼Œæœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">		<span class="comment">// æ¯å¤©è®¢å•æ€»æ•°é›†åˆ</span></span><br><span class="line">		ArrayList&lt;Integer&gt; orderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="comment">// æ¯å¤©æœ‰æ•ˆè®¢å•æ•°é›†åˆ</span></span><br><span class="line">		ArrayList&lt;Integer&gt; validOrderCountList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * æ€è·¯åˆ†æï¼šæŸ¥è¯¢çš„æ˜¯è®¢å•è¡¨</span></span><br><span class="line"><span class="comment">		 * æŸ¥è¯¢æ¯å¤©çš„æ€»è®¢å•æ•°ï¼šåªéœ€è¦æ ¹æ®ä¸‹å•æ—¶é—´è®¡ç®—å‡ºå½“å¤©çš„èµ·å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œ</span></span><br><span class="line"><span class="comment">		 *                 å°±æ˜¯å½“å¤©çš„æ€»è®¢å•æ•°ã€‚</span></span><br><span class="line"><span class="comment">		 * æŸ¥è¯¢æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•°ï¼šæ ¹æ®ä¸‹å•æ—¶é—´è®¡ç®—å‡ºå½“å¤©çš„èµ·å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ä»¥åŠçŠ¶æ€å·²å®Œæˆï¼ˆä»£è¡¨æœ‰æ•ˆè®¢å•ï¼‰çš„è®¢å•ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œ</span></span><br><span class="line"><span class="comment">		 *                   å°±æ˜¯æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line"><span class="comment">		 * åŒæ ·æ²¡å¿…è¦å†™2ä¸ªsqlï¼Œå› ä¸ºè¿™2ä¸ªSQLçš„ä¸»ä½“ç»“æ„ç›¸åŒï¼Œåªæ˜¯æŸ¥è¯¢çš„æ¡ä»¶ä¸åŒï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å†™2ä¸ªsqlåªéœ€è¦å†™ä¸€ä¸ªåŠ¨æ€çš„sqlå³å¯ã€‚</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">for</span> (LocalDate date : dateList) &#123;</span><br><span class="line">			<span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MIN);</span><br><span class="line">			<span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(date, LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æŸ¥è¯¢æ¯å¤©çš„æ€»è®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ?</span></span><br><span class="line">			<span class="type">Integer</span> <span class="variable">orderCount</span> <span class="operator">=</span> getOrderCount(beginTime, endTime, <span class="literal">null</span>);</span><br><span class="line">			<span class="comment">// æŸ¥è¯¢æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•° select count(id) from orders where order_time &gt; ? and order_time &lt; ? and status = ?</span></span><br><span class="line">			<span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> getOrderCount(beginTime, endTime, Orders.COMPLETED);</span><br><span class="line"></span><br><span class="line">			orderCountList.add(orderCount);</span><br><span class="line">			validOrderCountList.add(validOrderCount);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">String</span> <span class="variable">orderCount1</span> <span class="operator">=</span> StringUtils.join(orderCountList, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">validOrderCount1</span> <span class="operator">=</span> StringUtils.join(validOrderCountList, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 3. å‡†å¤‡æ—¶é—´åŒºé—´å†…çš„è®¢å•æ•°ï¼šæ—¶é—´åŒºé—´å†…çš„æ€»è®¢å•æ•°ï¼Œæ—¶é—´åŒºé—´å†…çš„æ€»æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line"><span class="comment">		 * æ€è·¯åˆ†æï¼š</span></span><br><span class="line"><span class="comment">		 *    è®¢å•æ€»æ•°ï¼šæ•´ä¸ªè¿™ä¸ªæ—¶é—´åŒºåŸŸå†…è®¢å•æ€»çš„æ•°é‡ï¼Œæ ¹æ®è¿™ä¸ªæ—¶é—´å»å¡æŸ¥è¯¢æ•°æ®åº“å¯ä»¥æŸ¥è¯¢å‡ºæ¥ã€‚</span></span><br><span class="line"><span class="comment">		 *    æ—¶é—´åŒºé—´å†…çš„æ€»æœ‰æ•ˆè®¢å•æ•°ï¼šä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢æ•°æ®åº“æŸ¥å‡ºæ¥ã€‚</span></span><br><span class="line"><span class="comment">		 *    å®é™…ä¸Šä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œæ€»è®¢å•æ•°å’Œæ€»æœ‰æ•ˆè®¢å•æ•°ä¹Ÿèƒ½è®¡ç®—å‡ºæ¥ï¼š</span></span><br><span class="line"><span class="comment">		 *         å› ä¸ºä¸Šé¢2ä¸ªé›†åˆä¸­å·²ç»æŸ¥è¯¢ä¿å­˜äº†ï¼Œè¿™ä¸ªæ—¶é—´æ®µä¹‹å†…æ¯å¤©çš„æ€»è®¢å•æ•°å’Œæ€»æœ‰æ•ˆè®¢å•æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">		 *         æ‰€ä»¥åªéœ€è¦åˆ†åˆ«éå†è¿™2ä¸ªé›†åˆï¼Œæ¯å¤©çš„è®¢å•æ€»æ•°åŠ ä¸€èµ·å°±æ˜¯æ•´ä¸ªæ—¶é—´æ®µæ€»è®¢å•æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">		 *         æ¯å¤©çš„æœ‰æ•ˆè®¢å•æ•°åŠ èµ·æ¥å°±æ˜¯æ•´ä¸ªæ—¶é—´æ®µçš„æ€»æœ‰æ•ˆè®¢å•æ•°ã€‚</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="comment">// è®¡ç®—æ—¶é—´åŒºåŸŸå†…çš„æ€»è®¢å•æ•°é‡</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">totalOrderCounts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// æ³•ä¸€ï¼š</span></span><br><span class="line">		<span class="comment">// totalOrderCounts = orderCountList.stream().reduce(Integer::sum).get();</span></span><br><span class="line">		<span class="comment">// æ³•äºŒï¼š</span></span><br><span class="line">		<span class="keyword">for</span> (Integer integer : orderCountList) &#123;</span><br><span class="line">			totalOrderCounts += integer;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è®¡ç®—æ—¶é—´åŒºåŸŸå†…çš„æ€»æœ‰æ•ˆè®¢å•æ•°é‡</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">validOrderCounts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// æ³•ä¸€ï¼š</span></span><br><span class="line">		validOrderCounts = validOrderCountList.stream().reduce(Integer::sum).get();</span><br><span class="line">		<span class="comment">// æ³•äºŒï¼š</span></span><br><span class="line">		<span class="comment">/*for (Integer integer : validOrderCountList) &#123;</span></span><br><span class="line"><span class="comment">			validOrderCounts += integer;</span></span><br><span class="line"><span class="comment">		&#125;*/</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 4.è®¢å•å®Œæˆç‡ï¼š  æ€»æœ‰æ•ˆè®¢å•æ•°é‡/æ€»è®¢å•æ•°é‡=è®¢å•å®Œæˆç‡</span></span><br><span class="line">		<span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;  <span class="comment">// è®¢å•å®Œæˆç‡çš„åˆå§‹å€¼</span></span><br><span class="line">		<span class="keyword">if</span> (totalOrderCounts != <span class="number">0</span>) &#123;</span><br><span class="line">			orderCompletionRate = validOrderCounts.doubleValue() / totalOrderCounts; <span class="comment">// æ³¨æ„ï¼šDouble.valueOfå’Œ(double)ä¼šå¯¼è‡´ç²¾åº¦ç¼ºå¤±</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ„é€ VOå¯¹è±¡</span></span><br><span class="line">		<span class="keyword">return</span> OrderReportVO.builder()</span><br><span class="line">				.dateList(data)  <span class="comment">// xè½´æ—¥æœŸæ•°æ®</span></span><br><span class="line">				.orderCountList(orderCount1) <span class="comment">// yè½´æ¯å¤©è®¢å•æ€»æ•°</span></span><br><span class="line">				.validOrderCountList(validOrderCount1)<span class="comment">// yè½´æ¯å¤©æœ‰æ•ˆè®¢å•æ€»æ•°</span></span><br><span class="line">				.totalOrderCount(totalOrderCounts) <span class="comment">// æ—¶é—´åŒºåŸŸå†…æ€»è®¢å•æ•°</span></span><br><span class="line">				.validOrderCount(validOrderCounts) <span class="comment">// æ—¶é—´åŒºåŸŸå†…æ€»æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">				.orderCompletionRate(orderCompletionRate) <span class="comment">// è®¢å•å®Œæˆç‡</span></span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ ¹æ®æ—¶é—´åŒºé—´ç»Ÿè®¡æŒ‡å®šçŠ¶æ€çš„è®¢å•æ•°é‡</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> beginTime</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> endTime</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer <span class="title function_">getOrderCount</span><span class="params">(LocalDateTime beginTime, LocalDateTime endTime, Integer status)</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		map.put(<span class="string">&quot;begin&quot;</span>, beginTime);</span><br><span class="line">		map.put(<span class="string">&quot;end&quot;</span>, endTime);</span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, status);</span><br><span class="line">		<span class="keyword">return</span> orderMapper.countByMap(map);</span><br><span class="line">	&#125;</span><br><span class="line">xmlå’Œcontrollerçœ</span><br></pre></td></tr></table></figure>
<h2 id="15-5-é”€é‡æ’åTop10">15.5 <strong>é”€é‡æ’åTop10</strong></h2>
<p>é”€é‡æŒ‡çš„æ˜¯å•†å“é”€å”®çš„æ•°é‡ã€‚é¡¹ç›®å½“ä¸­çš„å•†å“ä¸»è¦åŒ…å«ä¸¤ç±»ï¼šä¸€ä¸ªæ˜¯<strong>å¥—é¤</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>èœå“</strong>ï¼Œæ‰€ä»¥é”€é‡æ’åå…¶å®æŒ‡çš„å°±æ˜¯èœå“å’Œå¥—é¤é”€å”®çš„æ•°é‡æ’åã€‚é€šè¿‡æŸ±å½¢å›¾æ¥å±•ç¤ºé”€é‡æ’åï¼Œè¿™äº›é”€é‡æ˜¯æŒ‰ç…§é™åºæ¥æ’åˆ—ï¼Œå¹¶ä¸”åªéœ€è¦ç»Ÿè®¡é”€é‡æ’åå‰åçš„å•†å“ã€‚</p>
<p>![[9c0531e6ffb0582160b7ce283d22a0d3.png]]</p>
<p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>æ ¹æ®æ—¶é—´é€‰æ‹©åŒºé—´ï¼Œå±•ç¤ºé”€é‡å‰10çš„å•†å“ï¼ˆåŒ…æ‹¬èœå“å’Œå¥—é¤ï¼‰</li>
<li>åŸºäºå¯è§†åŒ–æŠ¥è¡¨çš„æŸ±çŠ¶å›¾é™åºå±•ç¤ºå•†å“é”€é‡</li>
<li>æ­¤å¤„çš„é”€é‡ä¸ºå•†å“é”€å”®çš„ä»½æ•°</li>
</ul>
<p>![[fc64a9b052756380f3f2a23d01f5b1c0.png]]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">SalesTop10ReportVO.java</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SalesTop10ReportVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//å•†å“åç§°åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šé±¼é¦™è‚‰ä¸,å®«ä¿é¸¡ä¸,æ°´ç…®é±¼</span></span><br><span class="line">    <span class="keyword">private</span> String nameList;</span><br><span class="line">    <span class="comment">//é”€é‡åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š260,215,200</span></span><br><span class="line">    <span class="keyword">private</span> String numberList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.sky.dto;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsSalesDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//å•†å“åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//é”€é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/top10&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;é”€é‡æ’åç»Ÿè®¡&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;SalesTop10ReportVO&gt; <span class="title function_">top10</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate begin,</span></span><br><span class="line"><span class="params">			<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> LocalDate end)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(reportService.getSalesTop10(begin, end));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„é”€é‡æ’åtop10</span></span><br><span class="line"><span class="comment">	 * ç”¨æˆ·ä¸‹å•å°±ä¼šäº§ç”Ÿè®¢å•æ•°æ®å’Œè®¢å•è¯¦æƒ…æ•°æ®ï¼Œå¦‚è‹¥ç”¨æˆ·ä¸‹å•åå–æ¶ˆï¼Œæ•°æ®åº“ä»…å°†çŠ¶æ€ä¿®æ”¹ï¼Œè®¢å•å­˜åœ¨ï¼Œåº”è¯¥ç»Ÿè®¡å®ŒæˆçŠ¶æ€çš„è®¢å•</span></span><br><span class="line"><span class="comment">	 * è®¢å•è¯¦æƒ…è¡¨ä¸èƒ½ä½“ç°å‡ºè®¢å•çš„çŠ¶æ€ï¼Œå…·ä½“çš„è®¢å•çŠ¶æ€è¿˜è¦æŸ¥è¯¢è®¢å•è¡¨æ‰å¯ä»¥çœ‹å‡ºæ¥</span></span><br><span class="line"><span class="comment">	 * æ‰€ä»¥éœ€è¦å¤šè¡¨è”åˆæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">	 * SELECT od.name, SUM(od.number)</span></span><br><span class="line"><span class="comment">	 * FROM order_detail od</span></span><br><span class="line"><span class="comment">	 * JOIN orders o ON od.order_id = o.id</span></span><br><span class="line"><span class="comment">	 * WHERE o.status = 5</span></span><br><span class="line"><span class="comment">	 * AND o.order_time &gt; ?</span></span><br><span class="line"><span class="comment">	 * AND o.order_time &lt; ?</span></span><br><span class="line"><span class="comment">	 * GROUP BY od.name</span></span><br><span class="line"><span class="comment">	 * ORDER BY total_number DESC</span></span><br><span class="line"><span class="comment">	 * LIMIT 0, 10;</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> sqlæŸ¥è¯¢çš„ç»“æœå°è£…åˆ°GoodsSalesDTOå®ä½“ç±»ä¸­ï¼šå•†å“åç§°  é”€é‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> SalesTop10ReportVO <span class="title function_">getSalesTop10</span><span class="params">(LocalDate begin, LocalDate end)</span> &#123;</span><br><span class="line">		<span class="comment">// mapperä¼ é€’çš„å‚æ•°æ˜¯LocalDateTimeç±»å‹ï¼Œimplå±‚ä¼ é€’çš„å‚æ•°æ˜¯LocalDateæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬åŒ–</span></span><br><span class="line">		<span class="type">LocalDateTime</span> <span class="variable">beginTime</span> <span class="operator">=</span> LocalDateTime.of(begin, LocalTime.MIN);</span><br><span class="line">		<span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.of(end, LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">		List&lt;GoodsSalesDTO&gt; goodsSalesDTOList = orderMapper.getSalesTop10(beginTime, endTime);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å·²æœ‰GoodsSalesDTOç±»å‹çš„é›†åˆæ•°æ®ï¼šString nameå•†å“åç§°ï¼ŒInteger numberé”€é‡</span></span><br><span class="line">		<span class="comment">// éœ€è·å–VOå¯¹è±¡ç±»å‹ï¼šString nameList å•†å“åç§°åˆ—è¡¨ï¼ŒString numberListé”€é‡åˆ—è¡¨</span></span><br><span class="line">		<span class="comment">// æ³•ä¸€ï¼šstreamæµ</span></span><br><span class="line">		<span class="comment">// String nameList = StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getName).collect(Collectors.toList()), &quot;,&quot;);</span></span><br><span class="line">		<span class="comment">// String numberList = StringUtils.join(goodsSalesDTOList.stream().map(GoodsSalesDTO::getNumber).collect(Collectors.toList()), &quot;,&quot;);</span></span><br><span class="line">		<span class="comment">// æ³•äºŒï¼š</span></span><br><span class="line">		ArrayList&lt;String&gt; nameList1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		ArrayList&lt;Integer&gt; numberList1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (GoodsSalesDTO goodsSalesDTO : goodsSalesDTOList) &#123;</span><br><span class="line">			nameList1.add(goodsSalesDTO.getName());</span><br><span class="line">			numberList1.add(goodsSalesDTO.getNumber());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">String</span> <span class="variable">nameList</span> <span class="operator">=</span> StringUtils.join(nameList1, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">numberList</span> <span class="operator">=</span> StringUtils.join(numberList1, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> SalesTop10ReportVO.builder()</span><br><span class="line">				.nameList(nameList)</span><br><span class="line">				.numberList(numberList)</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;getSalesTop10&quot;</span> resultType=<span class="string">&quot;com.sky.dto.GoodsSalesDTO&quot;</span>&gt;</span><br><span class="line">        select od.name name, sum(od.number) number</span><br><span class="line">        from order_detail od</span><br><span class="line">        join orders o on od.order_id = o.id</span><br><span class="line">        where o.status = <span class="number">5</span></span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;beginTime != null&quot;</span>&gt;</span><br><span class="line">            and order_time &amp;gt;= #&#123;beginTime&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;endTime != null&quot;</span>&gt;</span><br><span class="line">            and order_time &amp;lt;= #&#123;endTime&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        # TODO ä¸ºå•¥å­æˆ‘çš„begin,endä¸è¡Œï¼Œä¸€å®šè¦æ”¹æˆbeginTimeï¼ŒendTime</span><br><span class="line">        group by od.name</span><br><span class="line">        order by number desc</span><br><span class="line">        limit <span class="number">0</span>, <span class="number">10</span></span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h1>åå…­ã€<strong>å·¥ä½œå°ä¸šåŠ¡ä»£ç ï¼ŒApache POIï¼Œå¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</strong></h1>
<h2 id="16-1-å·¥ä½œå°ä¸šåŠ¡ä»£ç ">16.1 <strong>å·¥ä½œå°ä¸šåŠ¡ä»£ç </strong></h2>
<p>![[b3fe349feb409a0ab5bf34f4ee313f5f.png]]</p>
<p><strong>å·¥ä½œå°å±•ç¤ºçš„æ•°æ®ï¼š</strong></p>
<ul>
<li>ä»Šæ—¥æ•°æ®</li>
<li>è®¢å•ç®¡ç†</li>
<li>èœå“æ€»è§ˆ</li>
<li>å¥—é¤æ€»è§ˆ</li>
<li>è®¢å•ä¿¡æ¯</li>
</ul>
<p>![[b0edfcfd5d8f7c4fbd5af45de2afa37c.png]]</p>
<ul>
<li>è¥ä¸šé¢ï¼šå·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢</li>
<li>æœ‰æ•ˆè®¢å•ï¼šå·²å®Œæˆè®¢å•çš„æ•°é‡</li>
<li>è®¢å•å®Œæˆç‡ï¼šæœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•° * 100%</li>
<li>å¹³å‡å®¢å•ä»·ï¼šè¥ä¸šé¢ / æœ‰æ•ˆè®¢å•æ•°</li>
<li>æ–°å¢ç”¨æˆ·ï¼šæ–°å¢ç”¨æˆ·çš„æ•°é‡</li>
</ul>
<p><strong>æ¥å£è®¾è®¡ï¼š</strong></p>
<ul>
<li>
<p>ä»Šæ—¥æ•°æ®æ¥å£</p>
<p>![[d2ced8ec499d1371576588463b2eb35f.png]]</p>
</li>
<li>
<p>è®¢å•ç®¡ç†æ¥å£</p>
<p>![[35ee26fac5dd4ee73df4f71eb561b441.png]]</p>
</li>
<li>
<p>èœå“æ€»è§ˆæ¥å£</p>
<p>![[3e3513a81c53f9a37213aa3151cb3b2c.png]]</p>
</li>
<li>
<p>å¥—é¤æ€»è§ˆæ¥å£</p>
<p>![[a6e99744e9f2ec49b14bf0352c22cb72.png]]</p>
</li>
<li>
<p>è®¢å•æœç´¢ï¼ˆè®¢å•ç®¡ç†æ¨¡å—å·²å®Œæˆï¼‰</p>
</li>
<li>
<p>å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡ï¼ˆè®¢å•ç®¡ç†æ¨¡å—å·²å®Œæˆï¼‰</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line">BusinessDataVO</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®æ¦‚è§ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessDataVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Double turnover;<span class="comment">//è¥ä¸šé¢</span></span><br><span class="line">    <span class="keyword">private</span> Integer validOrderCount;<span class="comment">//æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Double orderCompletionRate;<span class="comment">//è®¢å•å®Œæˆç‡</span></span><br><span class="line">    <span class="keyword">private</span> Double unitPrice;<span class="comment">//å¹³å‡å®¢å•ä»·</span></span><br><span class="line">    <span class="keyword">private</span> Integer newUsers;<span class="comment">//æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OrderOverViewVO</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¢å•æ¦‚è§ˆæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderOverViewVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//å¾…æ¥å•æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer waitingOrders;</span><br><span class="line">    <span class="comment">//å¾…æ´¾é€æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer deliveredOrders;</span><br><span class="line">    <span class="comment">//å·²å®Œæˆæ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer completedOrders;</span><br><span class="line">    <span class="comment">//å·²å–æ¶ˆæ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer cancelledOrders;</span><br><span class="line">    <span class="comment">//å…¨éƒ¨è®¢å•</span></span><br><span class="line">    <span class="keyword">private</span> Integer allOrders;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DishOverViewVO</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishOverViewVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// å·²å¯å”®æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer sold;</span><br><span class="line">    <span class="comment">// å·²åœå”®æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer discontinued;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SetmealOverViewVO</span><br><span class="line"><span class="keyword">package</span> com.sky.vo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealOverViewVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// å·²å¯å”®æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer sold;</span><br><span class="line">    <span class="comment">// å·²åœå”®æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> Integer discontinued;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WorkSpaceController.java adminä¸‹åˆ›å»º</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥ä½œå°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/workspace&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å·¥ä½œå°ç›¸å…³æ¥å£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkSpaceController</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WorkSpaceService workSpaceService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ ¹æ®æ—¶é—´æ®µç»Ÿè®¡è¥ä¸šæ•°æ®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/businessData&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;å·¥ä½œå°ä»Šæ—¥æ•°æ®æŸ¥è¯¢&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;BusinessDataVO&gt; <span class="title function_">businessData</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// è·å¾—å½“å¤©çš„å¼€å§‹æ—¶é—´</span></span><br><span class="line">		<span class="type">LocalDateTime</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDateTime.now().with(LocalTime.MIN);</span><br><span class="line">		<span class="comment">// è·å¾—å½“å¤©çš„ç»“æŸæ—¶é—´</span></span><br><span class="line">		<span class="type">LocalDateTime</span> <span class="variable">end</span> <span class="operator">=</span> LocalDateTime.now().with(LocalTime.MAX);</span><br><span class="line"></span><br><span class="line">		<span class="type">BusinessDataVO</span> <span class="variable">businessDataVO</span> <span class="operator">=</span> workSpaceService.getBusinessData(begin, end);</span><br><span class="line">		<span class="keyword">return</span> Result.success(businessDataVO);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/overviewOrders&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;OrderOverViewVO&gt; <span class="title function_">orderOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(workSpaceService.getOrderOverView());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢èœå“æ€»è§ˆï¼šå·²å¯å”® å·²åœå”®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/overviewDishes&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;æŸ¥è¯¢èœå“æ€»è§ˆ&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;DishOverViewVO&gt; <span class="title function_">dishOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(workSpaceService.getDishOverView());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢å¥—é¤æ€»è§ˆï¼šå·²å¯å”® å·²åœå”®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/overviewSetmeals&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(&quot;æŸ¥è¯¢å¥—é¤æ€»è§ˆ&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Result&lt;SetmealOverViewVO&gt; <span class="title function_">setmealOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(workSpaceService.getSetmealOverView());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServiceImpl.java</span><br><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkSpaceServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">WorkSpaceService</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SetmealMapper setmealMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ ¹æ®æ—¶é—´æ®µç»Ÿè®¡è¥ä¸šæ•°æ®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> BusinessDataVO <span class="title function_">getBusinessData</span><span class="params">(LocalDateTime begin, LocalDateTime end)</span> &#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * è¥ä¸šé¢ï¼šå½“æ—¥å·²å®Œæˆè®¢å•çš„æ€»é‡‘é¢</span></span><br><span class="line"><span class="comment">		 * æœ‰æ•ˆè®¢å•ï¼šå½“æ—¥å·²å®Œæˆè®¢å•çš„æ•°é‡</span></span><br><span class="line"><span class="comment">		 * è®¢å•å®Œæˆç‡ï¼šæœ‰æ•ˆè®¢å•æ•° / æ€»è®¢å•æ•°</span></span><br><span class="line"><span class="comment">		 * å¹³å‡å®¢å•ä»·ï¼šè¥ä¸šé¢ / æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line"><span class="comment">		 * æ–°å¢ç”¨æˆ·ï¼šå½“æ—¥æ–°å¢ç”¨æˆ·çš„æ•°é‡</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;begin&quot;</span>, begin);</span><br><span class="line">		map.put(<span class="string">&quot;end&quot;</span>, end);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢æ€»è®¢å•æ•°</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">totalOrderCount</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è¥ä¸šé¢</span></span><br><span class="line">		<span class="type">Double</span> <span class="variable">turnover</span> <span class="operator">=</span> orderMapper.sumByMap(map);</span><br><span class="line">		turnover = turnover == <span class="literal">null</span> ? <span class="number">0.0</span> : turnover;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æœ‰æ•ˆè®¢å•æ•°</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">validOrderCount</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="type">Double</span> <span class="variable">unitPrice</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">		<span class="type">Double</span> <span class="variable">orderCompletionRate</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">		<span class="keyword">if</span> (totalOrderCount != <span class="number">0</span> &amp;&amp; validOrderCount != <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// è®¢å•å®Œæˆç‡</span></span><br><span class="line">			orderCompletionRate = validOrderCount.doubleValue() / totalOrderCount;</span><br><span class="line">			<span class="comment">// å¹³å‡å®¢å•ä»·</span></span><br><span class="line">			unitPrice = turnover / validOrderCount;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">newUsers</span> <span class="operator">=</span> userMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> BusinessDataVO.builder()</span><br><span class="line">				.turnover(turnover)</span><br><span class="line">				.newUsers(newUsers)</span><br><span class="line">				.validOrderCount(validOrderCount)</span><br><span class="line">				.orderCompletionRate(orderCompletionRate)</span><br><span class="line">				.unitPrice(unitPrice)</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢è®¢å•ç®¡ç†æ•°æ®</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> OrderOverViewVO <span class="title function_">getOrderOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		map.put(<span class="string">&quot;begin&quot;</span>, LocalDateTime.now().with(LocalTime.MIN));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¾…æ¥å•</span></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, Orders.TO_BE_CONFIRMED);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">waitingOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¾…æ´¾é€</span></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, Orders.CONFIRMED);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">deliveredOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å·²å®Œæˆ</span></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, Orders.COMPLETED);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">completedOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å·²å–æ¶ˆ</span></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, Orders.CANCELLED);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">cancelledOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å…¨éƒ¨è®¢å•</span></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">allOrders</span> <span class="operator">=</span> orderMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> OrderOverViewVO.builder()</span><br><span class="line">				.waitingOrders(waitingOrders)</span><br><span class="line">				.deliveredOrders(deliveredOrders)</span><br><span class="line">				.completedOrders(completedOrders)</span><br><span class="line">				.cancelledOrders(cancelledOrders)</span><br><span class="line">				.allOrders(allOrders)</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢èœå“æ€»è§ˆ</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> DishOverViewVO <span class="title function_">getDishOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.ENABLE);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">sold</span> <span class="operator">=</span> dishMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.DISABLE);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">discontinued</span> <span class="operator">=</span> dishMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> DishOverViewVO.builder()</span><br><span class="line">				.sold(sold)</span><br><span class="line">				.discontinued(discontinued)</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æŸ¥è¯¢å¥—é¤æ€»è§ˆ</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> SetmealOverViewVO <span class="title function_">getSetmealOverView</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.ENABLE);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">sold</span> <span class="operator">=</span> setmealMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		map.put(<span class="string">&quot;status&quot;</span>, StatusConstant.DISABLE);</span><br><span class="line">		<span class="type">Integer</span> <span class="variable">discontinued</span> <span class="operator">=</span> setmealMapper.countByMap(map);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> SetmealOverViewVO.builder()</span><br><span class="line">				.sold(sold)</span><br><span class="line">				.discontinued(discontinued)</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;countByMap&quot;</span> resultType=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span><br><span class="line">    select <span class="title function_">count</span><span class="params">(id)</span> from orders</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> t3est=<span class="string">&quot;begin != null&quot;</span>&gt;</span><br><span class="line">            and order_time &amp;gt;= #&#123;begin&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;end != null&quot;</span>&gt;</span><br><span class="line">            and order_time &amp;lt;= #&#123;end&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">            <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="16-2-Apache-POI">16.2 <strong>Apache POI</strong></h2>
<p>Apache POI æ˜¯ä¸€ä¸ªå¤„ç†Miscrosoft Officeï¼ˆå¾®è½¯åŠå…¬è½¯ä»¶ï¼‰å„ç§æ–‡ä»¶æ ¼å¼çš„å¼€æºé¡¹ç›®ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥<strong>ä½¿ç”¨ POI åœ¨ Java ç¨‹åºä¸­å¯¹Miscrosoft Officeå„ç§æ–‡ä»¶ï¼ˆWordã€Excelã€PowerPointç­‰ç­‰ï¼‰è¿›è¡Œ</strong><code>**è¯»å†™**</code><strong>æ“ä½œ</strong>ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPOI ä¸»è¦éƒ½æ˜¯ç”¨äºæ“ä½œ Excel æ–‡ä»¶ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/7778d2c5be28fe994b27b69d71a892a4.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/7778d2c5be28fe994b27b69d71a892a4.png" alt=""></a></p>
<p><strong>Apache POI çš„åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>
<p>é“¶è¡Œç½‘é“¶ç³»ç»Ÿå¯¼å‡ºäº¤æ˜“æ˜ç»†</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/ec3f5766cbe26aa0d6bb4457c3067254.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/ec3f5766cbe26aa0d6bb4457c3067254.png" alt=""></a></p>
</li>
<li>
<p>å„ç§ä¸šåŠ¡ç³»ç»Ÿå¯¼å‡ºExcelæŠ¥è¡¨</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/170d8b545850440e5c730e9325368413.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/170d8b545850440e5c730e9325368413.png" alt=""></a></p>
</li>
<li>
<p>æ‰¹é‡å¯¼å…¥ä¸šåŠ¡æ•°æ®</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/9de4b55166f84ffe34ff2cfa07b19cbb.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/9de4b55166f84ffe34ff2cfa07b19cbb.png" alt=""></a></p>
</li>
</ul>
<h2 id="16-2-1-å…¥é—¨æ¡ˆä¾‹">16.2.1 å…¥é—¨æ¡ˆä¾‹</h2>
<p>Apache POIæ—¢å¯ä»¥å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ¥ä¸‹æ¥åˆ†åˆ«è¿›è¡Œå®ç°ã€‚</p>
<ol>
<li>
<p><strong>Apache POIçš„mavenåæ ‡ï¼š</strong></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>å°†æ•°æ®å†™å…¥Excelæ–‡ä»¶</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCell;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRow;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäºPOIå‘Excelæ–‡ä»¶å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POITest</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é€šè¿‡POIåˆ›å»ºExcelæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶ï¼ˆæ‰‹åŠ¨åˆ›å»ºæ˜¯åœ¨ç£ç›˜åˆ›å»ºï¼‰</span></span><br><span class="line">		<span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">		<span class="comment">// åœ¨Excelä¸­åˆ›å»ºä¸€ä¸ªSheeté¡µ</span></span><br><span class="line">		<span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.createSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line">		<span class="comment">// åœ¨Sheeté¡µä¸­åˆ›å»ºè¡Œå¯¹è±¡ï¼Œrownumä¸‹æ ‡ä»0å¼€å§‹</span></span><br><span class="line">		<span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);<span class="comment">// åˆ›å»ºç¬¬äºŒè¡Œ</span></span><br><span class="line">		<span class="comment">// åœ¨è¡Œä¸Šåˆ›å»ºå•å…ƒæ ¼ï¼ŒcolumnIndexä¸‹æ ‡ä»0å¼€å§‹</span></span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å§“å&quot;</span>); <span class="comment">// åˆ›å»ºå¹¶å†™å…¥ç¬¬äºŒä¸ªå•å…ƒæ ¼</span></span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŸå¸‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">		row = sheet.createRow(<span class="number">2</span>);</span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;lr&quot;</span>);</span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;å¤§è¿&quot;</span>);</span><br><span class="line"></span><br><span class="line">		row = sheet.createRow(<span class="number">3</span>);</span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;jyl&quot;</span>);</span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŒ—äº¬&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å°†å†…å­˜çš„Excelæ–‡ä»¶å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­</span></span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\info.xlsx&quot;</span>));</span><br><span class="line">		excel.write(out);</span><br><span class="line"></span><br><span class="line">		out.close();</span><br><span class="line">		excel.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		write();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>![[/image 10 21.png|image 10 21.png]]</p>
</li>
<li>
<p><strong>è¯»å–Excelæ–‡ä»¶ä¸­çš„æ•°æ®</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäºPOIå‘Excelæ–‡ä»¶å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POITest</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é€šè¿‡POIåˆ›å»ºExcelæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶ï¼ˆæ‰‹åŠ¨åˆ›å»ºæ˜¯åœ¨ç£ç›˜åˆ›å»ºï¼‰</span></span><br><span class="line">		<span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>();</span><br><span class="line">		<span class="comment">// åœ¨Excelä¸­åˆ›å»ºä¸€ä¸ªSheeté¡µ</span></span><br><span class="line">		<span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.createSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line">		<span class="comment">// åœ¨Sheeté¡µä¸­åˆ›å»ºè¡Œå¯¹è±¡ï¼Œrownumä¸‹æ ‡ä»0å¼€å§‹</span></span><br><span class="line">		<span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.createRow(<span class="number">1</span>);<span class="comment">// åˆ›å»ºç¬¬äºŒè¡Œ</span></span><br><span class="line">		<span class="comment">// åœ¨è¡Œä¸Šåˆ›å»ºå•å…ƒæ ¼ï¼ŒcolumnIndexä¸‹æ ‡ä»0å¼€å§‹</span></span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;å§“å&quot;</span>); <span class="comment">// åˆ›å»ºå¹¶å†™å…¥ç¬¬äºŒä¸ªå•å…ƒæ ¼</span></span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŸå¸‚&quot;</span>);</span><br><span class="line"></span><br><span class="line">		row = sheet.createRow(<span class="number">2</span>);</span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;lr&quot;</span>);</span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;å¤§è¿&quot;</span>);</span><br><span class="line"></span><br><span class="line">		row = sheet.createRow(<span class="number">3</span>);</span><br><span class="line">		row.createCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;jyl&quot;</span>);</span><br><span class="line">		row.createCell(<span class="number">2</span>).setCellValue(<span class="string">&quot;åŒ—äº¬&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å°†å†…å­˜çš„Excelæ–‡ä»¶å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­</span></span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\info.xlsx&quot;</span>));</span><br><span class="line">		excel.write(out);</span><br><span class="line"></span><br><span class="line">		out.close();</span><br><span class="line">		excel.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é€šè¿‡POIè¯»å–Excelæ–‡ä»¶</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">FileInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\info.xlsx&quot;</span>));</span><br><span class="line">		<span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(is);</span><br><span class="line">		<span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheetAt(<span class="number">0</span>); <span class="comment">// è·å–ç¬¬1ä¸ªSheeté¡µ</span></span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> <span class="variable">lastRowNum</span> <span class="operator">=</span> sheet.getLastRowNum();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// éå†ä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œçš„æ•°æ®</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= lastRowNum; i++) &#123;</span><br><span class="line">			<span class="comment">// è·å–è¡Œå¯¹è±¡</span></span><br><span class="line">			<span class="type">XSSFRow</span> <span class="variable">titleRow</span> <span class="operator">=</span> sheet.getRow(i);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ£€æŸ¥è¡Œæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">			<span class="keyword">if</span> (titleRow != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">// è·å–è¡Œçš„ç¬¬2ä¸ªå•å…ƒæ ¼ï¼Œä¸‹æ ‡ä»0å¼€å§‹</span></span><br><span class="line">				<span class="type">XSSFCell</span> <span class="variable">cell1</span> <span class="operator">=</span> titleRow.getCell(<span class="number">1</span>);</span><br><span class="line">				<span class="type">XSSFCell</span> <span class="variable">cell2</span> <span class="operator">=</span> titleRow.getCell(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// æ£€æŸ¥å•å…ƒæ ¼æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">				<span class="keyword">if</span> (cell1 != <span class="literal">null</span> &amp;&amp; cell2 != <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="comment">// è·å–å•å…ƒæ ¼ä¸­çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">cellValue1</span> <span class="operator">=</span> cell1.getStringCellValue();</span><br><span class="line">					<span class="type">String</span> <span class="variable">cellValue2</span> <span class="operator">=</span> cell2.getStringCellValue();</span><br><span class="line"></span><br><span class="line">					<span class="comment">// è¾“å‡ºå•å…ƒæ ¼å†…å®¹åˆ°æ§åˆ¶å°</span></span><br><span class="line">					System.out.println(cellValue1 + <span class="string">&quot; &quot;</span> + cellValue2);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;å•å…ƒæ ¼ä¸ºç©º&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;è¡Œä¸ºç©º&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">		is.close();</span><br><span class="line">		excel.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// write();</span></span><br><span class="line">		read();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¯»å–</p>
</li>
</ol>
<h2 id="16-3-å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨">16.3 <strong>å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</strong></h2>
<p>![[9fc7d8e94e47b24ac9bf07463b78754e.png]]</p>
<p>æ•°æ®ç»Ÿè®¡é¡µé¢ï¼Œæœ‰ä¸€ä¸ªæ•°æ®å¯¼å‡ºçš„æŒ‰é’®ï¼Œç‚¹å‡»è¯¥æŒ‰é’®æ—¶ï¼Œå…¶å®å°±ä¼šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªExcelå½¢å¼çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä¸»è¦åŒ…å«æœ€è¿‘30æ—¥è¿è¥ç›¸å…³çš„æ•°æ®ã€‚è¡¨æ ¼çš„å½¢å¼å·²ç»å›ºå®šï¼Œä¸»è¦ç”±æ¦‚è§ˆæ•°æ®å’Œæ˜ç»†æ•°æ®ä¸¤éƒ¨åˆ†ç»„æˆã€‚çœŸæ­£å¯¼å‡ºè¿™ä¸ªæŠ¥è¡¨ä¹‹åï¼Œç›¸å¯¹åº”çš„æ•°å­—å°±ä¼šå¡«å……åœ¨è¡¨æ ¼ä¸­ï¼Œå°±å¯ä»¥è¿›è¡Œå­˜æ¡£ã€‚</p>
<p>![[2d45f57ea02afb4f922f49b9fc1fa336.png]]</p>
<p>å¯¼å‡ºçš„ExcelæŠ¥è¡¨æ ¼å¼ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://i-blog.csdnimg.cn/blog_migrate/3822baf034c58c6d33af405ff2a0336b.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i-blog.csdnimg.cn/blog_migrate/3822baf034c58c6d33af405ff2a0336b.png" alt=""></a></p>
<p><strong>ä¸šåŠ¡è§„åˆ™ï¼š</strong></p>
<ul>
<li>å¯¼å‡ºExcelå½¢å¼çš„æŠ¥è¡¨æ–‡ä»¶</li>
<li>å¯¼å‡ºæœ€è¿‘30å¤©çš„è¿è¥æ•°æ®</li>
</ul>
<p>![[762582ca2c6ad13e4b5f870c6aaf00dd.png]]</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å½“å‰æ¥å£æ²¡æœ‰ä¼ é€’å‚æ•°ï¼Œå› ä¸ºå¯¼å‡ºçš„æ˜¯æœ€è¿‘30å¤©çš„è¿è¥æ•°æ®ï¼Œ<code>åç«¯è®¡ç®—å³å¯</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦ä»»ä½•å‚æ•°</li>
<li>å½“å‰æ¥å£æ²¡æœ‰è¿”å›æ•°æ®ï¼Œå› ä¸ºæŠ¥è¡¨å¯¼å‡ºåŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯<code>æ–‡ä»¶ä¸‹è½½</code>ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼šå½“å‰è®¾è®¡çš„Excelè¡¨æ ¼çš„æ ¼å¼ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠåˆ°åˆå¹¶å•å…ƒæ ¼ã€èƒŒæ™¯è‰²ã€å­—å·çš„å¤§å°ä¹Ÿä¸ç›¸åŒã€‚æˆ‘ä»¬é€šè¿‡poiç¼–ç¨‹çš„æ–¹å¼è™½ç„¶å¯ä»¥åˆ›å»ºå‡ºè¿™ä¸ªExcelè¡¨æ ¼ï¼Œä½†æ˜¯è¿™ç§ä»£ç å†™èµ·æ¥éå¸¸çš„ç¹çï¼Œ</p>
<p><strong>è§£å†³</strong>ï¼šåœ¨çœŸæ­£çš„é¡¹ç›®ä¸­åœ¨å¯¼å‡ºä¸€äº›æŠ¥è¡¨çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæŠ¥è¡¨çš„æ ¼å¼æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆä¸€èˆ¬éƒ½ä¸ä¼šé€šè¿‡poiå»åˆ›å»ºè¿™ä¸ªè¡¨æ ¼ï¼Œè€Œæ˜¯æå‰åœ¨ç”µè„‘ä¸ŠæŠŠè¿™ä¸ªè¡¨æ ¼çš„æ ·å¼ç»™è®¾è®¡å¥½æä¾›ä¸€ä¸ªç©ºçš„Excelæ–‡ä»¶ï¼Œä¹‹ååœ¨ç¨‹åºä¸­å°±ä¸ç”¨åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Excelæ–‡ä»¶è€Œæ˜¯è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶ä¸€èˆ¬å«åšæ¨¡ç‰ˆæ–‡ä»¶ï¼‰ï¼Œè¯»å–åˆ°æ¨¡æ¿æ–‡ä»¶ä¹‹ååœ¨ç›¸åº”çš„ç©ºç™½å¤„å¡«ä¸Šå“åº”çš„æ•°å­—å°±å¯ä»¥äº†ï¼Œæ•°æ®å†™å®Œä¹‹ååœ¨é€šè¿‡æ–‡ä»¶ä¸‹è½½ï¼ŒæŠŠæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨å°±å®Œæˆäº†ã€‚</p>
<p>![[3822baf034c58c6d33af405ff2a0336b.png]]</p>
<ol>
<li>
<p>è®¾è®¡Excelæ¨¡æ¿æ–‡ä»¶ï¼ˆæ¨¡ç‰ˆæ–‡ä»¶ä¸€èˆ¬æ”¾åœ¨é¡¹ç›®å†…éƒ¨å°±å¯ä»¥äº†ï¼‰</p>
<p>![[07b6627ff3ff60323ce657901a3f61e8.png]]</p>
</li>
<li>
<p>æŸ¥è¯¢è¿‘30å¤©çš„è¿è¥æ•°æ®</p>
</li>
<li>
<p>å°†æŸ¥è¯¢åˆ°çš„è¿è¥æ•°æ®å†™å…¥æ¨¡æ¿æ–‡ä»¶</p>
</li>
<li>
<p>é€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(&quot;å¯¼å‡ºè¿è¥æ•°æ®æŠ¥è¡¨&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">       reportService.exportBusinessData(response);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportBusinessData</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="comment">// 1.æŸ¥è¯¢æ•°æ®åº“ï¼Œè·å–è¥ä¸šæ•°æ®---æŸ¥è¯¢æœ€è¿‘30å¤©çš„è¥ä¸šæ•°æ®</span></span><br><span class="line">	<span class="comment">/* æœ€è¿‘30å¤©ï¼š</span></span><br><span class="line"><span class="comment">	 *     LocalDate.now()ï¼šè·å–å½“å¤©æ—¶é—´æ—¥æœŸ</span></span><br><span class="line"><span class="comment">	 *     LocalDate.now().minusDays(30)ï¼šè·å–ç›¸å¯¹ä»Šå¤©æ¥è¯´å¾€å‰å€’30å¤©çš„æ—¥æœŸ</span></span><br><span class="line"><span class="comment">	 *     LocalDate.now().minusDays(1)ï¼šæŸ¥åˆ°ç›¸å¯¹ä»Šå¤©çš„å‰ä¸€å¤©ï¼ˆæ˜¨å¤©ï¼‰</span></span><br><span class="line"><span class="comment">	 * ä¸ºä»€ä¹ˆä¸æŸ¥åˆ°ä»Šå¤©å‘¢ï¼Ÿï¼Ÿï¼Ÿ   å› ä¸ºä»Šå¤©æœ‰å¯èƒ½è¿˜æ²¡æœ‰ç»“æŸï¼Œæ•°æ®å¯èƒ½è¿˜ä¼šå‘ç”Ÿå˜åŠ¨ã€‚</span></span><br><span class="line"><span class="comment">	 * */</span></span><br><span class="line">	<span class="type">LocalDate</span> <span class="variable">dateBegin</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">30</span>);</span><br><span class="line">	<span class="type">LocalDate</span> <span class="variable">dateEnd</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ„å»ºçš„å¼€å§‹ç»“æŸæ—¶é—´æ˜¯LocalDateï¼ˆå¹´æœˆæ—¥ç±»å‹ï¼‰ï¼Œä¸šåŠ¡å±‚éœ€è¦çš„æ˜¯LocalDateTimeï¼ˆå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œè½¬åŒ–ã€‚</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDateTime.of(dateBegin, LocalTime.MIN);<span class="comment">// èµ·å§‹æ—¥æœŸçš„æœ€å¼€å§‹æ—¶é—´ï¼š0æ—¶0åˆ†0ç§’</span></span><br><span class="line">	<span class="type">LocalDateTime</span> <span class="variable">ends</span> <span class="operator">=</span> LocalDateTime.of(dateEnd, LocalTime.MAX);<span class="comment">// æˆªæ­¢æ—¥æœŸçš„æœ€æ™šç»“æŸæ—¶é—´ï¼š11:59:59</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è·å–â€æ¦‚è§ˆæ•°æ®â€œï¼Œåœ¨å·¥ä½œå°é¡µé¢åŠŸèƒ½ä¸­å·²ç»æŸ¥è¿‡æ¦‚è§ˆæ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ä¹‹å‰æŸ¥è¯¢æ¦‚è§ˆæ•°æ®çš„ä¸šåŠ¡å±‚å¯¹è±¡WorkspaceService</span></span><br><span class="line">	<span class="type">BusinessDataVO</span> <span class="variable">businessData</span> <span class="operator">=</span> workSpaceService.getBusinessData(begin, ends);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. é€šè¿‡POIå°†æ•°æ®å†™å…¥åˆ°Excelæ–‡ä»¶ä¸­</span></span><br><span class="line">	<span class="comment">// è¯»å–æ¨¡æ¿è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * this.getClass()ï¼šè·å¾—æœ¬ç±»çš„ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment">	 * this.getClass().getClassLoader()ï¼šè·å¾—ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="comment">	 * this.getClass().getClassLoader().getResourceAsStream()ï¼šè·å–ç±»è·¯å¾„ä¸‹çš„æŒ‡å®šæ–‡ä»¶çš„è¾“å…¥æµ</span></span><br><span class="line"><span class="comment">	 * */</span></span><br><span class="line">	<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;template/è¿è¥æ•°æ®æŠ¥è¡¨æ¨¡æ¿.xlsx&quot;</span>);</span><br><span class="line">	<span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// åŸºäºæ¨¡æ¿æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„Excelæ–‡ä»¶</span></span><br><span class="line">		excel = <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(in);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¡«å……â€”â€”æ—¶é—´</span></span><br><span class="line">		<span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line">		sheet.getRow(<span class="number">1</span>).getCell(<span class="number">1</span>).setCellValue(<span class="string">&quot;æ—¶é—´ï¼š&quot;</span> + dateBegin + <span class="string">&quot;è‡³&quot;</span> + dateEnd); <span class="comment">// å¡«å……ï¼ˆ2ï¼Œ2ï¼‰</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¡«å……â€”â€”æ¦‚è§ˆæ•°æ®</span></span><br><span class="line">		<span class="comment">// è¥ä¸šé¢</span></span><br><span class="line">		<span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">3</span>);</span><br><span class="line">		row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">		<span class="comment">// è®¢å•å®Œæˆç‡</span></span><br><span class="line">		row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">		<span class="comment">// æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">		row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">		row = sheet.getRow(<span class="number">4</span>);</span><br><span class="line">		<span class="comment">// æœ‰æ•ˆè®¢å•</span></span><br><span class="line">		row.getCell(<span class="number">2</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">		<span class="comment">// å¹³å‡å®¢å•ä»·</span></span><br><span class="line">		row.getCell(<span class="number">4</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¡«å……â€”â€”æ˜ç»†æ•°æ®</span></span><br><span class="line">		<span class="comment">// æ¦‚è§ˆæ•°æ®æŸ¥è¯¢çš„æ˜¯è¿‘30å¤©çš„ï¼Œè€Œè¿™ä¸ªæ˜ç»†æ•°æ®æŸ¥è¯¢çš„æ˜¯æ¯ä¸€å¤©çš„æ•°æ®é¡¹</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">			<span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> dateBegin.plusDays(i);</span><br><span class="line">			<span class="comment">// æŸ¥è¯¢æŸä¸€å¤©çš„è¥ä¸šæ•°æ®</span></span><br><span class="line">			<span class="type">BusinessDataVO</span> <span class="variable">businessData1</span> <span class="operator">=</span> workSpaceService.getBusinessData(LocalDateTime.of(date, LocalTime.MIN), LocalDateTime.of(date, LocalTime.MAX));</span><br><span class="line"></span><br><span class="line">			<span class="comment">// è·å¾—æŸä¸€è¡Œï¼šæŸ¥çœ‹excelè¡¨æ ¼å¯çŸ¥æ•°æ®æ˜¯ä»ç¬¬8è¡Œï¼ˆä¸‹æ ‡ä¸º7ï¼‰å¼€å§‹å¡«å……çš„</span></span><br><span class="line">			row = sheet.getRow(<span class="number">7</span> + i);</span><br><span class="line">			row.getCell(<span class="number">1</span>).setCellValue(date.toString());<span class="comment">// å½“å‰è¡Œçš„ç¬¬2ä¸ªå•å…ƒæ ¼ï¼Œå¡«å……æ—¥æœŸï¼Œåªèƒ½æ¥æ”¶å­—ç¬¦ä¸²ç±»å‹æ‰€ä»¥éœ€è¦è½¬åŒ–</span></span><br><span class="line">			row.getCell(<span class="number">2</span>).setCellValue(businessData1.getTurnover());<span class="comment">// è¥ä¸šé¢</span></span><br><span class="line">			row.getCell(<span class="number">3</span>).setCellValue(businessData1.getValidOrderCount());<span class="comment">// æœ‰æ•ˆè®¢å•</span></span><br><span class="line">			row.getCell(<span class="number">4</span>).setCellValue(businessData1.getOrderCompletionRate());<span class="comment">// è®¢å•å®Œæˆç‡</span></span><br><span class="line">			row.getCell(<span class="number">5</span>).setCellValue(businessData1.getUnitPrice());<span class="comment">// å¹³å‡å®¢å•ä»·</span></span><br><span class="line">			row.getCell(<span class="number">6</span>).setCellValue(businessData1.getNewUsers()); <span class="comment">// æ–°å¢ç”¨æˆ·æ•°</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 3. é€šè¿‡è¾“å‡ºæµå°†Excelæ–‡ä»¶ä¸‹è½½åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨</span></span><br><span class="line">		out = response.getOutputStream();</span><br><span class="line">		excel.write(out);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			out.close();</span><br><span class="line">			excel.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>**HttpServletResponse response**</code>ï¼šç”¨äºå‘å®¢æˆ·ç«¯å‘é€å“åº”ï¼Œç‰¹åˆ«æ˜¯åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œ<code>response</code> æ˜¯ä¸ºäº†å°†ç”Ÿæˆçš„ Excel æ–‡ä»¶æµè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä½¿æµè§ˆå™¨èƒ½å¤Ÿä¸‹è½½æ–‡ä»¶ã€‚</li>
<li>åœ¨ Java ä¸­ï¼Œç±»çš„åŠ è½½å™¨ï¼ˆClassLoaderï¼‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬åŠ è½½èµ„æºæ–‡ä»¶æˆ–ç±»ä¿¡æ¯ï¼Œå°¤å…¶åœ¨è¯»å–ç±»è·¯å¾„ä¸‹çš„æ–‡ä»¶æ—¶éå¸¸æ–¹ä¾¿ã€‚
<ol>
<li>
<p><code>this.getClass()</code>ï¼šè·å¾—å½“å‰å¯¹è±¡çš„ç±»å¯¹è±¡</p>
<p><code>this.getClass()</code> æ–¹æ³•è¿”å›çš„æ˜¯å½“å‰å¯¹è±¡æ‰€å±ç±»çš„ <code>Class</code> å¯¹è±¡ã€‚æ¯ä¸ªç±»åœ¨è¿è¡Œæ—¶éƒ½ä¼šè¢« JVM åŠ è½½ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª <code>Class</code> å¯¹è±¡è¡¨ç¤ºå®ƒçš„ç±»å‹ã€‚</p>
</li>
<li>
<p><code>this.getClass().getClassLoader()</code>ï¼šè·å¾—ç±»åŠ è½½å™¨</p>
<p>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª <code>ClassLoader</code>ï¼Œè´Ÿè´£åŠ è½½ç±»åŠå…¶ä¾èµ–çš„èµ„æºã€‚ä½¿ç”¨ <code>this.getClass().getClassLoader()</code> å¯ä»¥è·å–åŠ è½½å½“å‰ç±»çš„ç±»åŠ è½½å™¨ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader();</span><br><span class="line">System.out.println(<span class="string">&quot;ç±»åŠ è½½å™¨ï¼š&quot;</span> + classLoader);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå½“å‰ç±»çš„åŠ è½½å™¨ã€‚é€šå¸¸ï¼Œå¯¹äºæ¥è‡ªåº”ç”¨ç¨‹åºç±»è·¯å¾„çš„ç±»ï¼Œç±»åŠ è½½å™¨æ˜¯ <code>ApplicationClassLoader</code>ã€‚</p>
</li>
<li>
<p><code>this.getClass().getClassLoader().getResourceAsStream(String name)</code>ï¼šè·å–ç±»è·¯å¾„ä¸‹çš„æ–‡ä»¶</p>
<p><code>getResourceAsStream()</code> æ–¹æ³•ç”¨äºä»ç±»è·¯å¾„ä¸­è¯»å–èµ„æºæ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>InputStream</code> å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•æ¥è¯»å–é¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼ˆä¾‹å¦‚é…ç½®æ–‡ä»¶ã€å›¾ç‰‡ç­‰ï¼‰ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;config.properties&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;èµ„æºæ–‡ä»¶å·²æ‰¾åˆ°ï¼&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;èµ„æºæ–‡ä»¶æœªæ‰¾åˆ°ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<div class="main-hero-waves-area"><div class="waves-area"><svg class="waves-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1440 140" preserveAspectRatio="none"><path class="parallax" d="M 0 44 C 355 167 415 0 725 44 L 725 44 L 0 44 Z"></path><use class="parallax" xlink:href="#wave1" x="48" y="3"></use><use class="parallax" xlink:href="#wave1" x="48" y="5"></use><use class="parallax" xlink:href="#wave1" x="48" y="7"></use><use class="parallax" xlink:href="#wave1" x="48" y="9"></use></svg></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://labi.com">Lorinda</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://labi.com/post/d67b0a8b.html">http://labi.com/post/d67b0a8b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://labi.com" target="_blank">èœ¡ç¬”æ¢¦å·¥å‚</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91/">ä¸šåŠ¡é€»è¾‘</a><a class="post-meta__tags" href="/tags/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84/">ä¸‰å±‚æ¶æ„</a></div><div class="post-share"><div class="social-share" data-image="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/b85186f.html" title="åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®</div></div><div class="info-2"><div class="info-item-1">è¯¦è§£è‹ç©¹å¤–å–é¡¹ç›®åŸºç¡€å¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»ºã€æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ä¸åˆå§‹åŒ–ï¼Œæ ¸å¿ƒé…ç½®ï¼ˆè·¨åŸŸã€æ—¥å¿—ç­‰ï¼‰åŠåŸºç¡€å·¥å…·ç±»å®ç°ï¼Œæ„å»ºé¡¹ç›®å¼€å‘åŸºçŸ³ã€‚</div></div></div></a><a class="pagination-related" href="/post/ce4585c2.html" title="å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘</div></div><div class="info-2"><div class="info-item-1">è¯¦è§£è‹ç©¹å¤–å–å‰ç«¯å¼€å‘å®ç°ï¼ŒåŒ…æ‹¬Vueç»„ä»¶æ¶æ„è®¾è®¡ã€æ ¸å¿ƒé¡µé¢ï¼ˆç™»å½•ã€é¦–é¡µã€è®¢å•é¡µï¼‰å¼€å‘ï¼Œæ¥å£äº¤äº’å°è£…ä¸çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿å‰ç«¯ç•Œé¢ä¸åç«¯æœåŠ¡é«˜æ•ˆååŒã€‚</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/ce4585c2.html" title="å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-30</div><div class="info-item-2">å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘</div></div><div class="info-2"><div class="info-item-1">è¯¦è§£è‹ç©¹å¤–å–å‰ç«¯å¼€å‘å®ç°ï¼ŒåŒ…æ‹¬Vueç»„ä»¶æ¶æ„è®¾è®¡ã€æ ¸å¿ƒé¡µé¢ï¼ˆç™»å½•ã€é¦–é¡µã€è®¢å•é¡µï¼‰å¼€å‘ï¼Œæ¥å£äº¤äº’å°è£…ä¸çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿å‰ç«¯ç•Œé¢ä¸åç«¯æœåŠ¡é«˜æ•ˆååŒã€‚</div></div></div></a><a class="pagination-related" href="/post/25e0fe54.html" title="é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112618.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-30</div><div class="info-item-2">é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ</div></div><div class="info-2"><div class="info-item-1">å…¨é¢è§£æè‹ç©¹å¤–å–é¡¹ç›®çš„æ•´ä½“è§„åˆ’ï¼ŒåŒ…æ‹¬é¡¹ç›®èƒŒæ™¯ã€æ ¸å¿ƒéœ€æ±‚ã€æŠ€æœ¯æ ˆé€‰å‹ä¾æ®ï¼Œè¯¦è§£ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸å¼€å‘è§„èŒƒï¼Œä¸ºé¡¹ç›®å¼€å‘æä¾›æ•´ä½“æŒ‡å¯¼ã€‚</div></div></div></a><a class="pagination-related" href="/post/b85186f.html" title="åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-30</div><div class="info-item-2">åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®</div></div><div class="info-2"><div class="info-item-1">è¯¦è§£è‹ç©¹å¤–å–é¡¹ç›®åŸºç¡€å¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»ºã€æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ä¸åˆå§‹åŒ–ï¼Œæ ¸å¿ƒé…ç½®ï¼ˆè·¨åŸŸã€æ—¥å¿—ç­‰ï¼‰åŠåŸºç¡€å·¥å…·ç±»å®ç°ï¼Œæ„å»ºé¡¹ç›®å¼€å‘åŸºçŸ³ã€‚</div></div></div></a><a class="pagination-related" href="/post/reggie-overview.html" title="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-02</div><div class="info-item-2">ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„</div></div><div class="info-2"><div class="info-item-1">å…¨é¢è§£æç‘å‰å¤–å–é¡¹ç›®èƒŒæ™¯ã€æŠ€æœ¯é€‰å‹ã€æ•´ä½“æ¶æ„è®¾è®¡åŠæ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼Œå»ºç«‹é¡¹ç›®å…¨å±€è®¤çŸ¥ã€‚</div></div></div></a><a class="pagination-related" href="/post/reggie-business.html" title="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-02</div><div class="info-item-2">ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘</div></div><div class="info-2"><div class="info-item-1">è¯¦è§£ç‘å‰å¤–å–åç«¯æ ¸å¿ƒä¸šåŠ¡å®ç°ï¼ŒåŒ…æ‹¬å‘˜å·¥ç®¡ç†ã€èœå“åˆ†ç±»ã€è®¢å•æµç¨‹ç­‰åŠŸèƒ½çš„æ¥å£ä¸é€»è¾‘å¼€å‘ã€‚</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="card-info-avatar"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155535.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">ğŸŸ</g-emoji><span>è®¤çœŸæ‘¸é±¼ä¸­</span></div></div></div><div class="author-info-name">Lorinda</div><div class="author-info-description">æ¬¢è¿æ¥åˆ°Lorindaçš„ä¸ªäººåšå®¢\^o^/</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">112</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://lr0513.github.io/"><i class="fab fa-github"></i><span>ä½ å›æ¥äº†~</span><i class="faa-passing animated" style="padding-left:20px;display:inline-block;vertical-align:middle;"><svg class="icon" style="height:28px;width:28px;fill:currentColor;position:relative;top:5px"><use xlink:href="#icon-hexolabixiaoxin1"></use></svg></i></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content"></div><div id="welcome-info"></div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople1.js"></script><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/zdog.dist.js"></script><script id="rendered-js" src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="card-widget" id="newYear"><div class="item-headline"><i></i><span></span></div><div class="item-content"><div id="newYear-main"><div class="mask"></div> <p class="title"></p> <div class="newYear-time"></div> <p class="today" style="text-align: right;"></p> </div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">åã€è´­ç‰©è½¦</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E6%B7%BB%E5%8A%A0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.1.</span> <span class="toc-text">10.1 æ·»åŠ è´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E6%9F%A5%E7%9C%8B%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.2.</span> <span class="toc-text">10.2 æŸ¥çœ‹è´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">1.3.</span> <span class="toc-text">10.3 æ¸…ç©ºè´­ç‰©è½¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-%E5%88%A0%E9%99%A4%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%95%86%E5%93%81"><span class="toc-number">1.4.</span> <span class="toc-text">10.4 åˆ é™¤è´­ç‰©è½¦ä¸­ä¸€ä¸ªå•†å“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">åä¸€ã€ç”¨æˆ·ä¸‹å•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E5%9C%B0%E5%9D%80%E8%96%84%E5%8A%9F%E8%83%BD"><span class="toc-number">2.1.</span> <span class="toc-text">11.1 åœ°å€è–„åŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E7%94%A8%E6%88%B7%E4%B8%8B%E5%8D%95%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.</span> <span class="toc-text">11.2 ç”¨æˆ·ä¸‹å•åŠŸèƒ½</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">åäºŒã€è®¢å•æ”¯ä»˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">12.1 å¾®ä¿¡æ”¯ä»˜ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%87%86%E5%A4%87%E5%8A%9F%E8%83%BD"><span class="toc-number">3.2.</span> <span class="toc-text">12.2 å¾®ä¿¡æ”¯ä»˜å‡†å¤‡åŠŸèƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-1-%E8%8E%B7%E5%BE%97%E5%BE%AE%E4%BF%A1%E7%BB%99%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">12.2.1 è·å¾—å¾®ä¿¡ç»™çš„ä¸¤ä¸ªæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-number">3.2.2.</span> <span class="toc-text">å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-2-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">3.2.3.</span> <span class="toc-text">12.2.2 å†…ç½‘ç©¿é€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E5%AF%BC%E5%85%A5%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">12.3 å¯¼å…¥å¾®ä¿¡æ”¯ä»˜ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%B2%A1%E6%9C%89%E5%95%86%E6%88%B7%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="toc-number">3.3.1.</span> <span class="toc-text">è§£å†³æ²¡æœ‰å•†æˆ·å·é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BF%AE%E6%94%B9"><span class="toc-number">3.3.2.</span> <span class="toc-text">å‰ç«¯å°ç¨‹åºä¿®æ”¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BF%AE%E6%94%B9"><span class="toc-number">3.3.3.</span> <span class="toc-text">åç«¯ä¿®æ”¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">åä¸‰ã€ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—&amp;å•†å®¶ç«¯è®¢å•ç®¡ç†æ¨¡å—&amp;åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E7%94%A8%E6%88%B7%E7%AB%AF%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">13.1 ç”¨æˆ·ç«¯å†å²è®¢å•æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-1-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95"><span class="toc-number">4.1.1.</span> <span class="toc-text">13.1.1 åˆ†é¡µæŸ¥è¯¢å†å²è®¢å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-2-%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85"><span class="toc-number">4.1.2.</span> <span class="toc-text">13.1.2 æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-3-%E5%8F%96%E6%B6%88%E8%AE%A2%E5%8D%95"><span class="toc-number">4.1.3.</span> <span class="toc-text">13.1.3 å–æ¶ˆè®¢å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-4-%E5%86%8D%E6%9D%A5%E4%B8%80%E5%8D%95"><span class="toc-number">4.1.4.</span> <span class="toc-text">13.1.4 å†æ¥ä¸€å•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E5%95%86%E5%AE%B6%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text">13.2 å•†å®¶è®¢å•ç®¡ç†æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-1-%E8%AE%A2%E5%8D%95%E6%90%9C%E7%B4%A2"><span class="toc-number">4.2.1.</span> <span class="toc-text">13.2.1 è®¢å•æœç´¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-2-%E5%90%84%E4%B8%AA%E7%8A%B6%E6%80%81%E7%9A%84%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="toc-number">4.2.2.</span> <span class="toc-text">13.2.2 å„ä¸ªçŠ¶æ€çš„è®¢å•æ•°é‡ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-3-%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85"><span class="toc-number">4.2.3.</span> <span class="toc-text">13.2.3 æŸ¥è¯¢è®¢å•è¯¦æƒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-4-%E6%8E%A5%E5%8D%95"><span class="toc-number">4.2.4.</span> <span class="toc-text">13.2.4 æ¥å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-5-%E6%8B%92%E5%8D%95"><span class="toc-number">4.2.5.</span> <span class="toc-text">13.2.5 æ‹’å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-6-%E5%8F%96%E6%B6%88%E8%AE%A2%E5%8D%95"><span class="toc-number">4.2.6.</span> <span class="toc-text">13.2.6 å–æ¶ˆè®¢å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-7-%E6%B4%BE%E9%80%81%E8%AE%A2%E5%8D%95"><span class="toc-number">4.2.7.</span> <span class="toc-text">13.2.7 æ´¾é€è®¢å•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-8-%E5%AE%8C%E6%88%90%E8%AE%A2%E5%8D%95"><span class="toc-number">4.2.8.</span> <span class="toc-text">13.2.8 å®Œæˆè®¢å•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E6%A3%80%E9%AA%8C%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E6%98%AF%E5%90%A6%E8%B6%85%E5%87%BA%E9%85%8D%E9%80%81%E8%8C%83%E5%9B%B4"><span class="toc-number">4.3.</span> <span class="toc-text">13.3 æ£€éªŒæ”¶è´§åœ°å€æ˜¯å¦è¶…å‡ºé…é€èŒƒå›´</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">åå››ã€Spring Taskã€è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†ã€æ¥å•æé†’ï¼ˆWebSocketçš„åº”ç”¨ï¼‰ã€å®¢æˆ·å‚¬å•ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-Spring-Task"><span class="toc-number">5.1.</span> <span class="toc-text">14.1 Spring Task</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-1-cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">5.1.1.</span> <span class="toc-text">14.1.1 cronè¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-2-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">5.1.2.</span> <span class="toc-text">14.1.2 å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">14.2 è®¢å•çŠ¶æ€å®šæ—¶å¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-WebSocket"><span class="toc-number">5.3.</span> <span class="toc-text">14.3 WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-1-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">5.3.1.</span> <span class="toc-text">14.3.1 å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-4-%E6%9D%A5%E5%8D%95%E6%8F%90%E9%86%92%EF%BC%88WebSocket%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%89"><span class="toc-number">5.4.</span> <span class="toc-text">14.4 æ¥å•æé†’ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-5-%E5%AE%A2%E6%88%B7%E5%82%AC%E5%8D%95%EF%BC%88WebSocket%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%89"><span class="toc-number">5.5.</span> <span class="toc-text">14.5 å®¢æˆ·å‚¬å•ï¼ˆWebSocketçš„åº”ç”¨ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">åäº”ã€Apache EChartsï¼Œè¥ä¸šé¢ç»Ÿè®¡ï¼Œç”¨æˆ·ç»Ÿè®¡ï¼Œè®¢å•ç»Ÿè®¡ï¼Œé”€é‡æ’åTop10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-1-Apache-ECharts%EF%BC%88%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">15.1 Apache EChartsï¼ˆå‰ç«¯æŠ€æœ¯ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-1-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">6.1.1.</span> <span class="toc-text">15.1.1 å…¥é—¨æ¡ˆä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-2-%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.2.</span> <span class="toc-text">15.2 è¥ä¸šé¢ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-3-%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.3.</span> <span class="toc-text">15.3 ç”¨æˆ·ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-4-%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.4.</span> <span class="toc-text">15.4 è®¢å•ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-5-%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10"><span class="toc-number">6.5.</span> <span class="toc-text">15.5 é”€é‡æ’åTop10</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">åå…­ã€å·¥ä½œå°ä¸šåŠ¡ä»£ç ï¼ŒApache POIï¼Œå¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#16-1-%E5%B7%A5%E4%BD%9C%E5%8F%B0%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81"><span class="toc-number">7.1.</span> <span class="toc-text">16.1 å·¥ä½œå°ä¸šåŠ¡ä»£ç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-2-Apache-POI"><span class="toc-number">7.2.</span> <span class="toc-text">16.2 Apache POI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-2-1-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">7.3.</span> <span class="toc-text">16.2.1 å…¥é—¨æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-3-%E5%AF%BC%E5%87%BA%E8%BF%90%E8%90%A5%E6%95%B0%E6%8D%AEExcel%E6%8A%A5%E8%A1%A8"><span class="toc-number">7.4.</span> <span class="toc-text">16.3 å¯¼å‡ºè¿è¥æ•°æ®ExcelæŠ¥è¡¨</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>ç³»åˆ—æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-deployment.html" title="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112758.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"></a><div class="content"><a class="title" href="/post/reggie-deployment.html" title="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²">ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²</a><time datetime="2025-09-02T02:04:00.000Z" title="å‘è¡¨äº 2025-09-02 10:04:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-optimization.html" title="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§"></a><div class="content"><a class="title" href="/post/reggie-optimization.html" title="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§">ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§</a><time datetime="2025-09-02T02:03:00.000Z" title="å‘è¡¨äº 2025-09-02 10:03:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-mobile.html" title="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155656.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°"></a><div class="content"><a class="title" href="/post/reggie-mobile.html" title="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°">ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°</a><time datetime="2025-09-02T02:02:00.000Z" title="å‘è¡¨äº 2025-09-02 10:02:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-business.html" title="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘"></a><div class="content"><a class="title" href="/post/reggie-business.html" title="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘">ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘</a><time datetime="2025-09-02T02:01:00.000Z" title="å‘è¡¨äº 2025-09-02 10:01:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-overview.html" title="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„"></a><div class="content"><a class="title" href="/post/reggie-overview.html" title="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„">ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„</a><time datetime="2025-09-02T02:00:00.000Z" title="å‘è¡¨äº 2025-09-02 10:00:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/ce4585c2.html" title="å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘"></a><div class="content"><a class="title" href="/post/ce4585c2.html" title="å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘">å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘</a><time datetime="2025-08-30T03:03:00.000Z" title="å‘è¡¨äº 2025-08-30 11:03:00">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/d67b0a8b.html" title="æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°"></a><div class="content"><a class="title" href="/post/d67b0a8b.html" title="æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°">æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°</a><time datetime="2025-08-30T03:02:00.000Z" title="å‘è¡¨äº 2025-08-30 11:02:00">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/b85186f.html" title="åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®"></a><div class="content"><a class="title" href="/post/b85186f.html" title="åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®">åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®</a><time datetime="2025-08-30T03:01:00.000Z" title="å‘è¡¨äº 2025-08-30 11:01:00">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/25e0fe54.html" title="é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112618.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ"></a><div class="content"><a class="title" href="/post/25e0fe54.html" title="é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ">é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ</a><time datetime="2025-08-30T03:00:00.000Z" title="å‘è¡¨äº 2025-08-30 11:00:00">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/g86c4e7a.html" title="ç¬¬ 7 ç«  è®¡ç®—æœºç³»ç»Ÿç»“æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112914.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 7 ç«  è®¡ç®—æœºç³»ç»Ÿç»“æ„"></a><div class="content"><a class="title" href="/post/g86c4e7a.html" title="ç¬¬ 7 ç«  è®¡ç®—æœºç³»ç»Ÿç»“æ„">ç¬¬ 7 ç«  è®¡ç®—æœºç³»ç»Ÿç»“æ„</a><time datetime="2025-08-28T21:20:00.000Z" title="å‘è¡¨äº 2025-08-29 05:20:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/f75b3d6f.html" title="ç¬¬ 6 ç«  è¾“å…¥è¾“å‡ºç³»ç»Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 6 ç«  è¾“å…¥è¾“å‡ºç³»ç»Ÿ"></a><div class="content"><a class="title" href="/post/f75b3d6f.html" title="ç¬¬ 6 ç«  è¾“å…¥è¾“å‡ºç³»ç»Ÿ">ç¬¬ 6 ç«  è¾“å…¥è¾“å‡ºç³»ç»Ÿ</a><time datetime="2025-08-28T21:19:00.000Z" title="å‘è¡¨äº 2025-08-29 05:19:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/169339cb.html" title="ç¬¬ 5 ç«  è¾“å…¥è¾“å‡ºç®¡ç†ï¼šè®¾å¤‡ååŒä¸ä¼˜åŒ–"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 5 ç«  è¾“å…¥è¾“å‡ºç®¡ç†ï¼šè®¾å¤‡ååŒä¸ä¼˜åŒ–"></a><div class="content"><a class="title" href="/post/169339cb.html" title="ç¬¬ 5 ç«  è¾“å…¥è¾“å‡ºç®¡ç†ï¼šè®¾å¤‡ååŒä¸ä¼˜åŒ–">ç¬¬ 5 ç«  è¾“å…¥è¾“å‡ºç®¡ç†ï¼šè®¾å¤‡ååŒä¸ä¼˜åŒ–</a><time datetime="2025-08-28T21:18:00.000Z" title="å‘è¡¨äº 2025-08-29 05:18:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/d64a2c5e.html" title="ç¬¬ 5 ç«  ä¸­å¤®å¤„ç†å™¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 5 ç«  ä¸­å¤®å¤„ç†å™¨"></a><div class="content"><a class="title" href="/post/d64a2c5e.html" title="ç¬¬ 5 ç«  ä¸­å¤®å¤„ç†å™¨">ç¬¬ 5 ç«  ä¸­å¤®å¤„ç†å™¨</a><time datetime="2025-08-28T21:18:00.000Z" title="å‘è¡¨äº 2025-08-29 05:18:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/790dfc8c.html" title="ç¬¬ 4 ç«  æ–‡ä»¶ç®¡ç†ï¼šå­˜å‚¨ä¸è®¿é—®æœºåˆ¶"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 4 ç«  æ–‡ä»¶ç®¡ç†ï¼šå­˜å‚¨ä¸è®¿é—®æœºåˆ¶"></a><div class="content"><a class="title" href="/post/790dfc8c.html" title="ç¬¬ 4 ç«  æ–‡ä»¶ç®¡ç†ï¼šå­˜å‚¨ä¸è®¿é—®æœºåˆ¶">ç¬¬ 4 ç«  æ–‡ä»¶ç®¡ç†ï¼šå­˜å‚¨ä¸è®¿é—®æœºåˆ¶</a><time datetime="2025-08-28T21:17:00.000Z" title="å‘è¡¨äº 2025-08-29 05:17:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/b93e5f6d.html" title="ç¬¬ 4 ç«  æŒ‡ä»¤ç³»ç»Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112914.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 4 ç«  æŒ‡ä»¤ç³»ç»Ÿ"></a><div class="content"><a class="title" href="/post/b93e5f6d.html" title="ç¬¬ 4 ç«  æŒ‡ä»¤ç³»ç»Ÿ">ç¬¬ 4 ç«  æŒ‡ä»¤ç³»ç»Ÿ</a><time datetime="2025-08-28T21:17:00.000Z" title="å‘è¡¨äº 2025-08-29 05:17:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/ce20e5e9.html" title="ç¬¬ 3 ç«  å†…å­˜ç®¡ç†ï¼šåœ°å€æ˜ å°„ä¸è™šæ‹Ÿå†…å­˜"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 3 ç«  å†…å­˜ç®¡ç†ï¼šåœ°å€æ˜ å°„ä¸è™šæ‹Ÿå†…å­˜"></a><div class="content"><a class="title" href="/post/ce20e5e9.html" title="ç¬¬ 3 ç«  å†…å­˜ç®¡ç†ï¼šåœ°å€æ˜ å°„ä¸è™šæ‹Ÿå†…å­˜">ç¬¬ 3 ç«  å†…å­˜ç®¡ç†ï¼šåœ°å€æ˜ å°„ä¸è™šæ‹Ÿå†…å­˜</a><time datetime="2025-08-28T21:16:00.000Z" title="å‘è¡¨äº 2025-08-29 05:16:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/a81d4c7b.html" title="ç¬¬ 3 ç«  å­˜å‚¨ç³»ç»Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 3 ç«  å­˜å‚¨ç³»ç»Ÿ"></a><div class="content"><a class="title" href="/post/a81d4c7b.html" title="ç¬¬ 3 ç«  å­˜å‚¨ç³»ç»Ÿ">ç¬¬ 3 ç«  å­˜å‚¨ç³»ç»Ÿ</a><time datetime="2025-08-28T21:16:00.000Z" title="å‘è¡¨äº 2025-08-29 05:16:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/833e46bb.html" title="ç¬¬ 2 ç«  è¿›ç¨‹ä¸çº¿ç¨‹ï¼šå¹¶å‘ç®¡ç†æ ¸å¿ƒ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112650.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 2 ç«  è¿›ç¨‹ä¸çº¿ç¨‹ï¼šå¹¶å‘ç®¡ç†æ ¸å¿ƒ"></a><div class="content"><a class="title" href="/post/833e46bb.html" title="ç¬¬ 2 ç«  è¿›ç¨‹ä¸çº¿ç¨‹ï¼šå¹¶å‘ç®¡ç†æ ¸å¿ƒ">ç¬¬ 2 ç«  è¿›ç¨‹ä¸çº¿ç¨‹ï¼šå¹¶å‘ç®¡ç†æ ¸å¿ƒ</a><time datetime="2025-08-28T21:15:00.000Z" title="å‘è¡¨äº 2025-08-29 05:15:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/e72f3b9c.html" title="ç¬¬ 2 ç«  æ•°æ®çš„è¡¨ç¤ºä¸è®¡ç®—"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112855.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 2 ç«  æ•°æ®çš„è¡¨ç¤ºä¸è®¡ç®—"></a><div class="content"><a class="title" href="/post/e72f3b9c.html" title="ç¬¬ 2 ç«  æ•°æ®çš„è¡¨ç¤ºä¸è®¡ç®—">ç¬¬ 2 ç«  æ•°æ®çš„è¡¨ç¤ºä¸è®¡ç®—</a><time datetime="2025-08-28T21:15:00.000Z" title="å‘è¡¨äº 2025-08-29 05:15:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/b328aa63.html" title="ç¬¬ 1 ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 1 ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€"></a><div class="content"><a class="title" href="/post/b328aa63.html" title="ç¬¬ 1 ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€">ç¬¬ 1 ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€</a><time datetime="2025-08-28T21:14:00.000Z" title="å‘è¡¨äº 2025-08-29 05:14:00">2025-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/c45d1e8a.html" title="ç¬¬ 1 ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¬¬ 1 ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°"></a><div class="content"><a class="title" href="/post/c45d1e8a.html" title="ç¬¬ 1 ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°">ç¬¬ 1 ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°</a><time datetime="2025-08-28T21:14:00.000Z" title="å‘è¡¨äº 2025-08-29 05:14:00">2025-08-29</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-deployment.html" title="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112758.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²"/></a><div class="content"><a class="title" href="/post/reggie-deployment.html" title="ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²">ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²</a><time datetime="2025-09-02T02:04:00.000Z" title="å‘è¡¨äº 2025-09-02 10:04:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-optimization.html" title="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§"/></a><div class="content"><a class="title" href="/post/reggie-optimization.html" title="ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§">ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§</a><time datetime="2025-09-02T02:03:00.000Z" title="å‘è¡¨äº 2025-09-02 10:03:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-mobile.html" title="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155656.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°"/></a><div class="content"><a class="title" href="/post/reggie-mobile.html" title="ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°">ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°</a><time datetime="2025-09-02T02:02:00.000Z" title="å‘è¡¨äº 2025-09-02 10:02:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-business.html" title="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘"/></a><div class="content"><a class="title" href="/post/reggie-business.html" title="ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘">ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘</a><time datetime="2025-09-02T02:01:00.000Z" title="å‘è¡¨äº 2025-09-02 10:01:00">2025-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/reggie-overview.html" title="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„"/></a><div class="content"><a class="title" href="/post/reggie-overview.html" title="ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„">ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„</a><time datetime="2025-09-02T02:00:00.000Z" title="å‘è¡¨äº 2025-09-02 10:00:00">2025-09-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025  <i id="heartbeat" class="fa fas fa-heartbeat"></i> By Lorinda</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa fa-book"></i><span>é˜…è¯»æ¨¡å¼</span></a><a class="rightMenu-item" href="/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="to_comment" type="button" title="å‰å¾€è¯„è®º" onclick="FixedCommentBtn();"><i class="fas fa-comments"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-api-three-beta.vercel.app/',
      region: 'ap-beijing',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-api-three-beta.vercel.app/',
      region: 'ap-beijing',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async src="//at.alicdn.com/t/c/font_4860073_9duzoqyl2cn.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script src="/js/pagination-jump.js"></script><script async src="/js/fps.js"></script><script async data-pjax src="/js/txmap.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async data-pjax src="/js/music.js"></script><script defer src="/js/lunar.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script> let backimg =["url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/d42bcc24810cda2c22eaed769b79a93.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/2f5e89ae13329dd89bdcdbfc68c5fde.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/48b137c38cc79ad960ecf2a9a12fc20.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/4474312751631fedb37381e37cdb9c0.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/be978bd80f41d2781455513ba1676a2.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/a01223e0819746191dd135670a2d7da.jpg)","url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/af380cb8a5ed3f047e66dbfe731f488.jpg)"];let index = Math.floor(Math.random() * backimg.length);;document.getElementById("web_bg").style.backgroundImage = backimg[index]</script><script type="text/javascript" src="/js/rightmenu.js"></script><script src="/js/history.js"></script><script src="/js/historyroll.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><script defer src="/js/day.js"></script><script async src="/js/title.js"></script><script defer src="/js/random.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script src="/js/sun_moon.js" async></script><script>
  document.addEventListener('copy', function(e) {
    const selection = window.getSelection().toString()
    if (selection.length > 30) {
      const notice = document.createElement('div')
      notice.className = 'copy-notification'
      notice.textContent = 'å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'

      document.body.appendChild(notice)
      setTimeout(() => notice.classList.add('show'), 10)

      setTimeout(() => {
        notice.classList.remove('show')
        setTimeout(() => notice.remove(), 300)
      }, 2000)
    }
  })
</script>
<div class="aplayer no-destroy" data-id="7338633309" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="true" muted></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><script async data-pjax src="/js/newYear.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/canvas-nest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/click-show-text.min.js" data-mobile="false" data-text="Ha,Ha,Ha" data-fontsize="15px" data-random="false" async="async"></script><script>(() => {
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "cbe39e5f-e68f-4a07-b9cd-3ebbb6aa9ae8";
  (function () {
    d = document;
    s = d.createElement("script");
    s.src = "https://client.crisp.chat/l.js";
    s.async = 1;
    d.getElementsByTagName("head")[0].appendChild(s);
  })();
  $crisp.push(["safe", true])

  const isChatBtn = true
  const isChatHideShow = false

  if (isChatBtn) {
    const open = () => {
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])
    }

    const close = () => $crisp.push(["do", "chat:hide"])

    close()

    $crisp.push(["on", "chat:closed", close])

    window.chatBtnFn = () => $crisp.is("chat:visible") ? close() : open()

  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => $crisp.push(["do", "chat:hide"]),
      show: () => $crisp.push(["do", "chat:show"])
    }
  }
})()</script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://npm.elemecdn.com/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementsByClassName('recent-posts')[0];
      var item_html = '<div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155818.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/æ“ä½œç³»ç»Ÿ/&quot;);" href="javascript:void(0);">æ“ä½œç³»ç»Ÿ</a><span class="categoryBar-list-count">6</span><span class="categoryBar-list-descr">ç³»ç»ŸåŸºç¡€</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/æŠ€æœ¯æ ˆ/&quot;);" href="javascript:void(0);">æŠ€æœ¯æ ˆ</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">æŠ€æœ¯å·¥å…·</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112758.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/ç¼–ç¨‹è¯­è¨€/&quot;);" href="javascript:void(0);">ç¼–ç¨‹è¯­è¨€</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">è¯­è¨€å…¥é—¨</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/4e357962b00044466380f6850a120ec.jpg);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/ç‘å‰å¤–å–é¡¹ç›®/&quot;);" href="javascript:void(0);">ç‘å‰å¤–å–é¡¹ç›®</a><span class="categoryBar-list-count">5</span><span class="categoryBar-list-descr">æ•°æŠ€æ ¸å¿ƒ</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155709.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/è®¡ç®—æœºåŸºç¡€/&quot;);" href="javascript:void(0);">è®¡ç®—æœºåŸºç¡€</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">è®¡åŸºè¦ç‚¹</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160015.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/å¤§æ•°æ®æŠ€æœ¯/&quot;);" href="javascript:void(0);">å¤§æ•°æ®æŠ€æœ¯</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">ç‘å‰å®è·µ</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160113.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/è‹ç©¹å¤–å–é¡¹ç›®/&quot;);" href="javascript:void(0);">è‹ç©¹å¤–å–é¡¹ç›®</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">è‹ç©¹å®è·µ</span></li><li class="categoryBar-list-item" style="background:url(https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155951.png);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/è®¡ç®—æœºåŸºç¡€/ä¸“ä¸šè¯¾/&quot;);" href="javascript:void(0);">ä¸“ä¸šè¯¾</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">ä¸“ä¸šè¯¾ç¨‹</span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/è®¡ç®—æœºç»„æˆåŸç†/&quot;);" href="javascript:void(0);">è®¡ç®—æœºç»„æˆåŸç†</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('å·²æŒ‚è½½butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementsByClassName('recent-posts')[0] && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = '9aac1b5db191491a8993c445d664de8f';
  var gaud_map_key = '3cc01a5a19f500daa0e9e680ef0f6db2';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '120.780172,40.624088';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/g86c4e7a.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112914.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/g86c4e7a.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 7 ç«  è®¡ç®—æœºç³»ç»Ÿç»“æ„</a><div class="blog-slider__text">é˜è¿°è®¡ç®—æœºç³»ç»Ÿç»“æ„çš„åŸºæœ¬æ¦‚å¿µï¼Œåˆ†æå¹¶è¡Œå¤„ç†æŠ€æœ¯çš„å®ç°æ–¹å¼ï¼Œè¯¦è§£å­˜å‚¨å±‚æ¬¡çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä»‹ç»ç³»ç»Ÿæ€§èƒ½çš„è¯„ä»·æŒ‡æ ‡ä¸æ–¹æ³•ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/g86c4e7a.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/f75b3d6f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/f75b3d6f.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 6 ç«  è¾“å…¥è¾“å‡ºç³»ç»Ÿ</a><div class="blog-slider__text">ä»‹ç»I/Oè®¾å¤‡çš„åˆ†ç±»ä¸ç‰¹æ€§ï¼Œè¯¦è§£ç¨‹åºæŸ¥è¯¢ã€ä¸­æ–­ä¸DMAä¸‰ç§æ§åˆ¶æ–¹å¼ï¼Œåˆ†æä¸­æ–­ç³»ç»Ÿçš„å¤„ç†æœºåˆ¶ï¼Œç†è§£è®¾å¤‡ä¸ä¸»æœºçš„ä¿¡æ¯äº¤æ¢è¿‡ç¨‹ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/f75b3d6f.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/d64a2c5e.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/d64a2c5e.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 5 ç«  ä¸­å¤®å¤„ç†å™¨</a><div class="blog-slider__text">è¯¦è§£CPUçš„åŠŸèƒ½ç»„æˆä¸å·¥ä½œåŸç†ï¼Œåˆ†ææ—¶åºç³»ç»Ÿçš„ä½œç”¨ï¼Œå¯¹æ¯”å¾®ç¨‹åºä¸ç¡¬å¸ƒçº¿æ§åˆ¶æ–¹å¼ï¼Œä»‹ç»æµæ°´çº¿æŠ€æœ¯çš„æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/d64a2c5e.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/reggie-deployment.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112758.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/reggie-deployment.html&quot;);" href="javascript:void(0);" alt="">ç‘å‰å¤–å–ï¼šLinuxç¯å¢ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²</a><div class="blog-slider__text">è¯¦è§£ç‘å‰å¤–å–éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬Linuxç¯å¢ƒé…ç½®ã€Gitç‰ˆæœ¬ç®¡ç†ã€è‡ªåŠ¨åŒ–è„šæœ¬ä¸é¡¹ç›®å‘å¸ƒå®è·µã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/reggie-deployment.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/b93e5f6d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112914.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/b93e5f6d.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 4 ç«  æŒ‡ä»¤ç³»ç»Ÿ</a><div class="blog-slider__text">è¯¦è§£æŒ‡ä»¤çš„åŸºæœ¬æ ¼å¼ä¸å¯»å€æ–¹å¼ï¼Œå¯¹æ¯”CISCä¸RISCä½“ç³»ç»“æ„ç‰¹ç‚¹ï¼Œåˆ†ææŒ‡ä»¤çš„æ‰§è¡Œæµç¨‹ï¼Œç†è§£æŒ‡ä»¤ç³»ç»Ÿå¯¹ç¡¬ä»¶çš„é€‚é…å…³ç³»ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/b93e5f6d.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/ce4585c2.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/ce4585c2.html&quot;);" href="javascript:void(0);" alt="">å‰ç«¯å®ç°ï¼šç•Œé¢ä¸äº¤äº’é€»è¾‘</a><div class="blog-slider__text">è¯¦è§£è‹ç©¹å¤–å–å‰ç«¯å¼€å‘å®ç°ï¼ŒåŒ…æ‹¬Vueç»„ä»¶æ¶æ„è®¾è®¡ã€æ ¸å¿ƒé¡µé¢ï¼ˆç™»å½•ã€é¦–é¡µã€è®¢å•é¡µï¼‰å¼€å‘ï¼Œæ¥å£äº¤äº’å°è£…ä¸çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿å‰ç«¯ç•Œé¢ä¸åç«¯æœåŠ¡é«˜æ•ˆååŒã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/ce4585c2.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/reggie-optimization.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/reggie-optimization.html&quot;);" href="javascript:void(0);" alt="">ç‘å‰å¤–å–ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„å‡çº§</a><div class="blog-slider__text">è¯¦è§£ç‘å‰å¤–å–ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Redisç¼“å­˜åº”ç”¨ã€æ•°æ®åº“è¯»å†™åˆ†ç¦»ã€ç³»ç»Ÿæ¶æ„å‡çº§ç­‰æ€§èƒ½æå‡æ‰‹æ®µã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/reggie-optimization.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/a81d4c7b.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/a81d4c7b.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 3 ç«  å­˜å‚¨ç³»ç»Ÿ</a><div class="blog-slider__text">åˆ†æå­˜å‚¨ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„è®¾è®¡ï¼Œè¯¦è§£ä¸»å­˜å‚¨å™¨çš„ç»„æˆä¸å·¥ä½œæµç¨‹ï¼Œé˜è¿°Cacheçš„æ˜ å°„æ–¹å¼ä¸æ›¿æ¢ç­–ç•¥ï¼Œä»‹ç»å­˜å‚¨å™¨æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/a81d4c7b.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/d67b0a8b.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/d67b0a8b.html&quot;);" href="javascript:void(0);" alt="">æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼šä¸šåŠ¡æµç¨‹å®ç°</a><div class="blog-slider__text">èšç„¦è‹ç©¹å¤–å–æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ï¼Œè¯¦è§£ç”¨æˆ·ç®¡ç†ã€èœå“ç®¡ç†ã€è®¢å•å…¨æµç¨‹åŠè´­ç‰©è½¦äº¤äº’é€»è¾‘ï¼Œç»“åˆæ•°æ®ç»Ÿè®¡åŠŸèƒ½å®ç°ä¸šåŠ¡é—­ç¯ï¼Œè¦†ç›–é¡¹ç›®æ ¸å¿ƒåœºæ™¯ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/d67b0a8b.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/e72f3b9c.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112855.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/e72f3b9c.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 2 ç«  æ•°æ®çš„è¡¨ç¤ºä¸è®¡ç®—</a><div class="blog-slider__text">è¯¦è§£æ•°åˆ¶è½¬æ¢è§„åˆ™ï¼Œé˜è¿°å®šç‚¹æ•°ä¸æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•ï¼Œåˆ†æè¡¥ç è¿ç®—æœºåˆ¶ï¼Œä»‹ç»ALUçš„åŠŸèƒ½ä¸å®ç°ï¼ŒæŒæ¡æ•°æ®åœ¨è®¡ç®—æœºä¸­çš„å¤„ç†æ–¹å¼ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/e72f3b9c.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/b85186f.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112626.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/b85186f.html&quot;);" href="javascript:void(0);" alt="">åŸºç¡€å¼€å‘ï¼šç¯å¢ƒæ­å»ºä¸æ ¸å¿ƒé…ç½®</a><div class="blog-slider__text">è¯¦è§£è‹ç©¹å¤–å–é¡¹ç›®åŸºç¡€å¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»ºã€æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ä¸åˆå§‹åŒ–ï¼Œæ ¸å¿ƒé…ç½®ï¼ˆè·¨åŸŸã€æ—¥å¿—ç­‰ï¼‰åŠåŸºç¡€å·¥å…·ç±»å®ç°ï¼Œæ„å»ºé¡¹ç›®å¼€å‘åŸºçŸ³ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/b85186f.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/reggie-business.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/reggie-business.html&quot;);" href="javascript:void(0);" alt="">ç‘å‰å¤–å–ï¼šæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘</a><div class="blog-slider__text">è¯¦è§£ç‘å‰å¤–å–åç«¯æ ¸å¿ƒä¸šåŠ¡å®ç°ï¼ŒåŒ…æ‹¬å‘˜å·¥ç®¡ç†ã€èœå“åˆ†ç±»ã€è®¢å•æµç¨‹ç­‰åŠŸèƒ½çš„æ¥å£ä¸é€»è¾‘å¼€å‘ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/reggie-business.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/reggie-mobile.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_155656.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/reggie-mobile.html&quot;);" href="javascript:void(0);" alt="">ç‘å‰å¤–å–ï¼šç§»åŠ¨ç«¯äº¤äº’ä¸ç”¨æˆ·ç«¯å®ç°</a><div class="blog-slider__text">è¯¦è§£ç‘å‰å¤–å–ç§»åŠ¨ç«¯ç”¨æˆ·ç«¯å¼€å‘ï¼ŒåŒ…æ‹¬æ‰‹æœºéªŒè¯ç ç™»å½•ã€åœ°å€ç°¿ç®¡ç†ã€èœå“ / å¥—é¤å±•ç¤ºã€è´­ç‰©è½¦å¢åˆ æ”¹æŸ¥ã€ç”¨æˆ·è®¢å•åˆ›å»ºä¸å†æ¥ä¸€å•åŠŸèƒ½ï¼ŒåŠå‰åç«¯æ¥å£äº¤äº’é€»è¾‘ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/reggie-mobile.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/bae4ff13.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112813.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-12</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/bae4ff13.html&quot;);" href="javascript:void(0);" alt="">Redis</a><div class="blog-slider__text">Redis ä½œä¸ºå†…å­˜ NoSQL æ•°æ®åº“çš„å®šä½ï¼Œæ”¯æŒ String/Hash ç­‰å¤šæ•°æ®ç»“æ„ï¼Œå…·å¤‡ RDB/AOF æŒä¹…åŒ–ä¸ä¸»ä»é«˜å¯ç”¨ï¼Œæ ¸å¿ƒç”¨äºç¼“å­˜ã€åˆ†å¸ƒå¼é”ï¼Œæ€§èƒ½é«˜æ•ˆã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/bae4ff13.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/c45d1e8a.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/c45d1e8a.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 1 ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°</a><div class="blog-slider__text">ä»‹ç»è®¡ç®—æœºç³»ç»Ÿçš„ç¡¬ä»¶ä¸è½¯ä»¶ç»„æˆï¼Œè¯¦è§£äº”å¤§åŠŸèƒ½éƒ¨ä»¶åŠæ€»çº¿å·¥ä½œæœºåˆ¶ï¼Œé˜è¿°æŒ‡ä»¤é›†ä½“ç³»ç»“æ„çš„æ ¸å¿ƒä½œç”¨ï¼Œå»ºç«‹è®¡ç®—æœºç³»ç»Ÿçš„æ•´ä½“è®¤çŸ¥ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/c45d1e8a.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/25e0fe54.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112618.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/25e0fe54.html&quot;);" href="javascript:void(0);" alt="">é¡¹ç›®æ¦‚è¿°ï¼šæ¶æ„ä¸éœ€æ±‚åˆ†æ</a><div class="blog-slider__text">å…¨é¢è§£æè‹ç©¹å¤–å–é¡¹ç›®çš„æ•´ä½“è§„åˆ’ï¼ŒåŒ…æ‹¬é¡¹ç›®èƒŒæ™¯ã€æ ¸å¿ƒéœ€æ±‚ã€æŠ€æœ¯æ ˆé€‰å‹ä¾æ®ï¼Œè¯¦è§£ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸å¼€å‘è§„èŒƒï¼Œä¸ºé¡¹ç›®å¼€å‘æä¾›æ•´ä½“æŒ‡å¯¼ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/25e0fe54.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/77666db.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112758.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-04-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/77666db.html&quot;);" href="javascript:void(0);" alt="">ç‹é“è®¡ç»„pdf</a><div class="blog-slider__text">è®¡ç®—æœºç»„æˆåŸç†</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/77666db.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/833e46bb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112650.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/833e46bb.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 2 ç«  è¿›ç¨‹ä¸çº¿ç¨‹ï¼šå¹¶å‘ç®¡ç†æ ¸å¿ƒ</a><div class="blog-slider__text">è®²è§£è¿›ç¨‹ä¸çº¿ç¨‹çš„å®šä¹‰ã€çŠ¶æ€è½¬æ¢åŠæ§åˆ¶é€»è¾‘ï¼Œåˆ†æè¿›ç¨‹è°ƒåº¦ç­–ç•¥ï¼Œé˜è¿°è¿›ç¨‹åŒæ­¥äº’æ–¥ï¼ˆPV æ“ä½œï¼‰ä¸æ­»é”çš„å¤„ç†æœºåˆ¶ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå¹¶å‘ç®¡ç†çš„æ ¸å¿ƒã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/833e46bb.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/169339cb.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112844.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/169339cb.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 5 ç«  è¾“å…¥è¾“å‡ºç®¡ç†ï¼šè®¾å¤‡ååŒä¸ä¼˜åŒ–</a><div class="blog-slider__text">è¯¦è§£I/Oè®¾å¤‡åˆ†ç±»ä¸æ§åˆ¶æ–¹å¼ï¼ˆç¨‹åºç›´æ¥æ§åˆ¶/DMA/é€šé“ï¼‰ï¼Œåˆ†æç£ç›˜ç»“æ„ä¸è°ƒåº¦ç­–ç•¥ï¼Œä»‹ç»SPOOLingç­‰I/Oä¼˜åŒ–æŠ€æœ¯ï¼Œä¿éšœè®¾å¤‡ä¸CPUã€å†…å­˜çš„é«˜æ•ˆååŒã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/169339cb.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/790dfc8c.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/790dfc8c.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 4 ç«  æ–‡ä»¶ç®¡ç†ï¼šå­˜å‚¨ä¸è®¿é—®æœºåˆ¶</a><div class="blog-slider__text">ä»‹ç»æ–‡ä»¶çš„é€»è¾‘ä¸ç‰©ç†ç»“æ„ï¼Œè®²è§£ç›®å½•ç®¡ç†ï¼ˆæŒ‰åå­˜å–ï¼‰ã€ç´¢å¼•èŠ‚ç‚¹åŠŸèƒ½åŠå¤–å­˜ç©ºé—²ç©ºé—´åˆ†é…ç­–ç•¥ï¼Œå®ç°æ–‡ä»¶çš„å®‰å…¨å­˜å‚¨ä¸é«˜æ•ˆå…±äº«ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/790dfc8c.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/ce20e5e9.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/ce20e5e9.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 3 ç«  å†…å­˜ç®¡ç†ï¼šåœ°å€æ˜ å°„ä¸è™šæ‹Ÿå†…å­˜</a><div class="blog-slider__text">è¦†ç›–å†…å­˜åˆ†é…æ–¹å¼ï¼ˆè¿ç»­/åˆ†é¡µ/åˆ†æ®µï¼‰ä¸åœ°å€è½¬æ¢æœºåˆ¶ï¼Œè¯¦è§£è™šæ‹Ÿå†…å­˜æŠ€æœ¯ã€è¯·æ±‚åˆ†é¡µæµç¨‹åŠé¡µé¢ç½®æ¢ç­–ç•¥ï¼Œè§£å†³å¤šé“ç¨‹åºä¸‹å†…å­˜åˆ©ç”¨ç‡ä¸åœ°å€æ˜ å°„é—®é¢˜ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/ce20e5e9.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/b328aa63.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/b328aa63.html&quot;);" href="javascript:void(0);" alt="">ç¬¬ 1 ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°ï¼šè®¡ç®—æœºç³»ç»ŸåŸºç¡€</a><div class="blog-slider__text">é˜è¿°æ“ä½œç³»ç»Ÿçš„å®šä¹‰ä¸æ ¸å¿ƒåŠŸèƒ½ï¼Œè¯¦è§£å››å¤§ç‰¹å¾ï¼ˆå¹¶å‘ / å…±äº« / è™šæ‹Ÿ / å¼‚æ­¥ï¼‰ã€å¤„ç†å™¨è¿è¡Œæ¨¡å¼åŠç³»ç»Ÿç»“æ„åˆ†ç±»ï¼Œä»‹ç» OS å¼•å¯¼æµç¨‹ï¼Œå¥ å®šæ“ä½œç³»ç»Ÿè®¤çŸ¥åŸºç¡€ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/b328aa63.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/79666db.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-12</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/79666db.html&quot;);" href="javascript:void(0);" alt="">æ•°æ®ç»“æ„</a><div class="blog-slider__text">æ•°æ®ç»“æ„çš„æ ¸å¿ƒæ˜¯é«˜æ•ˆç»„ç»‡æ•°æ®ï¼ŒåŒºåˆ†é€»è¾‘ç»“æ„ï¼ˆçº¿æ€§ / éçº¿æ€§ï¼‰ä¸ç‰©ç†ç»“æ„ï¼ˆé¡ºåº / é“¾å¼ï¼‰ï¼Œè¦†ç›–æ•°ç»„ã€æ ‘ã€å›¾ç­‰æ ¸å¿ƒç±»å‹ï¼Œä¸ºä¼˜åŒ–ç®—æ³•æ•ˆç‡ã€æ”¯æ’‘å·¥ç¨‹åº”ç”¨å¥ å®šåŸºç¡€ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/79666db.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/reggie-overview.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2024_1123_160146.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-09-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/reggie-overview.html&quot;);" href="javascript:void(0);" alt="">ç‘å‰å¤–å–ï¼šé¡¹ç›®æ¦‚è¿°ä¸æ•´ä½“æ¶æ„</a><div class="blog-slider__text">å…¨é¢è§£æç‘å‰å¤–å–é¡¹ç›®èƒŒæ™¯ã€æŠ€æœ¯é€‰å‹ã€æ•´ä½“æ¶æ„è®¾è®¡åŠæ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼Œå»ºç«‹é¡¹ç›®å…¨å±€è®¤çŸ¥ã€‚</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/reggie-overview.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;post/b8b0eacd.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://obsidian-1322827540.cos.ap-guangzhou.myqcloud.com/img/Screenshot_2025_0314_112938.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-12</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;post/b8b0eacd.html&quot;);" href="javascript:void(0);" alt="">javaåŸºç¡€</a><div class="blog-slider__text">JavaåŸºç¡€</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;post/b8b0eacd.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>